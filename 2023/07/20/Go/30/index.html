<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>beego框架开发文档 | Palp1tate</title><meta name="author" content="Palp1tate,1939311091@qq.com"><meta name="copyright" content="Palp1tate"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="简介beego 是一个快速开发 Go 应用的 HTTP 框架，他可以用来快速开发 API、Web 及后端服务等各种应用，是一个 RESTful 的框架，主要设计灵感来源于 tornado、sinatra 和 flask 这三个框架，但是结合了 Go 本身的一些特性（interface、struct 嵌入等）而设计的一个框架。 架构beego 的整体设计架构如下所示：  beego 是基于八大独立的">
<meta property="og:type" content="article">
<meta property="og:title" content="beego框架开发文档">
<meta property="og:url" content="https://uestcwxy.love/2023/07/20/Go/30/index.html">
<meta property="og:site_name" content="Palp1tate">
<meta property="og:description" content="简介beego 是一个快速开发 Go 应用的 HTTP 框架，他可以用来快速开发 API、Web 及后端服务等各种应用，是一个 RESTful 的框架，主要设计灵感来源于 tornado、sinatra 和 flask 这三个框架，但是结合了 Go 本身的一些特性（interface、struct 嵌入等）而设计的一个框架。 架构beego 的整体设计架构如下所示：  beego 是基于八大独立的">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/palp1tate/blog_img/img/4d287328613d2f4952a70edb9192044037dd5e22.jpg">
<meta property="article:published_time" content="2023-07-20T13:44:47.000Z">
<meta property="article:modified_time" content="2023-09-15T11:29:37.462Z">
<meta property="article:author" content="Palp1tate">
<meta property="article:tag" content="大二自学">
<meta property="article:tag" content="Go">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/palp1tate/blog_img/img/4d287328613d2f4952a70edb9192044037dd5e22.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://uestcwxy.love/2023/07/20/Go/30/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":500},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Palp1tate","link":"链接: ","source":"来源: Palp1tate","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'beego框架开发文档',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-09-15 19:29:37'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/font.css"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Palp1tate" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (true) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">98</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-clipboard-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/palp1tate/blog_img/img/4d287328613d2f4952a70edb9192044037dd5e22.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Palp1tate"><span class="site-name">Palp1tate</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-clipboard-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">beego框架开发文档</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-07-20T13:44:47.000Z" title="发表于 2023-07-20 21:44:47">2023-07-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-09-15T11:29:37.462Z" title="更新于 2023-09-15 19:29:37">2023-09-15</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">28.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>121分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="beego框架开发文档"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>beego 是一个快速开发 Go 应用的 HTTP 框架，他可以用来快速开发 API、Web 及后端服务等各种应用，是一个 RESTful 的框架，主要设计灵感来源于 tornado、sinatra 和 flask 这三个框架，但是结合了 Go 本身的一些特性（interface、struct 嵌入等）而设计的一个框架。</p>
<h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><p>beego 的整体设计架构如下所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/palp1tate/blog_img/img/architecture.png"></p>
<p>beego 是基于八大独立的模块构建的，是一个高度解耦的框架。当初设计 beego 的时候就是考虑功能模块化，用户即使不使用 beego 的 HTTP 逻辑，也依旧可以使用这些独立模块，例如：你可以使用 cache 模块来做你的缓存逻辑；使用日志模块来记录你的操作信息；使用 config 模块来解析你各种格式的文件。所以 beego 不仅可以用于 HTTP 类的应用开发，在你的 socket 游戏开发中也是很有用的模块，这也是 beego 如此受欢迎的一个原因。大家如果玩过乐高的话，应该知道很多高级的东西都是一块一块的积木搭建出来的，而设计 beego 的时候，这些模块就是积木，高级机器人就是 beego。</p>
<h2 id="执行逻辑"><a href="#执行逻辑" class="headerlink" title="执行逻辑"></a>执行逻辑</h2><p>既然 beego 是基于这些模块构建的，那么它的执行逻辑是怎么样的呢？beego 是一个典型的 MVC 架构，它的执行逻辑如下图所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/palp1tate/blog_img/img/flow.png"></p>
<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><p>一般的 beego 项目的目录如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">├── conf</span><br><span class="line">│   └── app.conf</span><br><span class="line">├── controllers</span><br><span class="line">│   ├── admin</span><br><span class="line">│   └── default.go</span><br><span class="line">├── main.go</span><br><span class="line">├── models</span><br><span class="line">│   └── models.go</span><br><span class="line">├── static</span><br><span class="line">│   ├── css</span><br><span class="line">│   ├── ico</span><br><span class="line">│   ├── img</span><br><span class="line">│   └── js</span><br><span class="line">└── views</span><br><span class="line">    ├── admin</span><br><span class="line">    └── index.tpl</span><br></pre></td></tr></table></figure>

<p>从上面的目录结构我们可以看出来 M（models 目录）、V（views 目录）和 C（controllers 目录）的结构， <code>main.go</code> 是入口文件。</p>
<h1 id="安装与升级"><a href="#安装与升级" class="headerlink" title="安装与升级"></a>安装与升级</h1><h2 id="beego安装"><a href="#beego安装" class="headerlink" title="beego安装"></a>beego安装</h2><p>beego 的安装是典型的 Go 安装包的形式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/beego/beego/v2@latest</span><br></pre></td></tr></table></figure>

<h2 id="beego-升级"><a href="#beego-升级" class="headerlink" title="beego 升级"></a>beego 升级</h2><p>beego 升级分为 go 方式升级和源码下载升级：</p>
<ul>
<li><p>Go 升级,通过该方式用户可以升级 beego 框架，强烈推荐该方式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/beego/beego/v2</span><br></pre></td></tr></table></figure>
</li>
<li><p>源码下载升级，用户访问 <code>https://github.com/beego/beego</code> ,下载源码，然后覆盖到 <code>$GOPATH/src/github.com/beego/beego</code> 目录，然后通过本地执行安装就可以升级了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go install 	github.com/beego/beego/v2</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="bee-工具"><a href="#bee-工具" class="headerlink" title="bee 工具"></a>bee 工具</h2><p>bee 工具是一个为了协助快速开发 beego 项目而创建的项目，通过 bee 您可以很容易的进行 beego 项目的创建、热编译、开发、测试、和部署。</p>
<h3 id="bee-工具的安装"><a href="#bee-工具的安装" class="headerlink" title="bee 工具的安装"></a>bee 工具的安装</h3><p>您可以通过如下的方式安装 bee 工具：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># go 1.16 以前的版本</span></span><br><span class="line">go get -u github.com/beego/bee/v2</span><br><span class="line"></span><br><span class="line"><span class="comment"># go 1.16及以后的版本</span></span><br><span class="line">go install github.com/beego/bee/v2@latest</span><br></pre></td></tr></table></figure>

<p>安装完之后，<code>bee</code> 可执行文件默认存放在 <code>$GOPATH/bin</code> 里面，所以您需要把 <code>$GOPATH/bin</code> 添加到您的环境变量中，才可以进行下一步。</p>
<h3 id="bee-工具命令详解"><a href="#bee-工具命令详解" class="headerlink" title="bee 工具命令详解"></a>bee 工具命令详解</h3><p>我们在命令行输入 <code>bee</code>，可以看到如下的信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">version     Prints the current Bee version</span><br><span class="line">migrate     Runs database migrations</span><br><span class="line">api         Creates a Beego API application</span><br><span class="line">bale        Transforms non-Go files to Go <span class="built_in">source</span> files</span><br><span class="line">fix         Fixes your application by making it compatible with newer versions of Beego</span><br><span class="line">pro         Source code generator</span><br><span class="line">dev         Commands <span class="built_in">which</span> used to <span class="built_in">help</span> to develop beego and bee</span><br><span class="line">dlv         Start a debugging session using Delve</span><br><span class="line">dockerize   Generates a Dockerfile and docker-compose.yaml <span class="keyword">for</span> your Beego application</span><br><span class="line">generate    Source code generator</span><br><span class="line">hprose      Creates an RPC application based on Hprose and Beego frameworks</span><br><span class="line">new         Creates a Beego application</span><br><span class="line">pack        Compresses a Beego application into a single file</span><br><span class="line">rs          Run customized scripts</span><br><span class="line">run         Run the application by starting a <span class="built_in">local</span> development server</span><br><span class="line">server      serving static content over HTTP on port</span><br><span class="line">update      Update Bee</span><br></pre></td></tr></table></figure>

<h4 id="new命令"><a href="#new命令" class="headerlink" title="new命令"></a><code>new</code>命令</h4><p><code>new</code> 命令是新建一个 Web 项目，我们在命令行下执行 <code>bee new &lt;项目名&gt;</code> 就可以创建一个新的项目。但是注意该命令必须在 <code>$GOPATH/src</code> 下执行。最后会在 <code>$GOPATH/src</code> 相应目录下生成如下目录结构的项目：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">bee new myproject</span><br><span class="line">[INFO] Creating application...</span><br><span class="line">/gopath/src/myproject/</span><br><span class="line">/gopath/src/myproject/conf/</span><br><span class="line">/gopath/src/myproject/controllers/</span><br><span class="line">/gopath/src/myproject/models/</span><br><span class="line">/gopath/src/myproject/static/</span><br><span class="line">/gopath/src/myproject/static/js/</span><br><span class="line">/gopath/src/myproject/static/css/</span><br><span class="line">/gopath/src/myproject/static/img/</span><br><span class="line">/gopath/src/myproject/views/</span><br><span class="line">/gopath/src/myproject/conf/app.conf</span><br><span class="line">/gopath/src/myproject/controllers/default.go</span><br><span class="line">/gopath/src/myproject/views/index.tpl</span><br><span class="line">/gopath/src/myproject/main.go</span><br><span class="line">13-11-25 09:50:39 [SUCC] New application successfully created!</span><br><span class="line">myproject</span><br><span class="line">├── conf</span><br><span class="line">│   └── app.conf</span><br><span class="line">├── controllers</span><br><span class="line">│   └── default.go</span><br><span class="line">├── main.go</span><br><span class="line">├── models</span><br><span class="line">├── routers</span><br><span class="line">│   └── router.go</span><br><span class="line">├── static</span><br><span class="line">│   ├── css</span><br><span class="line">│   ├── img</span><br><span class="line">│   └── js</span><br><span class="line">├── tests</span><br><span class="line">│   └── default_test.go</span><br><span class="line">└── views</span><br><span class="line">    └── index.tpl</span><br><span class="line"></span><br><span class="line">8 directories, 4 files</span><br></pre></td></tr></table></figure>

<blockquote>
<p>以上是官方文档的描述，但是我亲测可以在任意路径使用<code>bee new &lt;项目名&gt;</code>命令，不一定要在<code>$GOPATH/src</code> 。</p>
</blockquote>
<h4 id="api-命令"><a href="#api-命令" class="headerlink" title="api 命令"></a><code>api</code> 命令</h4><p>上面的 <code>new</code> 命令是用来新建 Web 项目，不过很多用户使用 beego 来开发 API 应用。所以这个 <code>api</code> 命令就是用来创建 API 应用的，执行命令之后如下所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">bee api apiproject</span><br><span class="line">create app folder: /gopath/src/apiproject</span><br><span class="line">create conf: /gopath/src/apiproject/conf</span><br><span class="line">create controllers: /gopath/src/apiproject/controllers</span><br><span class="line">create models: /gopath/src/apiproject/models</span><br><span class="line">create tests: /gopath/src/apiproject/tests</span><br><span class="line">create conf app.conf: /gopath/src/apiproject/conf/app.conf</span><br><span class="line">create controllers default.go: /gopath/src/apiproject/controllers/default.go</span><br><span class="line">create tests default.go: /gopath/src/apiproject/tests/default_test.go</span><br><span class="line">create models object.go: /gopath/src/apiproject/models/object.go</span><br><span class="line">create main.go: /gopath/src/apiproject/main.go</span><br></pre></td></tr></table></figure>

<p>这个项目的目录结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">apiproject</span><br><span class="line">├── conf</span><br><span class="line">│   └── app.conf</span><br><span class="line">├── controllers</span><br><span class="line">│   └── object.go</span><br><span class="line">│   └── user.go</span><br><span class="line">├── docs</span><br><span class="line">│   └── doc.go</span><br><span class="line">├── main.go</span><br><span class="line">├── models</span><br><span class="line">│   └── object.go</span><br><span class="line">│   └── user.go</span><br><span class="line">├── routers</span><br><span class="line">│   └── router.go</span><br><span class="line">└── tests</span><br><span class="line">    └── default_test.go</span><br></pre></td></tr></table></figure>

<p>从上面的目录我们可以看到和 Web 项目相比，少了 static 和 views 目录，多了一个 test 模块，用来做单元测试的。同时，该命令还支持一些自定义参数自动连接数据库创建相关 model 和 controller:<br><code>bee api [appname] [-tables=&quot;&quot;] [-driver=mysql] [-conn=&quot;root:&lt;password&gt;@tcp(127.0.0.1:3306)/test&quot;]</code><br>如果 conn 参数为空则创建一个示例项目，否则将基于链接信息链接数据库创建项目。</p>
<blockquote>
<p>同样笔者亲测该命令也不一定要在<code>$GOPATH/src</code>运行</p>
</blockquote>
<h4 id="run-命令"><a href="#run-命令" class="headerlink" title="run 命令"></a><code>run</code> 命令</h4><p>我们在开发 Go 项目的时候最大的问题是经常需要自己手动去编译再运行，<code>bee run</code> 命令是监控 beego 的项目，通过 <a target="_blank" rel="noopener" href="https://github.com/howeyc/fsnotify">fsnotify</a>监控文件系统。但是注意该命令必须在 <code>$GOPATH/src/appname</code> 下执行。<br>这样我们在开发过程中就可以实时的看到项目修改之后的效果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bee run</span><br><span class="line">13-11-25 09:53:04 [INFO] Uses <span class="string">&#x27;myproject&#x27;</span> as <span class="string">&#x27;appname&#x27;</span></span><br><span class="line">13-11-25 09:53:04 [INFO] Initializing watcher...</span><br><span class="line">13-11-25 09:53:04 [TRAC] Directory(/gopath/src/myproject/controllers)</span><br><span class="line">13-11-25 09:53:04 [TRAC] Directory(/gopath/src/myproject/models)</span><br><span class="line">13-11-25 09:53:04 [TRAC] Directory(/gopath/src/myproject)</span><br><span class="line">13-11-25 09:53:04 [INFO] Start building...</span><br><span class="line">13-11-25 09:53:16 [SUCC] Build was successful</span><br><span class="line">13-11-25 09:53:16 [INFO] Restarting myproject ...</span><br><span class="line">13-11-25 09:53:16 [INFO] ./myproject is running...</span><br></pre></td></tr></table></figure>

<p>我们打开浏览器就可以看到效果 <code>http://localhost:8080/</code>:</p>
<p><img src="https://cdn.jsdelivr.net/gh/palp1tate/blog_img/img/beerun.png"></p>
<p>如果我们修改了 <code>Controller</code> 下面的 <code>default.go</code> 文件，我们就可以看到命令行输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">13-11-25 10:11:20 [EVEN] &quot;/gopath/src/myproject/controllers/default.go&quot;: DELETE|MODIFY</span><br><span class="line">13-11-25 10:11:20 [INFO] Start building...</span><br><span class="line">13-11-25 10:11:20 [SKIP] &quot;/gopath/src/myproject/controllers/default.go&quot;: CREATE</span><br><span class="line">13-11-25 10:11:23 [SKIP] &quot;/gopath/src/myproject/controllers/default.go&quot;: MODIFY</span><br><span class="line">13-11-25 10:11:23 [SUCC] Build was successful</span><br><span class="line">13-11-25 10:11:23 [INFO] Restarting myproject ...</span><br><span class="line">13-11-25 10:11:23 [INFO] ./myproject is running...</span><br></pre></td></tr></table></figure>

<p>刷新浏览器我们看到新的修改内容已经输出。</p>
<h4 id="pack-命令"><a href="#pack-命令" class="headerlink" title="pack 命令"></a><code>pack</code> 命令</h4><p><code>pack</code> 目录用来发布应用的时候打包，会把项目打包成 zip 包，这样我们部署的时候直接把打包之后的项目上传，解压就可以部署了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bee pack</span><br><span class="line">app path: /gopath/src/apiproject</span><br><span class="line">GOOS darwin GOARCH amd64</span><br><span class="line">build apiproject</span><br><span class="line">build success</span><br><span class="line">exclude prefix:</span><br><span class="line">exclude suffix: .go:.DS_Store:.tmp</span><br><span class="line">file write to `/gopath/src/apiproject/apiproject.tar.gz`</span><br></pre></td></tr></table></figure>

<p>我们可以看到目录下有如下的压缩文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rwxr-xr-x  1 astaxie  staff  8995376 11 25 22:46 apiproject</span><br><span class="line">-rw-r--r--  1 astaxie  staff  2240288 11 25 22:58 apiproject.tar.gz</span><br><span class="line">drwxr-xr-x  3 astaxie  staff      102 11 25 22:31 conf</span><br><span class="line">drwxr-xr-x  3 astaxie  staff      102 11 25 22:31 controllers</span><br><span class="line">-rw-r--r--  1 astaxie  staff      509 11 25 22:31 main.go</span><br><span class="line">drwxr-xr-x  3 astaxie  staff      102 11 25 22:31 models</span><br><span class="line">drwxr-xr-x  3 astaxie  staff      102 11 25 22:31 tests</span><br></pre></td></tr></table></figure>

<h4 id="version-命令"><a href="#version-命令" class="headerlink" title="version 命令"></a><code>version</code> 命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ bee version</span><br><span class="line">______</span><br><span class="line">| ___ \</span><br><span class="line">| |_/ /  ___   ___</span><br><span class="line">| ___ \ / _ \ / _ \</span><br><span class="line">| |_/ /|  __/|  __/</span><br><span class="line">\____/  \___| \___| v2.0.4</span><br><span class="line"></span><br><span class="line">├── GoVersion : go1.20.4</span><br><span class="line">├── GOOS      : windows</span><br><span class="line">├── GOARCH    : amd64</span><br><span class="line">├── NumCPU    : 16</span><br><span class="line">├── GOPATH    : C:\Users\19393\sdk\go1.20.4\go_workspace</span><br><span class="line">├── GOROOT    : C:/Users/19393/sdk/go1.20.4</span><br><span class="line">├── Compiler  : gc</span><br><span class="line">└── Date      : Friday, 21 Jul 2023</span><br></pre></td></tr></table></figure>

<h4 id="generate-命令"><a href="#generate-命令" class="headerlink" title="generate 命令"></a><code>generate</code> 命令</h4><p>这个命令是用来自动化的生成代码的，包含了从数据库一键生成 model，还包含了 scaffold 的，通过这个命令，让大家开发代码不再慢</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">bee generate scaffold [scaffoldname] [-fields=&quot;&quot;] [-driver=mysql] [-conn=&quot;root:@tcp(127.0.0.1:3306)/test&quot;]</span><br><span class="line">    The generate scaffold command will do a number of things for you.</span><br><span class="line">    -fields: a list of table fields. Format: field:type, ...</span><br><span class="line">    -driver: [mysql | postgres | sqlite], the default is mysql</span><br><span class="line">    -conn:   the connection string used by the driver, the default is root:@tcp(127.0.0.1:3306)/test</span><br><span class="line">    example: bee generate scaffold post -fields=&quot;title:string,body:text&quot;</span><br><span class="line"></span><br><span class="line">bee generate model [modelname] [-fields=&quot;&quot;]</span><br><span class="line">    generate RESTful model based on fields</span><br><span class="line">    -fields: a list of table fields. Format: field:type, ...</span><br><span class="line"></span><br><span class="line">bee generate controller [controllerfile]</span><br><span class="line">    generate RESTful controllers</span><br><span class="line"></span><br><span class="line">bee generate view [viewpath]</span><br><span class="line">    generate CRUD view in viewpath</span><br><span class="line"></span><br><span class="line">bee generate migration [migrationfile] [-fields=&quot;&quot;]</span><br><span class="line">    generate migration file for making database schema update</span><br><span class="line">    -fields: a list of table fields. Format: field:type, ...</span><br><span class="line"></span><br><span class="line">bee generate docs</span><br><span class="line">    generate swagger doc file</span><br><span class="line">    </span><br><span class="line">bee generate routers [-ctrlDir=/path/to/controller/directory] [-routersFile=/path/to/routers/file.go] [-routersPkg=myPackage]</span><br><span class="line">    -ctrlDir: the directory contains controllers definition. Bee scans this directory and its subdirectory to generate routers info</span><br><span class="line">    -routersFile: output file. All generated routers info will be output into this file. </span><br><span class="line">              If file not found, Bee create new one, or Bee truncates it.</span><br><span class="line">              The default value is &quot;routers/commentRouters.go&quot;</span><br><span class="line">    -routersPkg: package declaration.The default value is &quot;routers&quot;. </span><br><span class="line">              When you pass routersFile parameter, you&#x27;d better pass this parameter</span><br><span class="line"></span><br><span class="line">bee generate test [routerfile]</span><br><span class="line">    generate testcase</span><br><span class="line"></span><br><span class="line">bee generate appcode [-tables=&quot;&quot;] [-driver=mysql] [-conn=&quot;root:@tcp(127.0.0.1:3306)/test&quot;] [-level=3]</span><br><span class="line">    generate appcode based on an existing database</span><br><span class="line">    -tables: a list of table names separated by &#x27;,&#x27;, default is empty, indicating all tables</span><br><span class="line">    -driver: [mysql | postgres | sqlite], the default is mysql</span><br><span class="line">    -conn:   the connection string used by the driver.</span><br><span class="line">             default for mysql:    root:@tcp(127.0.0.1:3306)/test</span><br><span class="line">             default for postgres: postgres://postgres:postgres@127.0.0.1:5432/postgres</span><br><span class="line">    -level:  [1 | 2 | 3], 1 = models; 2 = models,controllers; 3 = models,controllers,router</span><br></pre></td></tr></table></figure>

<h4 id="migrate-命令"><a href="#migrate-命令" class="headerlink" title="migrate 命令"></a><code>migrate</code> 命令</h4><p>这个命令是应用的数据库迁移命令，主要是用来每次应用升级，降级的SQL管理。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">bee migrate [-driver=mysql] [-conn=&quot;root:@tcp(127.0.0.1:3306)/test&quot;]</span><br><span class="line">    run all outstanding migrations</span><br><span class="line">    -driver: [mysql | postgresql | sqlite], the default is mysql</span><br><span class="line">    -conn:   the connection string used by the driver, the default is root:@tcp(127.0.0.1:3306)/test</span><br><span class="line"></span><br><span class="line">bee migrate rollback [-driver=mysql] [-conn=&quot;root:@tcp(127.0.0.1:3306)/test&quot;]</span><br><span class="line">    rollback the last migration operation</span><br><span class="line">    -driver: [mysql | postgresql | sqlite], the default is mysql</span><br><span class="line">    -conn:   the connection string used by the driver, the default is root:@tcp(127.0.0.1:3306)/test</span><br><span class="line"></span><br><span class="line">bee migrate reset [-driver=mysql] [-conn=&quot;root:@tcp(127.0.0.1:3306)/test&quot;]</span><br><span class="line">    rollback all migrations</span><br><span class="line">    -driver: [mysql | postgresql | sqlite], the default is mysql</span><br><span class="line">    -conn:   the connection string used by the driver, the default is root:@tcp(127.0.0.1:3306)/test</span><br><span class="line"></span><br><span class="line">bee migrate refresh [-driver=mysql] [-conn=&quot;root:@tcp(127.0.0.1:3306)/test&quot;]</span><br><span class="line">    rollback all migrations and run them all again</span><br><span class="line">    -driver: [mysql | postgresql | sqlite], the default is mysql</span><br><span class="line">    -conn:   the connection string used by the driver, the default is root:@tcp(127.0.0.1:3306)/test</span><br></pre></td></tr></table></figure>

<h1 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h1><p>beego 是一个能够进行快速开发应用的框架，快速入门将带领你快速的建立一个 beego 的项目，然后运行起来。接着修改代码，让我们了解整个 MVC 的运行机制。那么让我们开始创建项目吧！</p>
<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p>beego 的项目基本都是通过 <code>bee</code> 命令来创建的，所以在创建项目之前确保你已经安装了 bee 工具和 beego。</p>
<p>现在一切就绪我们就可以开始创建项目了，打开终端，进入 <code>$GOPATH/src</code> 所在的目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">➜  src  bee new quickstart</span><br><span class="line">[INFO] Creating application...</span><br><span class="line">/gopath/src/quickstart/</span><br><span class="line">/gopath/src/quickstart/conf/</span><br><span class="line">/gopath/src/quickstart/controllers/</span><br><span class="line">/gopath/src/quickstart/models/</span><br><span class="line">/gopath/src/quickstart/routers/</span><br><span class="line">/gopath/src/quickstart/tests/</span><br><span class="line">/gopath/src/quickstart/static/</span><br><span class="line">/gopath/src/quickstart/static/js/</span><br><span class="line">/gopath/src/quickstart/static/css/</span><br><span class="line">/gopath/src/quickstart/static/img/</span><br><span class="line">/gopath/src/quickstart/views/</span><br><span class="line">/gopath/src/quickstart/conf/app.conf</span><br><span class="line">/gopath/src/quickstart/controllers/default.go</span><br><span class="line">/gopath/src/quickstart/views/index.tpl</span><br><span class="line">/gopath/src/quickstart/routers/router.go</span><br><span class="line">/gopath/src/quickstart/tests/default_test.go</span><br><span class="line">/gopath/src/quickstart/main.go</span><br><span class="line">2014/11/06 18:17:09 [SUCC] New application successfully created!</span><br></pre></td></tr></table></figure>

<p>通过一个简单的命令就创建了一个 beego 项目。他的目录结构如下所示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">quickstart</span><br><span class="line">|-- conf</span><br><span class="line">|   `-- app.conf</span><br><span class="line">|-- controllers</span><br><span class="line">|   `-- default.go</span><br><span class="line">|-- main.go</span><br><span class="line">|-- models</span><br><span class="line">|-- routers</span><br><span class="line">|   `-- router.go</span><br><span class="line">|-- static</span><br><span class="line">|   |-- css</span><br><span class="line">|   |-- img</span><br><span class="line">|   `-- js</span><br><span class="line">|-- tests</span><br><span class="line">|   `-- default_test.go</span><br><span class="line">`-- views</span><br><span class="line">    `-- index.tpl</span><br></pre></td></tr></table></figure>

<p>从目录结构中我们也可以看出来这是一个典型的 MVC 架构的应用，<code>main.go</code> 是入口文件。</p>
<h2 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h2><p>beego 项目创建之后，我们还需要初始化<code>go.mod</code>文件。进入目录之后，使用<code>go mod init</code>初始化模块依赖。</p>
<p>接着我们就开始运行项目，首先进入创建的项目，我们使用 <code>bee run</code> 来运行该项目，这样就可以做到热编译的效果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">➜  src  cd quickstart</span><br><span class="line">➜  quickstart  bee run</span><br><span class="line">2014/11/06 18:18:34 [INFO] Uses &#x27;quickstart&#x27; as &#x27;appname&#x27;</span><br><span class="line">2014/11/06 18:18:34 [INFO] Initializing watcher...</span><br><span class="line">2014/11/06 18:18:34 [TRAC] Directory(/gopath/src/quickstart/controllers)</span><br><span class="line">2014/11/06 18:18:34 [TRAC] Directory(/gopath/src/quickstart)</span><br><span class="line">2014/11/06 18:18:34 [TRAC] Directory(/gopath/src/quickstart/routers)</span><br><span class="line">2014/11/06 18:18:34 [TRAC] Directory(/gopath/src/quickstart/tests)</span><br><span class="line">2014/11/06 18:18:34 [INFO] Start building...</span><br><span class="line">2014/11/06 18:18:35 [SUCC] Build was successful</span><br><span class="line">2014/11/06 18:18:35 [INFO] Restarting quickstart ...</span><br><span class="line">2014/11/06 18:18:35 [INFO] ./quickstart is running...</span><br><span class="line">2014/11/06 18:18:35 [app.go:96] [I] http server Running on :8080</span><br></pre></td></tr></table></figure>

<p>这样我们的应用已经在 <code>8080</code> 端口(beego 的默认端口)跑起来了.你是不是觉得很神奇，为什么没有 nginx 和 apache 居然可以自己干这个事情？是的，Go 其实已经做了网络层的东西，beego 只是封装了一下，所以可以做到不需要 nginx 和 apache。让我们打开浏览器看看效果吧：</p>
<p><img src="https://cdn.jsdelivr.net/gh/palp1tate/blog_img/img/beerun.png"></p>
<h2 id="路由设置"><a href="#路由设置" class="headerlink" title="路由设置"></a>路由设置</h2><p>前面我们已经创建了 beego 项目，而且我们也看到它已经运行起来了，那么是如何运行起来的呢？让我们从入口文件先分析起来吧：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	_ <span class="string">&quot;quickstart/routers&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/beego/beego/v2/server/web&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	web.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们看到 main 函数是入口函数，但是我们知道 Go 的执行过程是如下图所示的方式：</p>
<p><img src="https://cdn.jsdelivr.net/gh/palp1tate/blog_img/img/init.png"></p>
<p>这里我们就看到了我们引入了一个包 <code>_ &quot;quickstart/routers&quot;</code>,这个包只引入执行了里面的 init 函数，那么让我们看看这个里面做了什么事情：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> routers</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;quickstart/controllers&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/beego/beego/v2/server/web&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    web.Router(<span class="string">&quot;/&quot;</span>, &amp;controllers.MainController&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>路由包里面我们看到执行了路由注册 <code>web.Router</code>, 这个函数的功能是映射 URL 到 controller，第一个参数是 URL (用户请求的地址)，这里我们注册的是 <code>/</code>，也就是我们访问的不带任何参数的 URL，第二个参数是对应的 Controller，也就是我们即将把请求分发到那个控制器来执行相应的逻辑，我们可以执行类似的方式注册如下路由：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web.Router(<span class="string">&quot;/user&quot;</span>, &amp;controllers.UserController&#123;&#125;)</span><br></pre></td></tr></table></figure>

<p>这样用户就可以通过访问 <code>/user</code> 去执行 <code>UserController</code> 的逻辑。这就是我们所谓的路由。</p>
<p>一旦 run 起来之后，我们的服务就监听在两个端口了，一个服务端口 8080 作为对外服务，另一个 8088 端口实行对内监控。</p>
<h2 id="controller-逻辑"><a href="#controller-逻辑" class="headerlink" title="controller 逻辑"></a>controller 逻辑</h2><p>前面我们了解了如何把用户的请求分发到控制器，这小节我们就介绍大家如何来写控制器，首先我们还是从源码分析入手：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> controllers</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">        <span class="string">&quot;github.com/beego/beego/v2/server/web&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MainController <span class="keyword">struct</span> &#123;</span><br><span class="line">        web.Controller</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MainController)</span></span> Get() &#123;</span><br><span class="line">        this.Data[<span class="string">&quot;Website&quot;</span>] = <span class="string">&quot;beego.vip&quot;</span></span><br><span class="line">        this.Data[<span class="string">&quot;Email&quot;</span>] = <span class="string">&quot;astaxie@gmail.com&quot;</span></span><br><span class="line">        this.TplName = <span class="string">&quot;index.tpl&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的代码显示首先我们声明了一个控制器 <code>MainController</code>，这个控制器里面组合了 <code>web.Controller</code>，这就是 Go 的组合方式，也就是 <code>MainController</code> 自动拥有了所有 <code>web.Controller</code> 的方法。</p>
<p>而 <code>web.Controller</code> 拥有很多方法，其中包括 <code>Init</code>、<code>Prepare</code>、<code>Post</code>、<code>Get</code>、<code>Delete</code>、<code>Head</code> 等方法。我们可以通过重写的方式来实现这些方法，而我们上面的代码就是重写了 <code>Get</code> 方法。</p>
<p>我们先前介绍过 beego 是一个 RESTful 的框架，所以我们的请求默认是执行对应 <code>req.Method</code> 的方法。例如浏览器的是 <code>GET</code> 请求，那么默认就会执行 <code>MainController</code> 下的 <code>Get</code> 方法。这样我们上面的 Get 方法就会被执行到，这样就进入了我们的逻辑处理。（用户可以改变这个行为，通过注册自定义的函数名。)</p>
<p>里面的代码是需要执行的逻辑，这里只是简单的输出数据，我们可以通过各种方式获取数据，然后赋值到 <code>this.Data</code> 中，这是一个用来存储输出数据的 map，可以赋值任意类型的值，这里我们只是简单举例输出两个字符串。</p>
<p>最后一个就是需要去渲染的模板，<code>this.TplName</code> 就是需要渲染的模板，这里指定了 <code>index.tpl</code>，如果用户不设置该参数，那么默认会去到模板目录的 <code>Controller/&lt;方法名&gt;.tpl</code> 查找，例如上面的方法会去 <code>maincontroller/get.tpl</code> ***(文件、文件夹必须小写)***。</p>
<p>用户设置了模板之后系统会自动的调用 <code>Render</code> 函数（这个函数是在 <code>web.Controller</code> 中实现的），所以无需用户自己来调用渲染。</p>
<p>当然也可以不使用模版，直接用 <code>this.Ctx.WriteString</code> 输出字符串，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">func (this *MainController) Get() &#123;</span><br><span class="line">        this.Ctx.WriteString(&quot;hello&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此我们的控制器分析基本完成了，接下来让我们看看如何来编写 model。</p>
<h2 id="model-逻辑"><a href="#model-逻辑" class="headerlink" title="model 逻辑"></a>model 逻辑</h2><p>我们知道 Web 应用中我们用的最多的就是数据库操作，而 model 层一般用来做这些操作，我们的 <code>bee new</code> 例子不存在 Model 的演示，但是 <code>bee api</code> 应用中存在 model 的应用。说的简单一点，如果您的应用足够简单，那么 Controller 可以处理一切的逻辑，如果您的逻辑里面存在着可以复用的东西，那么就抽取出来变成一个模块。因此 Model 就是逐步抽象的过程，一般我们会在 Model 里面处理一些数据读取，如下是一个日志分析应用中的代码片段：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;path/filepath&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	NotPV []<span class="type">string</span> = []<span class="type">string</span>&#123;<span class="string">&quot;css&quot;</span>, <span class="string">&quot;js&quot;</span>, <span class="string">&quot;class&quot;</span>, <span class="string">&quot;gif&quot;</span>, <span class="string">&quot;jpg&quot;</span>, <span class="string">&quot;jpeg&quot;</span>, <span class="string">&quot;png&quot;</span>, <span class="string">&quot;bmp&quot;</span>, <span class="string">&quot;ico&quot;</span>, <span class="string">&quot;rss&quot;</span>, <span class="string">&quot;xml&quot;</span>, <span class="string">&quot;swf&quot;</span>&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> big = <span class="number">0xFFFFFF</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">LogPV</span><span class="params">(urls <span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	ext := filepath.Ext(urls)</span><br><span class="line">	<span class="keyword">if</span> ext == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> _, v := <span class="keyword">range</span> NotPV &#123;</span><br><span class="line">		<span class="keyword">if</span> v == strings.ToLower(ext) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以如果您的应用足够简单，那么就不需要 Model 了；如果你的模块开始多了，需要复用，需要逻辑分离了，那么 Model 是必不可少的。接下来我们将分析如何编写 View 层的东西。</p>
<h2 id="View-编写"><a href="#View-编写" class="headerlink" title="View 编写"></a>View 编写</h2><p>在前面编写 Controller 的时候，我们在 Get 里面写过这样的语句 <code>this.TplName = &quot;index.tpl&quot;</code>，设置显示的模板文件，默认支持 <code>tpl</code> 和 <code>html</code> 的后缀名，如果想设置其他后缀你可以调用 <code>beego.AddTemplateExt</code> 接口设置，那么模板如何来显示相应的数据呢？beego 采用了 Go 语言默认的模板引擎，所以和 Go 的模板语法一样，Go 模板的详细使用方法在我<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_63230155/article/details/131732504?spm=1001.2014.3001.5502">这篇文章</a>有讲解。</p>
<p>我们看看快速入门里面的代码（去掉了 css 样式）：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;Beego&lt;/title&gt;</span><br><span class="line">        &lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=utf-8&quot;</span>&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;header class=<span class="string">&quot;hero-unit&quot;</span> style=<span class="string">&quot;background-color:#A9F16C&quot;</span>&gt;</span><br><span class="line">            &lt;div class=<span class="string">&quot;container&quot;</span>&gt;</span><br><span class="line">                &lt;div class=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">                    &lt;div class=<span class="string">&quot;hero-text&quot;</span>&gt;</span><br><span class="line">                        &lt;h1&gt;Welcome to Beego!&lt;/h1&gt;</span><br><span class="line">                        &lt;p class=<span class="string">&quot;description&quot;</span>&gt;</span><br><span class="line">                            Beego is a simple &amp; powerful Go web framework which is inspired by tornado and sinatra.</span><br><span class="line">                            &lt;br /&gt;</span><br><span class="line">                            Official website: &lt;a href=<span class="string">&quot;http://&#123;&#123;.Website&#125;&#125;&quot;</span>&gt;&#123;&#123;.Website&#125;&#125;&lt;/a&gt;</span><br><span class="line">                            &lt;br /&gt;</span><br><span class="line">                            Contact me: &#123;&#123;.Email&#125;&#125;</span><br><span class="line">                        &lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/header&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>我们在 Controller 里面把数据赋值给了 data（map 类型），然后我们在模板中就直接通过 key 访问 <code>.Website</code> 和 <code>.Email</code> 。这样就做到了数据的输出。接下来我们讲解如何让静态文件输出。</p>
<h2 id="静态文件处理"><a href="#静态文件处理" class="headerlink" title="静态文件处理"></a>静态文件处理</h2><p>前面我们介绍了如何输出静态页面，但是我们的网页往往包含了很多的静态文件，包括图片、JS、CSS 等，刚才创建的应用里面就创建了如下目录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">├── static</span><br><span class="line">	│   ├── css</span><br><span class="line">	│   ├── img</span><br><span class="line">	│   └── js</span><br></pre></td></tr></table></figure>

<p>beego 默认注册了 static 目录为静态处理的目录，注册样式：URL 前缀和映射的目录（在<code>/main.go</code>文件中<code>web.Run()</code>之前加入）：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StaticDir[<span class="string">&quot;/static&quot;</span>] = <span class="string">&quot;static&quot;</span></span><br></pre></td></tr></table></figure>

<p>用户可以设置多个静态文件处理目录，例如你有多个文件下载目录 download1、download2，你可以这样映射（在 <code>/main.go</code> 文件中 <code>web.Run()</code> 之前加入）：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">web.SetStaticPath(<span class="string">&quot;/down1&quot;</span>, <span class="string">&quot;download1&quot;</span>)</span><br><span class="line">web.SetStaticPath(<span class="string">&quot;/down2&quot;</span>, <span class="string">&quot;download2&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>这样用户访问 URL <code>http://localhost:8080/down1/123.txt</code> 则会请求 download1 目录下的 123.txt 文件。</p>
<h1 id="beego-的-MVC-架构"><a href="#beego-的-MVC-架构" class="headerlink" title="beego 的 MVC 架构"></a>beego 的 MVC 架构</h1><p>beego 是一个典型的 MVC 框架，它的整个执行逻辑如下图所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/palp1tate/blog_img/img/detail.png"></p>
<p>通过文字来描述如下：</p>
<ol>
<li>在监听的端口接收数据，默认监听在 8080 端口。</li>
<li>用户请求到达 8080 端口之后进入 beego 的处理逻辑。</li>
<li>初始化 Context 对象，根据请求判断是否为 WebSocket 请求，如果是的话设置 Input，同时判断请求的方法是否在标准请求方法中（GET、POST、PUT、DELETE、PATCH、OPTIONS、HEAD），防止用户的恶意伪造请求攻击造成不必要的影响。</li>
<li>执行 BeforeRouter 过滤器，当然在 beego 里面有开关设置。如果用户设置了过滤器，那么该开关打开，这样可以提高在没有开启过滤器的情况下提高执行效率。如果在执行过滤器过程中，responseWriter 已经有数据输出了，那么就提前结束该请求，直接跳转到监控判断。</li>
<li>开始执行静态文件的处理，查看用户的请求 URL 是否和注册在静态文件处理 StaticDir 中的 prefix 是否匹配。如果匹配的话，采用 <code>http</code> 包中默认的 ServeFile 来处理静态文件。</li>
<li>如果不是静态文件开始初始化 session 模块(如果开启 session 的话)，这个里面大家需要注意，如果你的 BeforeRouter 过滤器用到了 session 就会报错，你应该把它加入到 AfterStatic 过滤器中。</li>
<li>开始执行 AfterStatic 过滤器，如果在执行过滤器过程中，responseWriter 已经有数据输出了，那么就提前结束该请求，直接跳转到监控判断。</li>
<li>执行过过滤器之后，开始从固定的路由规则中查找和请求 URL 相匹配的对象。这个匹配是全匹配规则，即如果用户请求的 URL 是 <code>/hello/world</code>，那么固定规则中 <code>/hello</code> 是不会匹配的，只有完全匹配才算匹配。如果匹配的话就进入逻辑执行，如果不匹配进入下一环节的正则匹配。</li>
<li>正则匹配是进行正则的全匹配，这个正则是按照用户添加 beego 路由顺序来进行匹配的，也就是说，如果你在添加路由的时候你的顺序影响你的匹配。和固定匹配一样，如果匹配的话就进行逻辑执行，如果不匹配进入 Auto 匹配。</li>
<li>如果用户注册了 AutoRouter，那么会通过 <code>controller/method</code> 这样的方式去查找对应的 Controller 和他内置的方法，如果找到就开始执行逻辑，如果找不到就跳转到监控判断。</li>
<li>如果找到 Controller 的话，那么就开始执行逻辑，首先执行 BeforeExec 过滤器，如果在执行过滤器过程中，responseWriter 已经有数据输出了，那么就提前结束该请求，直接跳转到监控判断。</li>
<li>Controller 开始执行 Init 函数，初始化基本的一些信息，这个函数一般都是 beego.Controller 的初始化，不建议用户继承的时候修改该函数。</li>
<li>是否开启了 XSRF，开启的话就调用 Controller 的 XsrfToken，然后如果是 POST 请求就调用 CheckXsrfCookie 方法。</li>
<li>继续执行 Controller 的 Prepare 函数，这个函数一般是预留给用户的，用来做 Controller 里面的一些参数初始化之类的工作。如果在初始化中 responseWriter 有输出，那么就直接进入 Finish 函数逻辑。</li>
<li>如果没有输出的话，那么根据用户注册的方法执行相应的逻辑，如果用户没有注册，那么就调用 http.Method 对应的方法（Get&#x2F;Post 等）。执行相应的逻辑，例如数据读取，数据赋值，模板显示之类的，或者直接输出 JSON 或者 XML。</li>
<li>如果 responseWriter 没有输出，那么就调用 Render 函数进行模板输出。</li>
<li>执行 Controller 的 Finish 函数，这个函数是预留给用户用来重写的，用于释放一些资源。释放在 Init 中初始化的信息数据。</li>
<li>执行 AfterExec 过滤器，如果有输出的话就跳转到监控判断逻辑。</li>
<li>执行 Controller 的 Destructor，用于释放 Init 中初始化的一些数据。</li>
<li>如果这一路执行下来都没有找到路由，那么会调用 404 显示找不到该页面。</li>
<li>最后所有的逻辑都汇聚到了监控判断，如果用户开启了监控模块（默认是开启一个 8088 端口用于进程内监控），这样就会把访问的请求链接扔给监控程序去记录当前访问的 QPS，对应的链接访问的执行时间，请求链接等。</li>
</ol>
<h1 id="controller-设计"><a href="#controller-设计" class="headerlink" title="controller 设计"></a>controller 设计</h1><h2 id="参数配置"><a href="#参数配置" class="headerlink" title="参数配置"></a>参数配置</h2><p>beego 目前支持 INI、XML、JSON、YAML 格式的配置文件解析，但是默认采用了 INI 格式解析，用户可以通过简单的配置就可以获得很大的灵活性。</p>
<h3 id="默认配置解析"><a href="#默认配置解析" class="headerlink" title="默认配置解析"></a>默认配置解析</h3><p>beego 默认会解析当前应用下的 <code>conf/app.conf</code> 文件。</p>
<p>通过这个文件你可以初始化很多 beego 的默认参数：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">appname = beepkg</span><br><span class="line">httpaddr = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">httpport = <span class="number">9090</span></span><br><span class="line">runmode =<span class="string">&quot;dev&quot;</span></span><br><span class="line">autorender = <span class="literal">false</span></span><br><span class="line">recoverpanic = <span class="literal">false</span></span><br><span class="line">viewspath = <span class="string">&quot;myview&quot;</span></span><br></pre></td></tr></table></figure>

<p>它们都维护在结构体 <code>beego/server/web#Config</code> 。</p>
<p>BConfig 就是 beego 里面的默认的配置，也是结构体 <code>beego/server/web#Config</code> 的实例。</p>
<p>你也可以直接通过<code>web.BConfig.AppName=&quot;beepkg&quot;</code>这样来修改，和上面的配置效果一样，只是一个在代码里面写死了，而配置文件就会显得更加灵活。</p>
<p>你也可以在配置文件中配置应用需要用的一些配置信息，例如下面所示的数据库信息：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysqluser = <span class="string">&quot;root&quot;</span></span><br><span class="line">mysqlpass = <span class="string">&quot;rootpass&quot;</span></span><br><span class="line">mysqlurls = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">mysqldb   = <span class="string">&quot;beego&quot;</span></span><br></pre></td></tr></table></figure>

<p>那么你就可以通过如下的方式获取设置的配置信息:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">web.AppConfig.String(<span class="string">&quot;mysqluser&quot;</span>)</span><br><span class="line">web.AppConfig.String(<span class="string">&quot;mysqlpass&quot;</span>)</span><br><span class="line">web.AppConfig.String(<span class="string">&quot;mysqlurls&quot;</span>)</span><br><span class="line">web.AppConfig.String(<span class="string">&quot;mysqldb&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="不同级别的配置"><a href="#不同级别的配置" class="headerlink" title="不同级别的配置"></a>不同级别的配置</h3><p>在配置文件里面支持 section，可以有不同的 Runmode 的配置，默认优先读取 runmode 下的配置信息，例如下面的配置文件：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">appname = beepkg</span><br><span class="line">httpaddr = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">httpport = <span class="number">9090</span></span><br><span class="line">runmode =<span class="string">&quot;dev&quot;</span></span><br><span class="line">autorender = <span class="literal">false</span></span><br><span class="line">recoverpanic = <span class="literal">false</span></span><br><span class="line">viewspath = <span class="string">&quot;myview&quot;</span></span><br><span class="line"></span><br><span class="line">[dev]</span><br><span class="line">httpport = <span class="number">8080</span></span><br><span class="line">[prod]</span><br><span class="line">httpport = <span class="number">8088</span></span><br><span class="line">[test]</span><br><span class="line">httpport = <span class="number">8888</span></span><br></pre></td></tr></table></figure>

<p>上面的配置文件就是在不同的 runmode 下解析不同的配置，例如在 dev 模式下，httpport 是 8080，在 prod 模式下是 8088，在 test 模式下是 8888。其他配置文件同理。解析的时候优先解析 runmode 下的配置，然后解析默认的配置。</p>
<h3 id="多个配置文件"><a href="#多个配置文件" class="headerlink" title="多个配置文件"></a>多个配置文件</h3><p>INI 格式配置支持 <code>include</code> 方式，引用多个配置文件，例如下面的两个配置文件效果同上：</p>
<p>app.conf</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">appname = beepkg</span><br><span class="line">httpaddr = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">httpport = <span class="number">9090</span></span><br><span class="line"></span><br><span class="line">include <span class="string">&quot;app2.conf&quot;</span></span><br></pre></td></tr></table></figure>

<p>app2.conf</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">runmode =<span class="string">&quot;dev&quot;</span></span><br><span class="line">autorender = <span class="literal">false</span></span><br><span class="line">recoverpanic = <span class="literal">false</span></span><br><span class="line">viewspath = <span class="string">&quot;myview&quot;</span></span><br><span class="line"></span><br><span class="line">[dev]</span><br><span class="line">httpport = <span class="number">8080</span></span><br><span class="line">[prod]</span><br><span class="line">httpport = <span class="number">8088</span></span><br><span class="line">[test]</span><br><span class="line">httpport = <span class="number">8888</span></span><br></pre></td></tr></table></figure>

<p>关于系统的默认参数，参考官方文档：<a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/?p=mvc/controller/config.md">https://git-books.github.io/books/beego/?p=mvc/controller/config.md</a></p>
<h2 id="路由设置-1"><a href="#路由设置-1" class="headerlink" title="路由设置"></a>路由设置</h2><h3 id="基础路由"><a href="#基础路由" class="headerlink" title="基础路由"></a>基础路由</h3><p>从 beego 1.2 版本开始支持了基本的 RESTful 函数式路由,应用中的大多数路由都会定义在 <code>routers/router.go</code> 文件中。最简单的 beego 路由由 URI 和闭包函数组成。</p>
<h4 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">web.Get(<span class="string">&quot;/&quot;</span>,<span class="function"><span class="keyword">func</span><span class="params">(ctx *context.Context)</span></span>&#123;</span><br><span class="line">     ctx.Output.Body([]<span class="type">byte</span>(<span class="string">&quot;hello world&quot;</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">web.Post(<span class="string">&quot;/alice&quot;</span>,<span class="function"><span class="keyword">func</span><span class="params">(ctx *context.Context)</span></span>&#123;</span><br><span class="line">     ctx.Output.Body([]<span class="type">byte</span>(<span class="string">&quot;bob&quot;</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="响应任何-HTTP-的路由"><a href="#响应任何-HTTP-的路由" class="headerlink" title="响应任何 HTTP 的路由"></a>响应任何 HTTP 的路由</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">web.Any(<span class="string">&quot;/foo&quot;</span>,<span class="function"><span class="keyword">func</span><span class="params">(ctx *context.Context)</span></span>&#123;</span><br><span class="line">     ctx.Output.Body([]<span class="type">byte</span>(<span class="string">&quot;bar&quot;</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="支持的基础函数"><a href="#支持的基础函数" class="headerlink" title="支持的基础函数"></a>支持的基础函数</h4><ul>
<li>web.Get(router, web.HandleFunc)</li>
<li>web.Post(router, web.HandleFunc)</li>
<li>web.Put(router, web.HandleFunc)</li>
<li>web.Patch(router, web.HandleFunc)</li>
<li>web.Head(router, web.HandleFunc)</li>
<li>web.Options(router, web.HandleFunc)</li>
<li>web.Delete(router, web.HandleFunc)</li>
<li>web.Any(router, web.HandleFunc)</li>
</ul>
<h3 id="固定路由"><a href="#固定路由" class="headerlink" title="固定路由"></a>固定路由</h3><p>固定路由也就是全匹配的路由，如下所示：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">web.Router(<span class="string">&quot;/&quot;</span>, &amp;controllers.MainController&#123;&#125;)</span><br><span class="line">web.Router(<span class="string">&quot;/admin&quot;</span>, &amp;admin.UserController&#123;&#125;)</span><br><span class="line">web.Router(<span class="string">&quot;/admin/index&quot;</span>, &amp;admin.ArticleController&#123;&#125;)</span><br><span class="line">web.Router(<span class="string">&quot;/admin/addpkg&quot;</span>, &amp;admin.AddController&#123;&#125;)</span><br></pre></td></tr></table></figure>

<p>如上所示的路由就是我们最常用的路由方式，一个固定的路由，一个控制器，然后根据用户请求方法不同请求控制器中对应的方法，典型的 RESTful 方式。</p>
<h3 id="正则路由"><a href="#正则路由" class="headerlink" title="正则路由"></a>正则路由</h3><p>为了用户更加方便的路由设置，beego 参考了 sinatra 的路由实现，支持多种方式的路由：</p>
<ul>
<li><p>web.Router(“&#x2F;api&#x2F;?:id”, &amp;controllers.RController{})</p>
<p>默认匹配 &#x2F;&#x2F;例如对于URL”&#x2F;api&#x2F;123”可以匹配成功，此时变量”:id”值为”123”，URL”&#x2F;api&#x2F;“可正常匹配</p>
</li>
<li><p>web.Router(“&#x2F;api&#x2F;:id”, &amp;controllers.RController{})</p>
<p>默认匹配 &#x2F;&#x2F;例如对于URL”&#x2F;api&#x2F;123”可以匹配成功，此时变量”:id”值为”123”，但URL”&#x2F;api&#x2F;“匹配失败</p>
</li>
<li><p>web.Router(“&#x2F;api&#x2F;:id([0-9]+)”, &amp;controllers.RController{})</p>
<p>自定义正则匹配 &#x2F;&#x2F;例如对于URL”&#x2F;api&#x2F;123”可以匹配成功，此时变量”:id”值为”123”</p>
</li>
<li><p>web.Router(“&#x2F;user&#x2F;:username([\w]+)”, &amp;controllers.RController{})</p>
<p>正则字符串匹配 &#x2F;&#x2F;例如对于URL”&#x2F;user&#x2F;astaxie”可以匹配成功，此时变量”:username”值为”astaxie”</p>
</li>
<li><p>web.Router(“&#x2F;download&#x2F;<em>.</em>“, &amp;controllers.RController{})</p>
<p>*匹配方式 &#x2F;&#x2F;例如对于URL”&#x2F;download&#x2F;file&#x2F;api.xml”可以匹配成功，此时变量”:path”值为”file&#x2F;api”， “:ext”值为”xml”</p>
</li>
<li><p>web.Router(“&#x2F;download&#x2F;ceshi&#x2F;*”, &amp;controllers.RController{})</p>
<p>*全匹配方式 &#x2F;&#x2F;例如对于URL”&#x2F;download&#x2F;ceshi&#x2F;file&#x2F;api.json”可以匹配成功，此时变量”:splat”值为”file&#x2F;api.json”</p>
</li>
<li><p>web.Router(“&#x2F;:id:int”, &amp;controllers.RController{})</p>
<p>int 类型设置方式，匹配 :id为int 类型，框架帮你实现了正则 ([0-9]+)</p>
</li>
<li><p>web.Router(“&#x2F;:hi:string”, &amp;controllers.RController{})</p>
<p>string 类型设置方式，匹配 :hi 为 string 类型。框架帮你实现了正则 ([\w]+)</p>
</li>
<li><p>web.Router(“&#x2F;cms_:id([0-9]+).html”, &amp;controllers.CmsController{})</p>
<p>带有前缀的自定义正则 &#x2F;&#x2F;匹配 :id 为正则类型。匹配 cms_123.html 这样的 url :id &#x3D; 123</p>
</li>
</ul>
<p>可以在 Controller 中通过如下方式获取上面的变量：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">this.Ctx.Input.Param(<span class="string">&quot;:id&quot;</span>)</span><br><span class="line">this.Ctx.Input.Param(<span class="string">&quot;:username&quot;</span>)</span><br><span class="line">this.Ctx.Input.Param(<span class="string">&quot;:splat&quot;</span>)</span><br><span class="line">this.Ctx.Input.Param(<span class="string">&quot;:path&quot;</span>)</span><br><span class="line">this.Ctx.Input.Param(<span class="string">&quot;:ext&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="自定义方法及-RESTful-规则"><a href="#自定义方法及-RESTful-规则" class="headerlink" title="自定义方法及 RESTful 规则"></a>自定义方法及 RESTful 规则</h3><p>上面列举的是默认的请求方法名（请求的 method 和函数名一致，例如 <code>GET</code> 请求执行 <code>Get</code> 函数，<code>POST</code> 请求执行 <code>Post</code> 函数），如果用户期望自定义函数名，那么可以使用如下方式：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web.Router(<span class="string">&quot;/&quot;</span>,&amp;IndexController&#123;&#125;,<span class="string">&quot;*:Index&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>使用第三个参数，第三个参数就是用来设置对应 method 到函数名，定义如下</p>
<ul>
<li><code>*</code>表示任意的 method 都执行该函数</li>
<li>使用 httpmethod:funcname 格式来展示</li>
<li>多个不同的格式使用 <code>;</code> 分割</li>
<li>多个 method 对应同一个 funcname，method 之间通过 <code>,</code> 来分割</li>
</ul>
<p>以下是一个 RESTful 的设计示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">web.Router(<span class="string">&quot;/api/food&quot;</span>,&amp;RestController&#123;&#125;,<span class="string">&quot;get:ListFood&quot;</span>)</span><br><span class="line">web.Router(<span class="string">&quot;/api/food&quot;</span>,&amp;RestController&#123;&#125;,<span class="string">&quot;post:CreateFood&quot;</span>)</span><br><span class="line">web.Router(<span class="string">&quot;/api/food&quot;</span>,&amp;RestController&#123;&#125;,<span class="string">&quot;put:UpdateFood&quot;</span>)</span><br><span class="line">web.Router(<span class="string">&quot;/api/food&quot;</span>,&amp;RestController&#123;&#125;,<span class="string">&quot;delete:DeleteFood&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>以下是多个 HTTP Method 指向同一个函数的示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web.Router(<span class="string">&quot;/api&quot;</span>,&amp;RestController&#123;&#125;,<span class="string">&quot;get,post:ApiFunc&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>以下是不同的 method 对应不同的函数，通过 ; 进行分割的示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web.Router(<span class="string">&quot;/api/food&quot;</span>,&amp;RestController&#123;&#125;,<span class="string">&quot;get:ListFood;post:CreateFood;put:UpdateFood;delete:DeleteFood&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>可用的 HTTP Method：</p>
<ul>
<li>*: 包含以下所有的函数</li>
<li>get: GET 请求</li>
<li>post: POST 请求</li>
<li>put: PUT 请求</li>
<li>delete: DELETE 请求</li>
<li>patch: PATCH 请求</li>
<li>options: OPTIONS 请求</li>
<li>head: HEAD 请求</li>
</ul>
<p>如果同时存在 * 和对应的 HTTP Method，那么优先执行 HTTP Method 的方法，例如同时注册了如下所示的路由：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web.Router(<span class="string">&quot;/simple&quot;</span>,&amp;SimpleController&#123;&#125;,<span class="string">&quot;*:AllFunc;post:PostFunc&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>那么执行 <code>POST</code> 请求的时候，执行 <code>PostFunc</code> 而不执行 <code>AllFunc</code>。</p>
<blockquote>
<blockquote>
<blockquote>
<p>自定义函数的路由默认不支持 RESTful 的方法，也就是如果你设置了 <code>web.Router(&quot;/api&quot;,&amp;RestController&#123;&#125;,&quot;post:ApiFunc&quot;)</code> 这样的路由，如果请求的方法是 <code>POST</code>，那么不会默认去执行 <code>Post</code> 函数。</p>
</blockquote>
</blockquote>
</blockquote>
<h3 id="自动匹配"><a href="#自动匹配" class="headerlink" title="自动匹配"></a>自动匹配</h3><p>用户首先需要把需要路由的控制器注册到自动路由中：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web.AutoRouter(&amp;controllers.ObjectController&#123;&#125;)</span><br></pre></td></tr></table></figure>

<p>那么 beego 就会通过反射获取该结构体中所有的实现方法，你就可以通过如下的方式访问到对应的方法中：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/object/login   调用 ObjectController 中的 Login 方法</span><br><span class="line">/object/logout  调用 ObjectController 中的 Logout 方法</span><br></pre></td></tr></table></figure>

<p>除了前缀两个 <code>/:controller/:method</code> 的匹配之外，剩下的 url beego 会帮你自动化解析为参数，保存在 <code>this.Ctx.Input.Params</code> 当中：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/object/blog/<span class="number">2013</span>/<span class="number">09</span>/<span class="number">12</span>  调用 ObjectController 中的 Blog 方法，参数如下：<span class="keyword">map</span>[<span class="number">0</span>:<span class="number">2013</span> <span class="number">1</span>:<span class="number">09</span> <span class="number">2</span>:<span class="number">12</span>]</span><br></pre></td></tr></table></figure>

<p>方法名在内部是保存了用户设置的，例如 Login，url 匹配的时候都会转化为小写，所以，<code>/object/LOGIN</code> 这样的 <code>url</code> 也一样可以路由到用户定义的 <code>Login</code> 方法中。</p>
<p>现在已经可以通过自动识别出来下面类似的所有 url，都会把请求分发到 <code>controller</code> 的 <code>simple</code> 方法：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/controller/simple</span><br><span class="line">/controller/simple.html</span><br><span class="line">/controller/simple.json</span><br><span class="line">/controller/simple.xml</span><br></pre></td></tr></table></figure>

<p>可以通过 <code>this.Ctx.Input.Param(&quot;:ext&quot;)</code> 获取后缀名。</p>
<h3 id="注解路由"><a href="#注解路由" class="headerlink" title="注解路由"></a>注解路由</h3><p>从2.0开始，我们使用配置<code>CommentRouterPath</code>来配置注解路由的扫描路径。在<code>dev</code>环境下，我们将自动扫描该配置指向的目录及其子目录，生成路由文件。</p>
<p>生成之后，用户需要显示 Include 相应的 controller。注意， controller 的 method 方法上面须有 router 注释（&#x2F;&#x2F; @router），详细的使用请看下面的例子：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CMS API</span></span><br><span class="line"><span class="keyword">type</span> CMSController <span class="keyword">struct</span> &#123;</span><br><span class="line">	web.Controller</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *CMSController)</span></span> URLMapping() &#123;</span><br><span class="line">	c.Mapping(<span class="string">&quot;StaticBlock&quot;</span>, c.StaticBlock)</span><br><span class="line">	c.Mapping(<span class="string">&quot;AllBlock&quot;</span>, c.AllBlock)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// @router /staticblock/:key [get]</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *CMSController)</span></span> StaticBlock() &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @router /all/:key [get]</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *CMSController)</span></span> AllBlock() &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以在 <code>router.go</code> 中通过如下方式注册路由：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web.Include(&amp;CMSController&#123;&#125;)</span><br></pre></td></tr></table></figure>

<p>web 自动会进行源码分析，注意只会在 dev 模式下进行生成，生成的路由放在 “&#x2F;routers&#x2F;commentsRouter.go” 文件中。</p>
<p>这样上面的路由就支持了如下的路由：</p>
<ul>
<li>GET &#x2F;staticblock&#x2F;:key</li>
<li>GET &#x2F;all&#x2F;:key</li>
</ul>
<p>其实效果和自己通过 Router 函数注册是一样的：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">web.Router(<span class="string">&quot;/staticblock/:key&quot;</span>, &amp;CMSController&#123;&#125;, <span class="string">&quot;get:StaticBlock&quot;</span>)</span><br><span class="line">web.Router(<span class="string">&quot;/all/:key&quot;</span>, &amp;CMSController&#123;&#125;, <span class="string">&quot;get:AllBlock&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>同时大家注意到新版本里面增加了 URLMapping 这个函数，这是新增加的函数，用户如果没有进行注册，那么就会通过反射来执行对应的函数，如果注册了就会通过 interface 来进行执行函数，性能上面会提升很多。</p>
<h3 id="方法表达式路由"><a href="#方法表达式路由" class="headerlink" title="方法表达式路由"></a>方法表达式路由</h3><p>方法表达式路由与上面的RESTful基本相似，区别是无需在传入http method和controller方法（如：<code>&quot;get:StaticBlock&quot;</code>）。<br>只需要通过golang的method expression进行传入方法表达式。如果方法是receiver是非指针，则直接使用 <code>包名.Controller.Method</code> 方法 传入，<br>如果receiver是指针，则使用 <code>(*包名.Controller).Method</code> 进行传参。假如在同包下，包名可进行省略。</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> BaseController <span class="keyword">struct</span> &#123;</span><br><span class="line">	web.Controller</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b BaseController)</span></span> Ping() &#123;</span><br><span class="line">	b.Data[<span class="string">&quot;json&quot;</span>] = <span class="string">&quot;pong&quot;</span></span><br><span class="line">	b.ServeJSON()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *BaseController)</span></span> PingPointer() &#123;</span><br><span class="line">	b.Data[<span class="string">&quot;json&quot;</span>] = <span class="string">&quot;pong_pointer&quot;</span></span><br><span class="line">	b.ServeJSON()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	web.CtrlGet(<span class="string">&quot;/ping&quot;</span>, BaseController.Ping)</span><br><span class="line">	web.CtrlGet(<span class="string">&quot;/ping_pointer&quot;</span>, (*BaseController).PingPointer)</span><br><span class="line">	web.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>共有以下几种函数：</p>
<ul>
<li>web.CtrlGet(router, pkg.controller.method)</li>
<li>web.CtrlPost(router, pkg.controller.method)</li>
<li>web.CtrlPut(router, pkg.controller.method)</li>
<li>web.CtrlPatch(router, pkg.controller.method)</li>
<li>web.CtrlHead(router, pkg.controller.method)</li>
<li>web.CtrlOptions(router, pkg.controller.method)</li>
<li>web.CtrlDelete(router, pkg.controller.method)</li>
<li>web.CtrlAny(router, pkg.controller.method)</li>
</ul>
<h2 id="控制器函数"><a href="#控制器函数" class="headerlink" title="控制器函数"></a>控制器函数</h2><h3 id="控制器介绍"><a href="#控制器介绍" class="headerlink" title="控制器介绍"></a>控制器介绍</h3><p>基于 beego 的 Controller 设计，只需要匿名组合 <code>beego.Controller</code> 就可以了，如下所示：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> your_package</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/beego/beego/v2/server/web&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> xxxController <span class="keyword">struct</span> &#123;</span><br><span class="line">	    web.Controller</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="控制器方法"><a href="#控制器方法" class="headerlink" title="控制器方法"></a>控制器方法</h3><p><code>web.Controller</code> 实现了接口 <code>web.ControllerInterface</code>，<code>web.ControllerInterface</code> 定义了如下函数：</p>
<ul>
<li><p>Init(ctx *context.Context, controllerName, actionName string, app interface{})</p>
<p>这个函数主要初始化了 Context、相应的 Controller 名称，模板名，初始化模板参数的容器 Data，app 即为当前执行的 Controller 的 reflecttype，这个 app 可以用来执行子类的方法。</p>
</li>
<li><p>Prepare()</p>
<p>这个函数主要是为了用户扩展用的，这个函数会在下面定义的这些 Method 方法之前执行，用户可以重写这个函数实现类似用户验证之类。</p>
</li>
<li><p>Get()</p>
<p>如果用户请求的 HTTP Method 是 GET，那么就执行该函数，默认是 405，用户继承的子 struct 中可以实现了该方法以处理 Get 请求。</p>
</li>
<li><p>Post()</p>
<p>如果用户请求的 HTTP Method 是 POST，那么就执行该函数，默认是 405，用户继承的子 struct 中可以实现了该方法以处理 Post 请求。</p>
</li>
<li><p>Delete()</p>
<p>如果用户请求的 HTTP Method 是 DELETE，那么就执行该函数，默认是 405，用户继承的子 struct 中可以实现了该方法以处理 Delete 请求。</p>
</li>
<li><p>Put()</p>
<p>如果用户请求的 HTTP Method 是 PUT，那么就执行该函数，默认是 405，用户继承的子 struct 中可以实现了该方法以处理 Put 请求.</p>
</li>
<li><p>Head()</p>
<p>如果用户请求的 HTTP Method 是 HEAD，那么就执行该函数，默认是 405，用户继承的子 struct 中可以实现了该方法以处理 Head 请求。</p>
</li>
<li><p>Patch()</p>
<p>如果用户请求的 HTTP Method 是 PATCH，那么就执行该函数，默认是 405，用户继承的子 struct 中可以实现了该方法以处理 Patch 请求.</p>
</li>
<li><p>Options()</p>
<p>如果用户请求的HTTP Method是OPTIONS，那么就执行该函数，默认是 405，用户继承的子 struct 中可以实现了该方法以处理 Options 请求。</p>
</li>
<li><p>Finish()</p>
<p>这个函数是在执行完相应的 HTTP Method 方法之后执行的，默认是空，用户可以在子 struct 中重写这个函数，执行例如数据库关闭，清理数据之类的工作。</p>
</li>
<li><p>Render() error</p>
<p>这个函数主要用来实现渲染模板，如果 beego.AutoRender 为 true 的情况下才会执行。</p>
</li>
<li><p>Redirect(url string, code int)</p>
<p>重定向。<code>url</code>是目的地址。</p>
</li>
</ul>
<h3 id="子类扩展"><a href="#子类扩展" class="headerlink" title="子类扩展"></a>子类扩展</h3><p>通过子 struct 的方法重写，用户就可以实现自己的逻辑，接下来我们看一个实际的例子：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> AddController <span class="keyword">struct</span> &#123;</span><br><span class="line">    web.Controller</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *AddController)</span></span> Prepare() &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *AddController)</span></span> Get() &#123;</span><br><span class="line">    this.Data[<span class="string">&quot;content&quot;</span>] = <span class="string">&quot;value&quot;</span></span><br><span class="line">    this.Layout = <span class="string">&quot;admin/layout.html&quot;</span></span><br><span class="line">    this.TplName = <span class="string">&quot;admin/add.tpl&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *AddController)</span></span> Post() &#123;</span><br><span class="line">    pkgname := this.GetString(<span class="string">&quot;pkgname&quot;</span>)</span><br><span class="line">    content := this.GetString(<span class="string">&quot;content&quot;</span>)</span><br><span class="line">    pk := models.GetCruPkg(pkgname)</span><br><span class="line">    <span class="keyword">if</span> pk.Id == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> pp models.PkgEntity</span><br><span class="line">        pp.Pid = <span class="number">0</span></span><br><span class="line">        pp.Pathname = pkgname</span><br><span class="line">        pp.Intro = pkgname</span><br><span class="line">        models.InsertPkg(pp)</span><br><span class="line">        pk = models.GetCruPkg(pkgname)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> at models.Article</span><br><span class="line">    at.Pkgid = pk.Id</span><br><span class="line">    at.Content = content</span><br><span class="line">    models.InsertArticle(at)</span><br><span class="line">    this.Ctx.Redirect(<span class="number">302</span>, <span class="string">&quot;/admin/index&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从上面的例子可以看出来，通过重写方法可以实现对应 method 的逻辑，实现 RESTFul 结构的逻辑处理。</p>
<h3 id="提前终止运行"><a href="#提前终止运行" class="headerlink" title="提前终止运行"></a>提前终止运行</h3><p>我们应用中经常会遇到这样的情况，在 Prepare 阶段进行判断，如果用户认证不通过，就输出一段信息，然后直接中止进程，之后的 Post、Get 之类的不再执行，那么如何终止呢？可以使用 <code>StopRun</code> 来终止执行逻辑，可以在任意的地方执行。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> RController <span class="keyword">struct</span> &#123;</span><br><span class="line">    beego.Controller</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *RController)</span></span> Prepare() &#123;</span><br><span class="line">    this.Data[<span class="string">&quot;json&quot;</span>] = <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;astaxie&quot;</span>&#125;</span><br><span class="line">    this.ServeJSON()</span><br><span class="line">    this.StopRun()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<blockquote>
<p>调用 StopRun 之后，如果你还定义了 Finish 函数就不会再执行，如果需要释放资源，那么请自己在调用 StopRun 之前手工调用 Finish 函数。</p>
</blockquote>
</blockquote>
</blockquote>
<h2 id="XSRF-过滤"><a href="#XSRF-过滤" class="headerlink" title="XSRF 过滤"></a>XSRF 过滤</h2><h3 id="跨站请求伪造"><a href="#跨站请求伪造" class="headerlink" title="跨站请求伪造"></a>跨站请求伪造</h3><p><a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">跨站请求伪造(Cross-site request forgery)</a>， 简称为 XSRF，是 Web 应用中常见的一个安全问题。前面的链接也详细讲述了 XSRF 攻击的实现方式。</p>
<p>当前防范 XSRF 的一种通用的方法，是对每一个用户都记录一个无法预知的 cookie 数据，然后要求所有提交的请求（POST&#x2F;PUT&#x2F;DELETE）中都必须带有这个 cookie 数据。如果此数据不匹配 ，那么这个请求就可能是被伪造的。</p>
<p>beego 有内建的 XSRF 的防范机制，要使用此机制，你需要在应用配置文件中加上 <code>enablexsrf</code> 设定：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">enablexsrf = <span class="literal">true</span></span><br><span class="line">xsrfkey = <span class="number">61</span>oETzKXQAGaYdkL5gEmGeJJFuYh7EQnp2XdTP1o</span><br><span class="line">xsrfexpire = <span class="number">3600</span></span><br></pre></td></tr></table></figure>

<p>或者直接在 main 入口处这样设置：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">web.EnableXSRF = <span class="literal">true</span></span><br><span class="line">web.XSRFKEY = <span class="string">&quot;61oETzKXQAGaYdkL5gEmGeJJFuYh7EQnp2XdTP1o&quot;</span></span><br><span class="line">web.XSRFExpire = <span class="number">3600</span>  <span class="comment">//过期时间，默认1小时</span></span><br></pre></td></tr></table></figure>

<p>如果开启了 XSRF，那么 beego 的 Web 应用将对所有用户设置一个 <code>_xsrf</code> 的 cookie 值（默认过期 1 小时），如果 <code>POST PUT DELET</code> 请求中没有这个 cookie 值，那么这个请求会被直接拒绝。如果你开启了这个机制，那么在所有被提交的表单中，你都需要加上一个域来提供这个值。你可以通过在模板中使用 专门的函数 <code>XSRFFormHTML()</code> 来做到这一点：</p>
<p>过期时间上面我们设置了全局的过期时间 <code>web.XSRFExpire</code>，但是有些时候我们也可以在控制器中修改这个过期时间，专门针对某一类处理逻辑：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *HomeController)</span></span> Get()&#123;</span><br><span class="line">	this.XSRFExpire = <span class="number">7200</span></span><br><span class="line">	this.Data[<span class="string">&quot;xsrfdata&quot;</span>]=template.HTML(this.XSRFFormHTML())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="支持controller-级别的屏蔽"><a href="#支持controller-级别的屏蔽" class="headerlink" title="支持controller 级别的屏蔽"></a>支持controller 级别的屏蔽</h3><p>XSRF 之前是全局设置的一个参数,如果设置了那么所有的 API 请求都会进行验证,但是有些时候API 逻辑是不需要进行验证的,因此现在支持在controller 级别设置屏蔽:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> AdminController <span class="keyword">struct</span>&#123;</span><br><span class="line">	web.Controller</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *AdminController)</span></span> Prepare() &#123;</span><br><span class="line">	a.EnableXSRF = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="请求数据处理"><a href="#请求数据处理" class="headerlink" title="请求数据处理"></a>请求数据处理</h2><h3 id="获取参数"><a href="#获取参数" class="headerlink" title="获取参数"></a>获取参数</h3><p>我们经常需要获取用户传递的数据，包括 Get、POST 等方式的请求，beego 里面会自动解析这些数据，你可以通过如下方式获取数据：</p>
<ul>
<li>GetString(key string) string</li>
<li>GetStrings(key string) []string</li>
<li>GetInt(key string) (int64, error)</li>
<li>GetBool(key string) (bool, error)</li>
<li>GetFloat(key string) (float64, error)</li>
</ul>
<p>使用例子如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MainController)</span></span> Post() &#123;</span><br><span class="line">	jsoninfo := this.GetString(<span class="string">&quot;jsoninfo&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> jsoninfo == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">		this.Ctx.WriteString(<span class="string">&quot;jsoninfo is empty&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果你需要的数据可能是其他类型的，例如是 int 类型而不是 int64，那么你需要这样处理：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MainController)</span></span> Post() &#123;</span><br><span class="line">	id := this.Input().Get(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">	intid, err := strconv.Atoi(id)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>更多其他的 request 的信息，用户可以通过 <code>this.Ctx.Request</code> 获取信息。</p>
<h3 id="直接解析到-struct"><a href="#直接解析到-struct" class="headerlink" title="直接解析到 struct"></a>直接解析到 struct</h3><p>如果要把表单里的内容赋值到一个 struct 里，除了用上面的方法一个一个获取再赋值外，beego 提供了通过另外一个更便捷的方式，就是通过 struct 的字段名或 tag 与表单字段对应直接解析到 struct。</p>
<p>定义 struct：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> user <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id    <span class="type">int</span>         <span class="string">`form:&quot;-&quot;`</span></span><br><span class="line">	Name  <span class="keyword">interface</span>&#123;&#125; <span class="string">`form:&quot;username&quot;`</span></span><br><span class="line">	Age   <span class="type">int</span>         <span class="string">`form:&quot;age&quot;`</span></span><br><span class="line">	Email <span class="type">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>表单：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">	名字：<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span><br><span class="line">	年龄：<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span><br><span class="line">	邮箱：<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;Email&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Controller 里解析：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MainController)</span></span> Post() &#123;</span><br><span class="line">	u := user&#123;&#125;</span><br><span class="line">	<span class="keyword">if</span> err := this.ParseForm(&amp;u); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="comment">//handle error</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ul>
<li>StructTag form 的定义和 <a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/view/view.md">renderform方法</a> 共用一个标签</li>
<li>定义 struct 时，字段名后如果有 form 这个 tag，则会以把 form 表单里的 name 和 tag 的名称一样的字段赋值给这个字段，否则就会把 form 表单里与字段名一样的表单内容赋值给这个字段。如上面例子中，会把表单中的 username 和 age 分别赋值给 user 里的 Name 和 Age 字段，而 Email 里的内容则会赋给 Email 这个字段。</li>
<li>调用 Controller ParseForm 这个方法的时候，传入的参数必须为一个 struct 的指针，否则对 struct 的赋值不会成功并返回 <code>xx must be a struct pointer</code> 的错误。</li>
<li>如果要忽略一个字段，有两种办法，一是：字段名小写开头，二是：<code>form</code> 标签的值设置为 <code>-</code></li>
</ul>
<h3 id="获取-Request-Body-里的内容"><a href="#获取-Request-Body-里的内容" class="headerlink" title="获取 Request Body 里的内容"></a>获取 Request Body 里的内容</h3><p>在 API 的开发中，我们经常会用到 <code>JSON</code> 或 <code>XML</code> 来作为数据交互的格式，如何在 beego 中获取 Request Body 里的 JSON 或 XML 的数据呢？</p>
<ol>
<li>在配置文件里设置 <code>copyrequestbody = true</code></li>
<li>在 Controller 中</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *ObjectController)</span></span> Post() &#123;</span><br><span class="line">	<span class="keyword">var</span> ob models.Object</span><br><span class="line">	<span class="keyword">var</span> err <span class="type">error</span></span><br><span class="line">	<span class="keyword">if</span> err = json.Unmarshal(this.Ctx.Input.RequestBody, &amp;ob); err == <span class="literal">nil</span> &#123;</span><br><span class="line">	    objectid := models.AddOne(ob)</span><br><span class="line">	    this.Data[<span class="string">&quot;json&quot;</span>] = <span class="string">&quot;&#123;\&quot;ObjectId\&quot;:\&quot;&quot;</span> + objectid + <span class="string">&quot;\&quot;&#125;&quot;</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	    this.Data[<span class="string">&quot;json&quot;</span>] = err.Error()</span><br><span class="line">	&#125;</span><br><span class="line">	this.ServeJSON()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><p>在 beego 中你可以很容易的处理文件上传，就是别忘记在你的 form 表单中增加这个属性 <code>enctype=&quot;multipart/form-data&quot;</code>，否则你的浏览器不会传输你的上传文件。</p>
<p>文件上传之后一般是放在系统的内存里面，如果文件的 size 大于设置的缓存内存大小，那么就放在临时文件中，默认的缓存内存是 64M，你可以通过如下来调整这个缓存内存大小:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web.MaxMemory = <span class="number">1</span>&lt;&lt;<span class="number">22</span></span><br></pre></td></tr></table></figure>

<p>或者在配置文件中通过如下设置：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxmemory = <span class="number">1</span>&lt;&lt;<span class="number">22</span></span><br></pre></td></tr></table></figure>

<p>与此同时，beego 提供了另外一个参数，<code>MaxUploadSize</code>来限制最大上传文件大小——如果你一次长传多个文件，那么它限制的就是这些所有文件合并在一起的大小。</p>
<p>默认情况下，<code>MaxMemory</code>应该设置得比<code>MaxUploadSize</code>小，这种情况下两个参数合并在一起的效果则是：</p>
<ol>
<li>如果文件大小小于<code>MaxMemory</code>，则直接在内存中处理；</li>
<li>如果文件大小介于<code>MaxMemory</code>和<code>MaxUploadSize</code>之间，那么比<code>MaxMemory</code>大的部分将会放在临时目录；</li>
<li>文件大小超出<code>MaxUploadSize</code>，直接拒绝请求，返回响应码 413</li>
</ol>
<p>Beego 提供了两个很方便的方法来处理文件上传：</p>
<ul>
<li><p>GetFile(key string) (multipart.File, *multipart.FileHeader, error)</p>
<p>该方法主要用于用户读取表单中的文件名 <code>the_file</code>，然后返回相应的信息，用户根据这些变量来处理文件上传：过滤、保存文件等。</p>
</li>
<li><p>SaveToFile(fromfile, tofile string) error</p>
<p>该方法是在 GetFile 的基础上实现了快速保存的功能<br>fromfile 是提交时候的 html 表单中的 name</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;uploadname&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>保存的代码例子如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *FormController)</span></span> Post() &#123;</span><br><span class="line">	f, h, err := c.GetFile(<span class="string">&quot;uploadname&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(<span class="string">&quot;getfile err &quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> f.Close()</span><br><span class="line">	c.SaveToFile(<span class="string">&quot;uploadname&quot;</span>, <span class="string">&quot;static/upload/&quot;</span> + h.Filename) <span class="comment">// 保存位置在 static/upload, 没有文件夹要先创建</span></span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="数据绑定"><a href="#数据绑定" class="headerlink" title="数据绑定"></a>数据绑定</h3><p>支持从用户请求中直接数据 bind 到指定的对象,例如请求地址如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">123</span>&amp;isok=<span class="literal">true</span>&amp;ft=<span class="number">1.2</span>&amp;ol[<span class="number">0</span>]=<span class="number">1</span>&amp;ol[<span class="number">1</span>]=<span class="number">2</span>&amp;ul[]=str&amp;ul[]=array&amp;user.Name=astaxie</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> id <span class="type">int</span></span><br><span class="line">this.Ctx.Input.Bind(&amp;id, <span class="string">&quot;id&quot;</span>)  <span class="comment">//id ==123</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> isok <span class="type">bool</span></span><br><span class="line">this.Ctx.Input.Bind(&amp;isok, <span class="string">&quot;isok&quot;</span>)  <span class="comment">//isok ==true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ft <span class="type">float64</span></span><br><span class="line">this.Ctx.Input.Bind(&amp;ft, <span class="string">&quot;ft&quot;</span>)  <span class="comment">//ft ==1.2</span></span><br><span class="line"></span><br><span class="line">ol := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line">this.Ctx.Input.Bind(&amp;ol, <span class="string">&quot;ol&quot;</span>)  <span class="comment">//ol ==[1 2]</span></span><br><span class="line"></span><br><span class="line">ul := <span class="built_in">make</span>([]<span class="type">string</span>, <span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line">this.Ctx.Input.Bind(&amp;ul, <span class="string">&quot;ul&quot;</span>)  <span class="comment">//ul ==[str array]</span></span><br><span class="line"></span><br><span class="line">user <span class="keyword">struct</span>&#123;Name&#125;</span><br><span class="line">this.Ctx.Input.Bind(&amp;user, <span class="string">&quot;user&quot;</span>)  <span class="comment">//user ==&#123;Name:&quot;astaxie&quot;&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="session-控制"><a href="#session-控制" class="headerlink" title="session 控制"></a>session 控制</h2><p>beego 内置了 session 模块，使用 session 相当方便，只要在 main 入口函数中设置如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web.BConfig.WebConfig.Session.SessionOn = <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>或者通过配置文件配置如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sessionon = <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>通过这种方式就可以开启 session，如何使用 session，请看下面的例子：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MainController)</span></span> Get() &#123;</span><br><span class="line">	v := this.GetSession(<span class="string">&quot;asta&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> v == <span class="literal">nil</span> &#123;</span><br><span class="line">		this.SetSession(<span class="string">&quot;asta&quot;</span>, <span class="type">int</span>(<span class="number">1</span>))</span><br><span class="line">		this.Data[<span class="string">&quot;num&quot;</span>] = <span class="number">0</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		this.SetSession(<span class="string">&quot;asta&quot;</span>, v.(<span class="type">int</span>)+<span class="number">1</span>)</span><br><span class="line">		this.Data[<span class="string">&quot;num&quot;</span>] = v.(<span class="type">int</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	this.TplName = <span class="string">&quot;index.tpl&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>session 有几个方便的方法：</p>
<ul>
<li>SetSession(name string, value interface{})</li>
<li>GetSession(name string) interface{}</li>
<li>DelSession(name string)</li>
<li>SessionRegenerateID()</li>
<li>DestroySession()</li>
</ul>
<p>session 操作主要有设置 session、获取 session、删除 session。</p>
<p>当然你可以通过下面的方式自己控制这些逻辑：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sess:=this.StartSession()</span><br><span class="line"><span class="keyword">defer</span> sess.SessionRelease()</span><br></pre></td></tr></table></figure>

<p>sess 对象具有如下方法：</p>
<ul>
<li>sess.Set()</li>
<li>sess.Get()</li>
<li>sess.Delete()</li>
<li>sess.SessionID()</li>
<li>sess.Flush()</li>
</ul>
<p>但是我还是建议大家采用 SetSession、GetSession、DelSession 三个方法来操作，避免自己在操作的过程中资源没释放的问题。</p>
<p>关于 Session 模块使用中的一些参数设置：</p>
<ul>
<li><p>web.BConfig.WebConfig.Session.SessionOn</p>
<p>设置是否开启 Session，默认是 false，配置文件对应的参数名：sessionon。</p>
</li>
<li><p>web.BConfig.WebConfig.Session.SessionName</p>
<p>设置 cookies 的名字，Session 默认是保存在用户的浏览器 cookies 里面的，默认名是 beegosessionID，配置文件对应的参数名是：sessionname。</p>
</li>
<li><p>web.BConfig.WebConfig.Session.SessionGCMaxLifetime</p>
<p>设置 Session 过期的时间，默认值是 3600 秒，配置文件对应的参数：sessiongcmaxlifetime。</p>
</li>
<li><p>web.BConfig.WebConfig.Session.SessionHashFunc</p>
<p>默认值为 sha1，采用 sha1 加密算法生产 sessionid</p>
</li>
<li><p>web.BConfig.WebConfig.Session.SessionCookieLifeTime</p>
<p>设置 cookie 的过期时间，cookie 是用来存储保存在客户端的数据。</p>
</li>
</ul>
<h2 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h2><p>beego 支持自定义过滤中间件，例如安全验证，强制跳转等。</p>
<p>过滤器函数如下所示：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web.InsertFilter(pattern <span class="type">string</span>, pos <span class="type">int</span>, filter FilterFunc, opts ...FilterOpt)</span><br></pre></td></tr></table></figure>

<p>InsertFilter 函数的三个必填参数，一个可选参数</p>
<ul>
<li>pattern 路由规则，可以根据一定的规则进行路由，如果你全匹配可以用 <code>*</code></li>
<li>position 执行 Filter 的地方，五个固定参数如下，分别表示不同的执行过程<ul>
<li>BeforeStatic 静态地址之前<ul>
<li>BeforeRouter 寻找路由之前</li>
<li>BeforeExec 找到路由之后，开始执行相应的 Controller 之前</li>
<li>AfterExec 执行完 Controller 逻辑之后执行的过滤器</li>
<li>FinishRouter 执行完逻辑之后执行的过滤器</li>
</ul>
</li>
</ul>
</li>
<li>filter filter 函数 type FilterFunc func(*context.Context)</li>
<li>opts</li>
</ul>
<p>如下例子所示，验证用户是否已经登录，应用于全部的请求：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> FilterUser = <span class="function"><span class="keyword">func</span><span class="params">(ctx *context.Context)</span></span> &#123;</span><br><span class="line">    _, ok := ctx.Input.Session(<span class="string">&quot;uid&quot;</span>).(<span class="type">int</span>)</span><br><span class="line">    <span class="keyword">if</span> !ok &amp;&amp; ctx.Request.RequestURI != <span class="string">&quot;/login&quot;</span> &#123;</span><br><span class="line">        ctx.Redirect(<span class="number">302</span>, <span class="string">&quot;/login&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">web.InsertFilter(<span class="string">&quot;/*&quot;</span>, web.BeforeRouter, FilterUser)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<blockquote>
<p>这里需要特别注意使用 session 的 Filter 必须在 BeforeStatic 之后才能获取，因为 session 没有在这之前初始化。</p>
</blockquote>
</blockquote>
</blockquote>
<p>还可以通过正则路由进行过滤，如果匹配参数就执行：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> FilterUser = <span class="function"><span class="keyword">func</span><span class="params">(ctx *context.Context)</span></span> &#123;</span><br><span class="line">    _, ok := ctx.Input.Session(<span class="string">&quot;uid&quot;</span>).(<span class="type">int</span>)</span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">        ctx.Redirect(<span class="number">302</span>, <span class="string">&quot;/login&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">web.InsertFilter(<span class="string">&quot;/user/:id([0-9]+)&quot;</span>, web.BeforeRouter, FilterUser)</span><br></pre></td></tr></table></figure>

<h2 id="flash-数据"><a href="#flash-数据" class="headerlink" title="flash 数据"></a>flash 数据</h2><p>这个 flash 与 Adobe&#x2F;Macromedia Flash 没有任何关系。它主要用于在两个逻辑间传递临时数据，flash 中存放的所有数据会在紧接着的下一个逻辑中调用后清除。一般用于传递提示和错误消息。它适合 <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Post/Redirect/Get">Post&#x2F;Redirect&#x2F;Get</a> 模式。下面看使用的例子：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 显示设置信息</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *MainController)</span></span> Get() &#123;</span><br><span class="line">	flash:=web.ReadFromRequest(&amp;c.Controller)</span><br><span class="line">	<span class="keyword">if</span> n,ok:=flash.Data[<span class="string">&quot;notice&quot;</span>];ok&#123;</span><br><span class="line">		<span class="comment">// 显示设置成功</span></span><br><span class="line">		c.TplName = <span class="string">&quot;set_success.html&quot;</span></span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span> n,ok=flash.Data[<span class="string">&quot;error&quot;</span>];ok&#123;</span><br><span class="line">		<span class="comment">// 显示错误</span></span><br><span class="line">		c.TplName = <span class="string">&quot;set_error.html&quot;</span></span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="comment">// 不然默认显示设置页面</span></span><br><span class="line">		c.Data[<span class="string">&quot;list&quot;</span>]=GetInfo()</span><br><span class="line">		c.TplName = <span class="string">&quot;setting_list.html&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理设置信息</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *MainController)</span></span> Post() &#123;</span><br><span class="line">	flash:=web.NewFlash()</span><br><span class="line">	setting:=Settings&#123;&#125;</span><br><span class="line">	valid := Validation&#123;&#125;</span><br><span class="line">	c.ParseForm(&amp;setting)</span><br><span class="line">	<span class="keyword">if</span> b, err := valid.Valid(setting);err!=<span class="literal">nil</span> &#123;</span><br><span class="line">		flash.Error(<span class="string">&quot;Settings invalid!&quot;</span>)</span><br><span class="line">		flash.Store(&amp;c.Controller)</span><br><span class="line">		c.Redirect(<span class="string">&quot;/setting&quot;</span>,<span class="number">302</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span> b!=<span class="literal">nil</span>&#123;</span><br><span class="line">		flash.Error(<span class="string">&quot;validation err!&quot;</span>)</span><br><span class="line">		flash.Store(&amp;c.Controller)</span><br><span class="line">		c.Redirect(<span class="string">&quot;/setting&quot;</span>,<span class="number">302</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	saveSetting(setting)</span><br><span class="line">	flash.Notice(<span class="string">&quot;Settings saved!&quot;</span>)</span><br><span class="line">	flash.Store(&amp;c.Controller)</span><br><span class="line">	c.Redirect(<span class="string">&quot;/setting&quot;</span>,<span class="number">302</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的代码执行的大概逻辑是这样的：</p>
<ol>
<li>Get 方法执行，因为没有 flash 数据，所以显示设置页面。</li>
<li>用户设置信息之后点击递交，执行 Post，然后初始化一个 flash，通过验证，验证出错或者验证不通过设置 flash 的错误，如果通过了就保存设置，然后设置 flash 成功设置的信息。</li>
<li>设置完成后跳转到 Get 请求。</li>
<li>Get 请求获取到了 Flash 信息，然后执行相应的逻辑，如果出错显示出错的页面，如果成功显示成功的页面。</li>
</ol>
<p>默认情况下 <code>ReadFromRequest</code> 函数已经实现了读取的数据赋值给 flash，所以在你的模板里面你可以这样读取数据：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;.flash.<span class="type">error</span>&#125;&#125;</span><br><span class="line">&#123;&#123;.flash.warning&#125;&#125;</span><br><span class="line">&#123;&#123;.flash.notice&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>flash 对象有三个级别的设置：</p>
<ul>
<li>Notice 提示信息</li>
<li>Warning 警告信息</li>
<li>Error 错误信息</li>
</ul>
<h2 id="URL-构建"><a href="#URL-构建" class="headerlink" title="URL 构建"></a>URL 构建</h2><p>如果可以匹配 URL ，那么 beego 也可以生成 URL 吗？当然可以。 UrlFor() 函数就是用于构建指定函数的 URL 的。它把对应控制器和函数名结合的字符串作为第一个参数，其余参数对应 URL 中的变量。未知变量将添加到 URL 中作为查询参数。 例如：</p>
<p>下面定义了一个相应的控制器</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> TestController <span class="keyword">struct</span> &#123;</span><br><span class="line">	web.Controller</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *TestController)</span></span> Get() &#123;</span><br><span class="line">	this.Data[<span class="string">&quot;Username&quot;</span>] = <span class="string">&quot;astaxie&quot;</span></span><br><span class="line">	this.Ctx.Output.Body([]<span class="type">byte</span>(<span class="string">&quot;ok&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *TestController)</span></span> List() &#123;</span><br><span class="line">	this.Ctx.Output.Body([]<span class="type">byte</span>(<span class="string">&quot;i am list&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *TestController)</span></span> Params() &#123;</span><br><span class="line">	this.Ctx.Output.Body([]<span class="type">byte</span>(this.Ctx.Input.Params()[<span class="string">&quot;0&quot;</span>] + this.Ctx.Input.Params()[<span class="string">&quot;1&quot;</span>] + this.Ctx.Input.Params()[<span class="string">&quot;2&quot;</span>]))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *TestController)</span></span> Myext() &#123;</span><br><span class="line">	this.Ctx.Output.Body([]<span class="type">byte</span>(this.Ctx.Input.Param(<span class="string">&quot;:ext&quot;</span>)))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *TestController)</span></span> GetUrl() &#123;</span><br><span class="line">	this.Ctx.Output.Body([]<span class="type">byte</span>(this.UrlFor(<span class="string">&quot;.Myext&quot;</span>)))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面是我们注册的路由：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">web.Router(<span class="string">&quot;/api/list&quot;</span>, &amp;TestController&#123;&#125;, <span class="string">&quot;*:List&quot;</span>)</span><br><span class="line">web.Router(<span class="string">&quot;/person/:last/:first&quot;</span>, &amp;TestController&#123;&#125;)</span><br><span class="line">web.AutoRouter(&amp;TestController&#123;&#125;)</span><br></pre></td></tr></table></figure>

<p>那么通过方式可以获取相应的URL地址：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">web.URLFor(<span class="string">&quot;TestController.List&quot;</span>)</span><br><span class="line"><span class="comment">// 输出 /api/list</span></span><br><span class="line"></span><br><span class="line">web.URLFor(<span class="string">&quot;TestController.Get&quot;</span>, <span class="string">&quot;:last&quot;</span>, <span class="string">&quot;xie&quot;</span>, <span class="string">&quot;:first&quot;</span>, <span class="string">&quot;asta&quot;</span>)</span><br><span class="line"><span class="comment">// 输出 /person/xie/asta</span></span><br><span class="line"></span><br><span class="line">web.URLFor(<span class="string">&quot;TestController.Myext&quot;</span>)</span><br><span class="line"><span class="comment">// 输出 /Test/Myext</span></span><br><span class="line"></span><br><span class="line">web.URLFor(<span class="string">&quot;TestController.GetUrl&quot;</span>)</span><br><span class="line"><span class="comment">// 输出 /Test/GetUrl</span></span><br></pre></td></tr></table></figure>

<h3 id="模板中如何使用"><a href="#模板中如何使用" class="headerlink" title="模板中如何使用"></a>模板中如何使用</h3><p>默认情况下，beego 已经注册了 urlfor 函数，用户可以通过如下的代码进行调用</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;urlfor <span class="string">&quot;TestController.List&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>为什么不在把 URL 写死在模板中，反而要动态构建？有两个很好的理由：</p>
<ol>
<li>反向解析通常比硬编码 URL 更直观。同时，更重要的是你可以只在一个地方改变 URL ，而不用到处乱找。</li>
<li>URL 创建会为你处理特殊字符的转义和 Unicode 数据，不用你操心。</li>
</ol>
<h2 id="多种格式数据输出"><a href="#多种格式数据输出" class="headerlink" title="多种格式数据输出"></a>多种格式数据输出</h2><p>beego 当初设计的时候就考虑了 API 功能的设计，而我们在设计 API 的时候经常是输出 JSON 或者 XML 数据，那么 beego 提供了这样的方式直接输出：</p>
<p>注意 struct 属性应该 为 exported Identifier<br>首字母应该大写</p>
<ul>
<li><p>JSON 数据直接输出：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *AddController)</span></span> Get() &#123;</span><br><span class="line">	mystruct := &#123; ... &#125;</span><br><span class="line">	this.Data[<span class="string">&quot;json&quot;</span>] = &amp;mystruct</span><br><span class="line">	this.ServeJSON()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用 ServeJSON 之后，会设置 <code>content-type</code> 为 <code>application/json</code>，然后同时把数据进行 JSON 序列化输出。</p>
</li>
<li><p>XML 数据直接输出：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *AddController)</span></span> Get() &#123;</span><br><span class="line">	mystruct := &#123; ... &#125;</span><br><span class="line">	this.Data[<span class="string">&quot;xml&quot;</span>]=&amp;mystruct</span><br><span class="line">	this.ServeXML()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用 ServeXML 之后，会设置 <code>content-type</code> 为 <code>application/xml</code>，同时数据会进行 XML 序列化输出。</p>
</li>
<li><p>jsonp 调用</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *AddController)</span></span> Get() &#123;</span><br><span class="line">	mystruct := &#123; ... &#125;</span><br><span class="line">	this.Data[<span class="string">&quot;jsonp&quot;</span>] = &amp;mystruct</span><br><span class="line">	this.ServeJSONP()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用 ServeJSONP 之后，会设置 <code>content-type</code> 为 <code>application/javascript</code>，然后同时把数据进行 JSON 序列化，然后根据请求的 callback 参数设置 jsonp 输出。</p>
</li>
</ul>
<p>开发模式下序列化后输出的是格式化易阅读的 JSON 或 XML 字符串；在生产模式下序列化后输出的是压缩的字符串。</p>
<h2 id="表单数据验证"><a href="#表单数据验证" class="headerlink" title="表单数据验证"></a>表单数据验证</h2><h3 id="安装及测试"><a href="#安装及测试" class="headerlink" title="安装及测试"></a>安装及测试</h3><p>安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/beego/beego/v2/core/validation</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go test github.com/beego/beego/v2/core/validation</span><br></pre></td></tr></table></figure>

<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>直接使用示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;github.com/beego/beego/v2/core/validation&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="type">string</span></span><br><span class="line">    Age <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    u := User&#123;<span class="string">&quot;man&quot;</span>, <span class="number">40</span>&#125;</span><br><span class="line">    valid := validation.Validation&#123;&#125;</span><br><span class="line">    valid.Required(u.Name, <span class="string">&quot;name&quot;</span>)</span><br><span class="line">    valid.MaxSize(u.Name, <span class="number">15</span>, <span class="string">&quot;nameMax&quot;</span>)</span><br><span class="line">    valid.Range(u.Age, <span class="number">0</span>, <span class="number">18</span>, <span class="string">&quot;age&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> valid.HasErrors() &#123;</span><br><span class="line">        <span class="comment">// 如果有错误信息，证明验证没通过</span></span><br><span class="line">        <span class="comment">// 打印错误信息</span></span><br><span class="line">        <span class="keyword">for</span> _, err := <span class="keyword">range</span> valid.Errors &#123;</span><br><span class="line">            log.Println(err.Key, err.Message)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// or use like this</span></span><br><span class="line">    <span class="keyword">if</span> v := valid.Max(u.Age, <span class="number">140</span>, <span class="string">&quot;age&quot;</span>); !v.Ok &#123;</span><br><span class="line">        log.Println(v.Error.Key, v.Error.Message)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 定制错误信息</span></span><br><span class="line">    minAge := <span class="number">18</span></span><br><span class="line">    valid.Min(u.Age, minAge, <span class="string">&quot;age&quot;</span>).Message(<span class="string">&quot;少儿不宜！&quot;</span>)</span><br><span class="line">    <span class="comment">// 错误信息格式化</span></span><br><span class="line">    valid.Min(u.Age, minAge, <span class="string">&quot;age&quot;</span>).Message(<span class="string">&quot;%d不禁&quot;</span>, minAge)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过 StructTag 使用示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;github.com/beego/beego/v2/core/validation&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证函数写在 &quot;valid&quot; tag 的标签里</span></span><br><span class="line"><span class="comment">// 各个函数之间用分号 &quot;;&quot; 分隔，分号后面可以有空格</span></span><br><span class="line"><span class="comment">// 参数用括号 &quot;()&quot; 括起来，多个参数之间用逗号 &quot;,&quot; 分开，逗号后面可以有空格</span></span><br><span class="line"><span class="comment">// 正则函数(Match)的匹配模式用两斜杠 &quot;/&quot; 括起来</span></span><br><span class="line"><span class="comment">// 各个函数的结果的 key 值为字段名.验证函数名</span></span><br><span class="line"><span class="keyword">type</span> user <span class="keyword">struct</span> &#123;</span><br><span class="line">    Id     <span class="type">int</span></span><br><span class="line">    Name   <span class="type">string</span> <span class="string">`valid:&quot;Required;Match(/^Bee.*/)&quot;`</span> <span class="comment">// Name 不能为空并且以 Bee 开头</span></span><br><span class="line">    Age    <span class="type">int</span>    <span class="string">`valid:&quot;Range(1, 140)&quot;`</span> <span class="comment">// 1 &lt;= Age &lt;= 140，超出此范围即为不合法</span></span><br><span class="line">    Email  <span class="type">string</span> <span class="string">`valid:&quot;Email; MaxSize(100)&quot;`</span> <span class="comment">// Email 字段需要符合邮箱格式，并且最大长度不能大于 100 个字符</span></span><br><span class="line">    Mobile <span class="type">string</span> <span class="string">`valid:&quot;Mobile&quot;`</span> <span class="comment">// Mobile 必须为正确的手机号</span></span><br><span class="line">    IP     <span class="type">string</span> <span class="string">`valid:&quot;IP&quot;`</span> <span class="comment">// IP 必须为一个正确的 IPv4 地址</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果你的 struct 实现了接口 validation.ValidFormer</span></span><br><span class="line"><span class="comment">// 当 StructTag 中的测试都成功时，将会执行 Valid 函数进行自定义验证</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *user)</span></span> Valid(v *validation.Validation) &#123;</span><br><span class="line">    <span class="keyword">if</span> strings.Index(u.Name, <span class="string">&quot;admin&quot;</span>) != <span class="number">-1</span> &#123;</span><br><span class="line">        <span class="comment">// 通过 SetError 设置 Name 的错误信息，HasErrors 将会返回 true</span></span><br><span class="line">        v.SetError(<span class="string">&quot;Name&quot;</span>, <span class="string">&quot;名称里不能含有 admin&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    valid := validation.Validation&#123;&#125;</span><br><span class="line">    u := user&#123;Name: <span class="string">&quot;Beego&quot;</span>, Age: <span class="number">2</span>, Email: <span class="string">&quot;dev@web.me&quot;</span>&#125;</span><br><span class="line">    b, err := valid.Valid(&amp;u)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="comment">// handle error</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> !b &#123;</span><br><span class="line">        <span class="comment">// validation does not pass</span></span><br><span class="line">        <span class="comment">// blabla...</span></span><br><span class="line">        <span class="keyword">for</span> _, err := <span class="keyword">range</span> valid.Errors &#123;</span><br><span class="line">            log.Println(err.Key, err.Message)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>StructTag 可用的验证函数：</p>
<ul>
<li><code>Required</code> 不为空，即各个类型要求不为其零值</li>
<li><code>Min(min int)</code> 最小值，有效类型：<code>int</code>，其他类型都将不能通过验证</li>
<li><code>Max(max int)</code> 最大值，有效类型：<code>int</code>，其他类型都将不能通过验证</li>
<li><code>Range(min, max int)</code> 数值的范围，有效类型：<code>int</code>，他类型都将不能通过验证</li>
<li><code>MinSize(min int)</code> 最小长度，有效类型：<code>string slice</code>，其他类型都将不能通过验证</li>
<li><code>MaxSize(max int)</code> 最大长度，有效类型：<code>string slice</code>，其他类型都将不能通过验证</li>
<li><code>Length(length int)</code> 指定长度，有效类型：<code>string slice</code>，其他类型都将不能通过验证</li>
<li><code>Alpha</code> alpha字符，有效类型：<code>string</code>，其他类型都将不能通过验证</li>
<li><code>Numeric</code> 数字，有效类型：<code>string</code>，其他类型都将不能通过验证</li>
<li><code>AlphaNumeric</code> alpha 字符或数字，有效类型：<code>string</code>，其他类型都将不能通过验证</li>
<li><code>Match(pattern string)</code> 正则匹配，有效类型：<code>string</code>，其他类型都将被转成字符串再匹配(fmt.Sprintf(“%v”, obj).Match)</li>
<li><code>AlphaDash</code> alpha 字符或数字或横杠 <code>-_</code>，有效类型：<code>string</code>，其他类型都将不能通过验证</li>
<li><code>Email</code> 邮箱格式，有效类型：<code>string</code>，其他类型都将不能通过验证</li>
<li><code>IP</code> IP 格式，目前只支持 IPv4 格式验证，有效类型：<code>string</code>，其他类型都将不能通过验证</li>
<li><code>Base64</code> base64 编码，有效类型：<code>string</code>，其他类型都将不能通过验证</li>
<li><code>Mobile</code> 手机号，有效类型：<code>string</code>，其他类型都将不能通过验证</li>
<li><code>Tel</code> 固定电话号，有效类型：<code>string</code>，其他类型都将不能通过验证</li>
<li><code>Phone</code> 手机号或固定电话号，有效类型：<code>string</code>，其他类型都将不能通过验证</li>
<li><code>ZipCode</code> 邮政编码，有效类型：<code>string</code>，其他类型都将不能通过验证</li>
</ul>
<h3 id="自定义验证"><a href="#自定义验证" class="headerlink" title="自定义验证"></a>自定义验证</h3><p>我们允许自己注册验证逻辑。使用方法：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddCustomFunc(name <span class="type">string</span>, f CustomFunc) <span class="type">error</span></span><br></pre></td></tr></table></figure>

<h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2><p>我们在做 Web 开发的时候，经常需要页面跳转和错误处理，beego 这方面也进行了考虑，通过 <code>Redirect</code> 方法来进行跳转：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *AddController)</span></span> Get() &#123;</span><br><span class="line">	this.Redirect(<span class="string">&quot;/&quot;</span>, <span class="number">302</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如何中止此次请求并抛出异常，beego 可以在控制器中这样操作：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MainController)</span></span> Get() &#123;</span><br><span class="line">	this.Abort(<span class="string">&quot;401&quot;</span>)</span><br><span class="line">	v := this.GetSession(<span class="string">&quot;asta&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> v == <span class="literal">nil</span> &#123;</span><br><span class="line">		this.SetSession(<span class="string">&quot;asta&quot;</span>, <span class="type">int</span>(<span class="number">1</span>))</span><br><span class="line">		this.Data[<span class="string">&quot;Email&quot;</span>] = <span class="number">0</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		this.SetSession(<span class="string">&quot;asta&quot;</span>, v.(<span class="type">int</span>)+<span class="number">1</span>)</span><br><span class="line">		this.Data[<span class="string">&quot;Email&quot;</span>] = v.(<span class="type">int</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	this.TplName = <span class="string">&quot;index.tpl&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样 <code>this.Abort(&quot;401&quot;)</code> 之后的代码不会再执行，而且会默认显示给用户如下页面：</p>
<p><img src="https://cdn.jsdelivr.net/gh/palp1tate/blog_img/img/401.png"></p>
<p>web 框架默认支持 401、403、404、500、503 这几种错误的处理。用户可以自定义相应的错误处理，例如下面重新定义 404 页面：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">page_not_found</span><span class="params">(rw http.ResponseWriter, r *http.Request)</span></span>&#123;</span><br><span class="line">	t,_:= template.New(<span class="string">&quot;404.html&quot;</span>).ParseFiles(web.BConfig.WebConfig.ViewsPath+<span class="string">&quot;/404.html&quot;</span>)</span><br><span class="line">	data :=<span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">	data[<span class="string">&quot;content&quot;</span>] = <span class="string">&quot;page not found&quot;</span></span><br><span class="line">	t.Execute(rw, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	web.ErrorHandler(<span class="string">&quot;404&quot;</span>,page_not_found)</span><br><span class="line">	web.Router(<span class="string">&quot;/&quot;</span>, &amp;controllers.MainController&#123;&#125;)</span><br><span class="line">	web.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以通过自定义错误页面 <code>404.html</code> 来处理 404 错误。</p>
<p>beego 更加人性化的还有一个设计就是支持用户自定义字符串错误类型处理函数，例如下面的代码，用户注册了一个数据库出错的处理页面：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dbError</span><span class="params">(rw http.ResponseWriter, r *http.Request)</span></span>&#123;</span><br><span class="line">	t,_:= template.New(<span class="string">&quot;dberror.html&quot;</span>).ParseFiles(web.BConfig.WebConfig.ViewsPath+<span class="string">&quot;/dberror.html&quot;</span>)</span><br><span class="line">	data :=<span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">	data[<span class="string">&quot;content&quot;</span>] = <span class="string">&quot;database is now down&quot;</span></span><br><span class="line">	t.Execute(rw, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	web.ErrorHandler(<span class="string">&quot;dbError&quot;</span>,dbError)</span><br><span class="line">	web.Router(<span class="string">&quot;/&quot;</span>, &amp;controllers.MainController&#123;&#125;)</span><br><span class="line">	web.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一旦在入口注册该错误处理代码，那么你可以在任何你的逻辑中遇到数据库错误调用 <code>this.Abort(&quot;dbError&quot;)</code> 来进行异常页面处理。</p>
<h3 id="Controller-定义-Error"><a href="#Controller-定义-Error" class="headerlink" title="Controller 定义 Error"></a>Controller 定义 Error</h3><p>从 1.4.3 版本开始，支持 Controller 方式定义 Error 错误处理函数，这样就可以充分利用系统自带的模板处理，以及 context 等方法。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> controllers</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/beego/beego/v2/server/web&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ErrorController <span class="keyword">struct</span> &#123;</span><br><span class="line">	web.Controller</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *ErrorController)</span></span> Error404() &#123;</span><br><span class="line">	c.Data[<span class="string">&quot;content&quot;</span>] = <span class="string">&quot;page not found&quot;</span></span><br><span class="line">	c.TplName = <span class="string">&quot;404.tpl&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *ErrorController)</span></span> Error501() &#123;</span><br><span class="line">	c.Data[<span class="string">&quot;content&quot;</span>] = <span class="string">&quot;server error&quot;</span></span><br><span class="line">	c.TplName = <span class="string">&quot;501.tpl&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *ErrorController)</span></span> ErrorDb() &#123;</span><br><span class="line">	c.Data[<span class="string">&quot;content&quot;</span>] = <span class="string">&quot;database is now down&quot;</span></span><br><span class="line">	c.TplName = <span class="string">&quot;dberror.tpl&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过上面的例子我们可以看到，所有的函数都是有一定规律的，都是 <code>Error</code> 开头，后面的名字就是我们调用 <code>Abort</code> 的名字，例如 <code>Error404</code> 函数其实调用对应的就是 <code>Abort(&quot;404&quot;)</code></p>
<p>我们就只要在 <code>web.Run</code> 之前采用 <code>web.ErrorController</code> 注册这个错误处理函数就可以了</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	_ <span class="string">&quot;btest/routers&quot;</span></span><br><span class="line">	<span class="string">&quot;btest/controllers&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/beego/beego/v2/server/web&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	web.ErrorController(&amp;controllers.ErrorController&#123;&#125;)</span><br><span class="line">	web.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="model设计"><a href="#model设计" class="headerlink" title="model设计"></a>model设计</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>beego ORM 是一个强大的 Go 语言 ORM 框架。她的灵感主要来自 Django ORM 和 SQLAlchemy。</p>
<p>目前该框架仍处于开发阶段，可能发生任何导致不兼容的改动。</p>
<p><strong>已支持数据库驱动：</strong></p>
<ul>
<li>MySQL：<a target="_blank" rel="noopener" href="https://github.com/go-sql-driver/mysql">github.com&#x2F;go-sql-driver&#x2F;mysql</a></li>
<li>PostgreSQL：<a target="_blank" rel="noopener" href="https://github.com/lib/pq">github.com&#x2F;lib&#x2F;pq</a></li>
<li>Sqlite3：<a target="_blank" rel="noopener" href="https://github.com/mattn/go-sqlite3">github.com&#x2F;mattn&#x2F;go-sqlite3</a></li>
</ul>
<p><strong>ORM 特性：</strong></p>
<ul>
<li>支持 Go 的所有类型存储</li>
<li>轻松上手，采用简单的 CRUD 风格</li>
<li>自动 Join 关联表</li>
<li>跨数据库兼容查询</li>
<li>允许直接使用 SQL 查询／映射</li>
<li>严格完整的测试保证 ORM 的稳定与健壮</li>
</ul>
<p><strong>安装 ORM：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/beego/beego/v2/client/orm</span><br></pre></td></tr></table></figure>

<h2 id="快速入门-1"><a href="#快速入门-1" class="headerlink" title="快速入门"></a>快速入门</h2><h3 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/beego/beego/v2/client/orm&quot;</span></span><br><span class="line">	_ <span class="string">&quot;github.com/go-sql-driver/mysql&quot;</span> <span class="comment">// import your used driver</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Model Struct</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id   <span class="type">int</span></span><br><span class="line">	Name <span class="type">string</span> <span class="string">`orm:&quot;size(100)&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// set default database</span></span><br><span class="line">	orm.RegisterDataBase(<span class="string">&quot;default&quot;</span>, <span class="string">&quot;mysql&quot;</span>, <span class="string">&quot;username:password@tcp(127.0.0.1:3306)/db_name?charset=utf8&amp;loc=Local&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// register model</span></span><br><span class="line">	orm.RegisterModel(<span class="built_in">new</span>(User))</span><br><span class="line"></span><br><span class="line">	<span class="comment">// create table</span></span><br><span class="line">	orm.RunSyncdb(<span class="string">&quot;default&quot;</span>, <span class="literal">false</span>, <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	o := orm.NewOrm()</span><br><span class="line"></span><br><span class="line">	user := User&#123;Name: <span class="string">&quot;slene&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// insert</span></span><br><span class="line">	id, err := o.Insert(&amp;user)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;ID: %d, ERR: %v\n&quot;</span>, id, err)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// update</span></span><br><span class="line">	user.Name = <span class="string">&quot;astaxie&quot;</span></span><br><span class="line">	num, err := o.Update(&amp;user)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;NUM: %d, ERR: %v\n&quot;</span>, num, err)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// read one</span></span><br><span class="line">	u := User&#123;Id: user.Id&#125;</span><br><span class="line">	err = o.Read(&amp;u)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;ERR: %v\n&quot;</span>, err)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// delete</span></span><br><span class="line">	num, err = o.Delete(&amp;u)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;NUM: %d, ERR: %v\n&quot;</span>, num, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="关联查询"><a href="#关联查询" class="headerlink" title="关联查询"></a>关联查询</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Post <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id    <span class="type">int</span>    <span class="string">`orm:&quot;auto&quot;`</span></span><br><span class="line">	Title <span class="type">string</span> <span class="string">`orm:&quot;size(100)&quot;`</span></span><br><span class="line">	User  *User  <span class="string">`orm:&quot;rel(fk)&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> posts []*Post</span><br><span class="line">qs := o.QueryTable(<span class="string">&quot;post&quot;</span>)</span><br><span class="line">num, err := qs.Filter(<span class="string">&quot;User__Name&quot;</span>, <span class="string">&quot;slene&quot;</span>).All(&amp;posts)</span><br></pre></td></tr></table></figure>

<h3 id="SQL-查询"><a href="#SQL-查询" class="headerlink" title="SQL 查询"></a>SQL 查询</h3><p>当您无法使用 ORM 来达到您的需求时，也可以直接使用 SQL 来完成查询／映射操作。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> maps []orm.Params</span><br><span class="line">num, err := o.Raw(<span class="string">&quot;SELECT * FROM user&quot;</span>).Values(&amp;maps)</span><br><span class="line"><span class="keyword">for</span> _,term := <span class="keyword">range</span> maps&#123;</span><br><span class="line">	fmt.Println(term[<span class="string">&quot;id&quot;</span>],<span class="string">&quot;:&quot;</span>,term[<span class="string">&quot;name&quot;</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ORM使用"><a href="#ORM使用" class="headerlink" title="ORM使用"></a>ORM使用</h2><p>我们建议在使用过程中，一个数据库应该只存在一个<code>ORM</code>对象。</p>
<p><code>models.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/beego/beego/v2/client/orm&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id          <span class="type">int</span></span><br><span class="line">	Name        <span class="type">string</span></span><br><span class="line">	Profile     *Profile   <span class="string">`orm:&quot;rel(one)&quot;`</span> <span class="comment">// OneToOne relation</span></span><br><span class="line">	Post    	[]*Post <span class="string">`orm:&quot;reverse(many)&quot;`</span> <span class="comment">// 设置一对多的反向关系</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Profile <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id          <span class="type">int</span></span><br><span class="line">	Age         <span class="type">int16</span></span><br><span class="line">	User        *User   <span class="string">`orm:&quot;reverse(one)&quot;`</span> <span class="comment">// 设置一对一反向关系(可选)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Post <span class="keyword">struct</span> &#123;</span><br><span class="line">    Id    <span class="type">int</span></span><br><span class="line">    Title <span class="type">string</span></span><br><span class="line">    User  *User  <span class="string">`orm:&quot;rel(fk)&quot;`</span>	<span class="comment">//设置一对多关系</span></span><br><span class="line">    Tags  []*Tag <span class="string">`orm:&quot;rel(m2m)&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Tag <span class="keyword">struct</span> &#123;</span><br><span class="line">    Id    <span class="type">int</span></span><br><span class="line">    Name  <span class="type">string</span></span><br><span class="line">    Posts []*Post <span class="string">`orm:&quot;reverse(many)&quot;`</span> <span class="comment">//设置多对多反向关系</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 需要在init中注册定义的model</span></span><br><span class="line">	orm.RegisterModel(<span class="built_in">new</span>(User), <span class="built_in">new</span>(Post), <span class="built_in">new</span>(Profile), <span class="built_in">new</span>(Tag))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>main.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/beego/beego/v2/client/orm&quot;</span></span><br><span class="line">	_ <span class="string">&quot;github.com/go-sql-driver/mysql&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	orm.RegisterDriver(<span class="string">&quot;mysql&quot;</span>, orm.DRMySQL)</span><br><span class="line"></span><br><span class="line">	orm.RegisterDataBase(<span class="string">&quot;default&quot;</span>, <span class="string">&quot;mysql&quot;</span>, <span class="string">&quot;root:root@/orm_test?charset=utf8&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 默认使用 default，你可以指定为其他数据库</span></span><br><span class="line">	o := orm.NewOrm()</span><br><span class="line"></span><br><span class="line">	profile := <span class="built_in">new</span>(Profile)</span><br><span class="line">	profile.Age = <span class="number">30</span></span><br><span class="line"></span><br><span class="line">	user := <span class="built_in">new</span>(User)</span><br><span class="line">	user.Profile = profile</span><br><span class="line">	user.Name = <span class="string">&quot;slene&quot;</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(o.Insert(profile))</span><br><span class="line">	fmt.Println(o.Insert(user))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="RegisterDriver"><a href="#RegisterDriver" class="headerlink" title="RegisterDriver"></a>RegisterDriver</h3><p>默认数据库类型</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">orm.DRMySQL</span><br><span class="line">orm.DRSqlite</span><br><span class="line">orm.DRPostgres</span><br><span class="line">orm.DRTiDB</span><br><span class="line"></span><br><span class="line"><span class="comment">// &lt; 1.6</span></span><br><span class="line">orm.DR_MySQL</span><br><span class="line">orm.DR_Sqlite</span><br><span class="line">orm.DR_Postgres</span><br><span class="line"><span class="comment">// 参数1   driverName</span></span><br><span class="line"><span class="comment">// 参数2   数据库类型</span></span><br><span class="line"><span class="comment">// 这个用来设置 driverName 对应的数据库类型</span></span><br><span class="line"><span class="comment">// mysql / sqlite3 / postgres / tidb 这几种是默认已经注册过的，所以可以无需设置</span></span><br><span class="line">orm.RegisterDriver(<span class="string">&quot;mysql&quot;</span>, orm.DRMySQL)</span><br></pre></td></tr></table></figure>

<h3 id="RegisterDataBase"><a href="#RegisterDataBase" class="headerlink" title="RegisterDataBase"></a>RegisterDataBase</h3><p>ORM 必须注册一个别名为 <code>default</code> 的数据库，作为默认使用。</p>
<p>ORM 使用 golang 自己的连接池</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数1        数据库的别名，用来在 ORM 中切换数据库使用</span></span><br><span class="line"><span class="comment">// 参数2        driverName</span></span><br><span class="line"><span class="comment">// 参数3        对应的链接字符串</span></span><br><span class="line">orm.RegisterDataBase(<span class="string">&quot;default&quot;</span>, <span class="string">&quot;mysql&quot;</span>, <span class="string">&quot;root:root@/orm_test?charset=utf8&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数4(可选)  设置最大空闲连接</span></span><br><span class="line"><span class="comment">// 参数5(可选)  设置最大数据库连接 (go &gt;= 1.2)</span></span><br><span class="line">maxIdle := <span class="number">30</span></span><br><span class="line">maxConn := <span class="number">30</span></span><br><span class="line">orm.RegisterDataBase(<span class="string">&quot;default&quot;</span>, <span class="string">&quot;mysql&quot;</span>, <span class="string">&quot;root:root@/orm_test?charset=utf8&quot;</span>, orm.MaxIdleConnections(maxIdle), orm.MaxOpenConnections(maxConn))</span><br></pre></td></tr></table></figure>

<h3 id="RegisterModel"><a href="#RegisterModel" class="headerlink" title="RegisterModel"></a>RegisterModel</h3><p>将你定义的 Model 进行注册，最佳设计是有单独的 models.go 文件，在他的 init 函数中进行注册。</p>
<p>迷你版 models.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/beego/beego/v2/client/orm&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id   <span class="type">int</span></span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">	orm.RegisterModel(<span class="built_in">new</span>(User))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>RegisterModel 也可以同时注册多个 model</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orm.RegisterModel(<span class="built_in">new</span>(User), <span class="built_in">new</span>(Profile), <span class="built_in">new</span>(Post))</span><br></pre></td></tr></table></figure>

<h3 id="RegisterModelWithPrefix"><a href="#RegisterModelWithPrefix" class="headerlink" title="RegisterModelWithPrefix"></a>RegisterModelWithPrefix</h3><p>使用表名前缀</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orm.RegisterModelWithPrefix(<span class="string">&quot;prefix_&quot;</span>, <span class="built_in">new</span>(User))</span><br></pre></td></tr></table></figure>

<p>创建后的表名为 prefix_user</p>
<h3 id="QueryTable"><a href="#QueryTable" class="headerlink" title="QueryTable"></a>QueryTable</h3><p>传入表名，或者 Model 对象，返回一个 <a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/query.md">QuerySeter</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">o := orm.NewOrm()</span><br><span class="line"><span class="keyword">var</span> qs orm.QuerySeter</span><br><span class="line">qs = o.QueryTable(<span class="string">&quot;user&quot;</span>)</span><br><span class="line"><span class="comment">// 如果表没有定义过，会立刻 panic</span></span><br></pre></td></tr></table></figure>

<h3 id="Raw"><a href="#Raw" class="headerlink" title="Raw"></a>Raw</h3><p>使用 sql 语句直接进行操作</p>
<p>Raw 函数，返回一个 <a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/rawsql.md">RawSeter</a> 用以对设置的 sql 语句和参数进行操作</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">o := orm.NewOrm()</span><br><span class="line"><span class="keyword">var</span> r orm.RawSeter</span><br><span class="line">r = o.Raw(<span class="string">&quot;UPDATE user SET name = ? WHERE name = ?&quot;</span>, <span class="string">&quot;testing&quot;</span>, <span class="string">&quot;slene&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="CRUD-操作"><a href="#CRUD-操作" class="headerlink" title="CRUD 操作"></a>CRUD 操作</h2><p>如果已知主键的值，那么可以使用这些方法进行 CRUD 操作</p>
<p>对 object 操作的四个方法 Read &#x2F; Insert &#x2F; Update &#x2F; Delete</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">o := orm.NewOrm()</span><br><span class="line">user := <span class="built_in">new</span>(User)</span><br><span class="line">user.Name = <span class="string">&quot;slene&quot;</span></span><br><span class="line"></span><br><span class="line">fmt.Println(o.Insert(user))</span><br><span class="line"></span><br><span class="line">user.Name = <span class="string">&quot;Your&quot;</span></span><br><span class="line">fmt.Println(o.Update(user))</span><br><span class="line">fmt.Println(o.Read(user))</span><br><span class="line">fmt.Println(o.Delete(user))</span><br></pre></td></tr></table></figure>

<h3 id="Read"><a href="#Read" class="headerlink" title="Read"></a>Read</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">o := orm.NewOrm()</span><br><span class="line">user := User&#123;Id: <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line">err := o.Read(&amp;user)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err == orm.ErrNoRows &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;查询不到&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> err == orm.ErrMissPK &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;找不到主键&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	fmt.Println(user.Id, user.Name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Read 默认通过查询主键赋值，可以使用指定的字段进行查询：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user := User&#123;Name: <span class="string">&quot;slene&quot;</span>&#125;</span><br><span class="line">err = o.Read(&amp;user, <span class="string">&quot;Name&quot;</span>)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="ReadOrCreate"><a href="#ReadOrCreate" class="headerlink" title="ReadOrCreate"></a>ReadOrCreate</h3><p>尝试从数据库读取，不存在的话就创建一个。</p>
<p>它的实现机制，和具体的数据库有关。例如在 MYSQL 中，是使用</p>
<p>默认必须传入一个参数作为条件字段，同时也支持多个参数多个条件字段</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">o := orm.NewOrm()</span><br><span class="line">user := User&#123;Name: <span class="string">&quot;slene&quot;</span>&#125;</span><br><span class="line"><span class="comment">// 三个返回参数依次为：是否新创建的，对象 Id 值，错误</span></span><br><span class="line"><span class="keyword">if</span> created, id, err := o.ReadOrCreate(&amp;user, <span class="string">&quot;Name&quot;</span>); err == <span class="literal">nil</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> created &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;New Insert an object. Id:&quot;</span>, id)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Get an object. Id:&quot;</span>, id)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Insert"><a href="#Insert" class="headerlink" title="Insert"></a>Insert</h3><p>第一个返回值为自增健 Id 的值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">o := orm.NewOrm()</span><br><span class="line"><span class="keyword">var</span> user User</span><br><span class="line">user.Name = <span class="string">&quot;slene&quot;</span></span><br><span class="line">user.IsActive = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">id, err := o.Insert(&amp;user)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Println(id)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建后会自动对 auto 的 field 赋值</p>
<h3 id="InsertMulti"><a href="#InsertMulti" class="headerlink" title="InsertMulti"></a>InsertMulti</h3><p>同时插入多个对象</p>
<p>类似sql语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> (name, age) <span class="keyword">values</span>(&quot;slene&quot;, <span class="number">28</span>),(&quot;astaxie&quot;, <span class="number">30</span>),(&quot;unknown&quot;, <span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<p>第一个参数 bulk 为并列插入的数量，第二个为对象的slice</p>
<p>返回值为成功插入的数量</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">users := []User&#123;</span><br><span class="line">	&#123;Name: <span class="string">&quot;slene&quot;</span>&#125;,</span><br><span class="line">	&#123;Name: <span class="string">&quot;astaxie&quot;</span>&#125;,</span><br><span class="line">	&#123;Name: <span class="string">&quot;unknown&quot;</span>&#125;,</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line">successNums, err := o.InsertMulti(<span class="number">100</span>, users)</span><br></pre></td></tr></table></figure>

<p>bulk 为 1 时，将会顺序插入 slice 中的数据</p>
<h3 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h3><p>第一个返回值为影响的行数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">o := orm.NewOrm()</span><br><span class="line">user := User&#123;Id: <span class="number">1</span>&#125;</span><br><span class="line"><span class="keyword">if</span> o.Read(&amp;user) == <span class="literal">nil</span> &#123;</span><br><span class="line">	user.Name = <span class="string">&quot;MyName&quot;</span></span><br><span class="line">	<span class="keyword">if</span> num, err := o.Update(&amp;user); err == <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(num)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Update 默认更新所有的字段，可以更新指定的字段：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只更新 Name</span></span><br><span class="line">o.Update(&amp;user, <span class="string">&quot;Name&quot;</span>)</span><br><span class="line"><span class="comment">// 指定多个字段</span></span><br><span class="line"><span class="comment">// o.Update(&amp;user, &quot;Field1&quot;, &quot;Field2&quot;, ...)</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>根据复杂条件更新字段值参见 <a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/query.md#update">Update</a></p>
<h3 id="Delete"><a href="#Delete" class="headerlink" title="Delete"></a>Delete</h3><p>第一个返回值为影响的行数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">o := orm.NewOrm()</span><br><span class="line"><span class="keyword">if</span> num, err := o.Delete(&amp;User&#123;Id: <span class="number">1</span>&#125;); err == <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Println(num)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Delete 操作会对反向关系进行操作，此例中 Post 拥有一个到 User 的外键。删除 User 的时候。如果 on_delete 设置为默认的级联操作，将删除对应的 Post</p>
<p><strong>Changed in 1.0.3</strong> 删除以后不会删除 auto field 的值</p>
<h2 id="高级查询"><a href="#高级查询" class="headerlink" title="高级查询"></a>高级查询</h2><p>ORM 以 <strong>QuerySeter</strong> 来组织查询，每个返回 <strong>QuerySeter</strong> 的方法都会获得一个新的 <strong>QuerySeter</strong> 对象。</p>
<p>基本使用方法:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">o := orm.NewOrm()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 QuerySeter 对象，user 为表名</span></span><br><span class="line">qs := o.QueryTable(<span class="string">&quot;user&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以直接使用 Model 结构体作为表名</span></span><br><span class="line">qs = o.QueryTable(&amp;User)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以直接使用对象作为表名</span></span><br><span class="line">user := <span class="built_in">new</span>(User)</span><br><span class="line">qs = o.QueryTable(user) <span class="comment">// 返回 QuerySeter</span></span><br></pre></td></tr></table></figure>

<h3 id="expr"><a href="#expr" class="headerlink" title="expr"></a>expr</h3><p>QuerySeter 中用于描述字段和 sql 操作符，使用简单的 expr 查询方法</p>
<p>字段组合的前后顺序依照表的关系，比如 User 表拥有 Profile 的外键，那么对 User 表查询对应的 Profile.Age 为条件，则使用 <code>Profile__Age</code> 注意，字段的分隔符号使用双下划线 <code>__</code>，除了描述字段， expr 的尾部可以增加操作符以执行对应的 sql 操作。比如 <code>Profile__Age__gt</code> 代表 Profile.Age &gt; 18 的条件查询。</p>
<p>注释后面将描述对应的 sql 语句，仅仅是描述 expr 的类似结果，并不代表实际生成的语句。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">qs.Filter(<span class="string">&quot;id&quot;</span>, <span class="number">1</span>) <span class="comment">// WHERE id = 1</span></span><br><span class="line">qs.Filter(<span class="string">&quot;profile__age&quot;</span>, <span class="number">18</span>) <span class="comment">// WHERE profile.age = 18</span></span><br><span class="line">qs.Filter(<span class="string">&quot;Profile__Age&quot;</span>, <span class="number">18</span>) <span class="comment">// 使用字段名和 Field 名都是允许的</span></span><br><span class="line">qs.Filter(<span class="string">&quot;profile__age__gt&quot;</span>, <span class="number">18</span>) <span class="comment">// WHERE profile.age &gt; 18</span></span><br><span class="line">qs.Filter(<span class="string">&quot;profile__age__gte&quot;</span>, <span class="number">18</span>) <span class="comment">// WHERE profile.age &gt;= 18</span></span><br><span class="line">qs.Filter(<span class="string">&quot;profile__age__in&quot;</span>, <span class="number">18</span>, <span class="number">20</span>) <span class="comment">// WHERE profile.age IN (18, 20)</span></span><br><span class="line"></span><br><span class="line">qs.Filter(<span class="string">&quot;profile__age__in&quot;</span>, <span class="number">18</span>, <span class="number">20</span>).Exclude(<span class="string">&quot;profile__lt&quot;</span>, <span class="number">1000</span>)</span><br><span class="line"><span class="comment">// WHERE profile.age IN (18, 20) AND NOT profile_id &lt; 1000</span></span><br></pre></td></tr></table></figure>

<h3 id="Operators"><a href="#Operators" class="headerlink" title="Operators"></a>Operators</h3><p>当前支持的操作符号：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/?p=mvc/model/query.md#exact">exact</a> &#x2F; <a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/?p=mvc/model/query.md#iexact">iexact</a> 等于</li>
<li><a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/?p=mvc/model/query.md#contains">contains</a> &#x2F; <a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/?p=mvc/model/query.md#icontains">icontains</a> 包含</li>
<li>[gt &#x2F; gte](#gt &#x2F; gte) 大于 &#x2F; 大于等于</li>
<li>[lt &#x2F; lte](#lt &#x2F; lte) 小于 &#x2F; 小于等于</li>
<li><a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/?p=mvc/model/query.md#startswith">startswith</a> &#x2F; <a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/?p=mvc/model/query.md#istartswith">istartswith</a> 以…起始</li>
<li><a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/?p=mvc/model/query.md#endswith">endswith</a> &#x2F; <a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/?p=mvc/model/query.md#iendswith">iendswith</a> 以…结束</li>
<li><a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/?p=mvc/model/query.md#in">in</a></li>
<li><a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/?p=mvc/model/query.md#isnull">isnull</a></li>
</ul>
<p>后面以 <code>i</code> 开头的表示：大小写不敏感</p>
<h3 id="exact"><a href="#exact" class="headerlink" title="exact"></a>exact</h3><p>Filter &#x2F; Exclude &#x2F; Condition expr 的默认值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">qs.Filter(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;slene&quot;</span>) <span class="comment">// WHERE name = &#x27;slene&#x27;</span></span><br><span class="line">qs.Filter(<span class="string">&quot;name__exact&quot;</span>, <span class="string">&quot;slene&quot;</span>) <span class="comment">// WHERE name = &#x27;slene&#x27;</span></span><br><span class="line"><span class="comment">// 使用 = 匹配，大小写是否敏感取决于数据表使用的 collation</span></span><br><span class="line">qs.Filter(<span class="string">&quot;profile_id&quot;</span>, <span class="literal">nil</span>) <span class="comment">// WHERE profile_id IS NULL</span></span><br></pre></td></tr></table></figure>

<h3 id="iexact"><a href="#iexact" class="headerlink" title="iexact"></a>iexact</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">qs.Filter(<span class="string">&quot;name__iexact&quot;</span>, <span class="string">&quot;slene&quot;</span>)</span><br><span class="line"><span class="comment">// WHERE name LIKE &#x27;slene&#x27;</span></span><br><span class="line"><span class="comment">// 大小写不敏感，匹配任意 &#x27;Slene&#x27; &#x27;sLENE&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="contains"><a href="#contains" class="headerlink" title="contains"></a>contains</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">qs.Filter(<span class="string">&quot;name__contains&quot;</span>, <span class="string">&quot;slene&quot;</span>)</span><br><span class="line"><span class="comment">// WHERE name LIKE BINARY &#x27;%slene%&#x27;</span></span><br><span class="line"><span class="comment">// 大小写敏感, 匹配包含 slene 的字符</span></span><br></pre></td></tr></table></figure>

<h3 id="icontains"><a href="#icontains" class="headerlink" title="icontains"></a>icontains</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">qs.Filter(<span class="string">&quot;name__icontains&quot;</span>, <span class="string">&quot;slene&quot;</span>)</span><br><span class="line"><span class="comment">// WHERE name LIKE &#x27;%slene%&#x27;</span></span><br><span class="line"><span class="comment">// 大小写不敏感, 匹配任意 &#x27;im Slene&#x27;, &#x27;im sLENE&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="in"><a href="#in" class="headerlink" title="in"></a>in</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">qs.Filter(<span class="string">&quot;age__in&quot;</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>)</span><br><span class="line"><span class="comment">// WHERE age IN (17, 18, 19, 20)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ids:=[]<span class="type">int</span>&#123;<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>&#125;</span><br><span class="line">qs.Filter(<span class="string">&quot;age__in&quot;</span>, ids)</span><br><span class="line"><span class="comment">// WHERE age IN (17, 18, 19, 20)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 同上效果</span></span><br></pre></td></tr></table></figure>

<h3 id="gt-gte"><a href="#gt-gte" class="headerlink" title="gt &#x2F; gte"></a>gt &#x2F; gte</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">qs.Filter(<span class="string">&quot;profile__age__gt&quot;</span>, <span class="number">17</span>)</span><br><span class="line"><span class="comment">// WHERE profile.age &gt; 17</span></span><br><span class="line"></span><br><span class="line">qs.Filter(<span class="string">&quot;profile__age__gte&quot;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="comment">// WHERE profile.age &gt;= 18</span></span><br></pre></td></tr></table></figure>

<h3 id="lt-lte"><a href="#lt-lte" class="headerlink" title="lt &#x2F; lte"></a>lt &#x2F; lte</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">qs.Filter(<span class="string">&quot;profile__age__lt&quot;</span>, <span class="number">17</span>)</span><br><span class="line"><span class="comment">// WHERE profile.age &lt; 17</span></span><br><span class="line"></span><br><span class="line">qs.Filter(<span class="string">&quot;profile__age__lte&quot;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="comment">// WHERE profile.age &lt;= 18</span></span><br></pre></td></tr></table></figure>

<h3 id="startswith"><a href="#startswith" class="headerlink" title="startswith"></a>startswith</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">qs.Filter(<span class="string">&quot;name__startswith&quot;</span>, <span class="string">&quot;slene&quot;</span>)</span><br><span class="line"><span class="comment">// WHERE name LIKE BINARY &#x27;slene%&#x27;</span></span><br><span class="line"><span class="comment">// 大小写敏感, 匹配以 &#x27;slene&#x27; 起始的字符串</span></span><br></pre></td></tr></table></figure>

<h3 id="istartswith"><a href="#istartswith" class="headerlink" title="istartswith"></a>istartswith</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">qs.Filter(<span class="string">&quot;name__istartswith&quot;</span>, <span class="string">&quot;slene&quot;</span>)</span><br><span class="line"><span class="comment">// WHERE name LIKE &#x27;slene%&#x27;</span></span><br><span class="line"><span class="comment">// 大小写不敏感, 匹配任意以 &#x27;slene&#x27;, &#x27;Slene&#x27; 起始的字符串</span></span><br></pre></td></tr></table></figure>

<h3 id="endswith"><a href="#endswith" class="headerlink" title="endswith"></a>endswith</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">qs.Filter(<span class="string">&quot;name__endswith&quot;</span>, <span class="string">&quot;slene&quot;</span>)</span><br><span class="line"><span class="comment">// WHERE name LIKE BINARY &#x27;%slene&#x27;</span></span><br><span class="line"><span class="comment">// 大小写敏感, 匹配以 &#x27;slene&#x27; 结束的字符串</span></span><br></pre></td></tr></table></figure>

<h3 id="iendswith"><a href="#iendswith" class="headerlink" title="iendswith"></a>iendswith</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">qs.Filter(<span class="string">&quot;name__iendswithi&quot;</span>, <span class="string">&quot;slene&quot;</span>)</span><br><span class="line"><span class="comment">// WHERE name LIKE &#x27;%slene&#x27;</span></span><br><span class="line"><span class="comment">// 大小写不敏感, 匹配任意以 &#x27;slene&#x27;, &#x27;Slene&#x27; 结束的字符串</span></span><br></pre></td></tr></table></figure>

<h3 id="isnull"><a href="#isnull" class="headerlink" title="isnull"></a>isnull</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">qs.Filter(<span class="string">&quot;profile__isnull&quot;</span>, <span class="literal">true</span>)</span><br><span class="line">qs.Filter(<span class="string">&quot;profile_id__isnull&quot;</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="comment">// WHERE profile_id IS NULL</span></span><br><span class="line"></span><br><span class="line">qs.Filter(<span class="string">&quot;profile__isnull&quot;</span>, <span class="literal">false</span>)</span><br><span class="line"><span class="comment">// WHERE profile_id IS NOT NULL</span></span><br></pre></td></tr></table></figure>

<h3 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h3><p>用来过滤查询结果，起到 <strong>包含条件</strong> 的作用</p>
<p>多个 Filter 之间使用 <code>AND</code> 连接</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">qs.Filter(<span class="string">&quot;profile__isnull&quot;</span>, <span class="literal">true</span>).Filter(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;slene&quot;</span>)</span><br><span class="line"><span class="comment">// WHERE profile_id IS NULL AND name = &#x27;slene&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="Exclude"><a href="#Exclude" class="headerlink" title="Exclude"></a>Exclude</h3><p>用来过滤查询结果，起到 <strong>排除条件</strong> 的作用</p>
<p>使用 <code>NOT</code> 排除条件</p>
<p>多个 Exclude 之间使用 <code>AND</code> 连接</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">qs.Exclude(<span class="string">&quot;profile__isnull&quot;</span>, <span class="literal">true</span>).Filter(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;slene&quot;</span>)</span><br><span class="line"><span class="comment">// WHERE NOT profile_id IS NULL AND name = &#x27;slene&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="SetCond"><a href="#SetCond" class="headerlink" title="SetCond"></a>SetCond</h3><p>自定义条件表达式</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cond := orm.NewCondition()</span><br><span class="line">cond1 := cond.And(<span class="string">&quot;profile__isnull&quot;</span>, <span class="literal">false</span>).AndNot(<span class="string">&quot;status__in&quot;</span>, <span class="number">1</span>).Or(<span class="string">&quot;profile__age__gt&quot;</span>, <span class="number">2000</span>)</span><br><span class="line"></span><br><span class="line">qs := orm.QueryTable(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">qs = qs.SetCond(cond1)</span><br><span class="line"><span class="comment">// WHERE ... AND ... AND NOT ... OR ...</span></span><br><span class="line"></span><br><span class="line">cond2 := cond.AndCond(cond1).OrCond(cond.And(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;slene&quot;</span>))</span><br><span class="line">qs = qs.SetCond(cond2).Count()</span><br><span class="line"><span class="comment">// WHERE (... AND ... AND NOT ... OR ...) OR ( ... )</span></span><br></pre></td></tr></table></figure>

<h3 id="Limit"><a href="#Limit" class="headerlink" title="Limit"></a>Limit</h3><p>限制最大返回数据行数，第二个参数可以设置 <code>Offset</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> DefaultRowsLimit = <span class="number">1000</span> <span class="comment">// ORM 默认的 limit 值为 1000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认情况下 select 查询的最大行数为 1000</span></span><br><span class="line"><span class="comment">// LIMIT 1000</span></span><br><span class="line"></span><br><span class="line">qs.Limit(<span class="number">10</span>)</span><br><span class="line"><span class="comment">// LIMIT 10</span></span><br><span class="line"></span><br><span class="line">qs.Limit(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line"><span class="comment">// LIMIT 10 OFFSET 20 注意跟 SQL 反过来的</span></span><br><span class="line"></span><br><span class="line">qs.Limit(<span class="number">-1</span>)</span><br><span class="line"><span class="comment">// no limit</span></span><br><span class="line"></span><br><span class="line">qs.Limit(<span class="number">-1</span>, <span class="number">100</span>)</span><br><span class="line"><span class="comment">// LIMIT 18446744073709551615 OFFSET 100</span></span><br><span class="line"><span class="comment">// 18446744073709551615 是 1&lt;&lt;64 - 1 用来指定无 limit 限制 但有 offset 偏移的情况</span></span><br></pre></td></tr></table></figure>

<h3 id="Offset"><a href="#Offset" class="headerlink" title="Offset"></a>Offset</h3><p>设置 偏移行数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">qs.Offset(<span class="number">20</span>)</span><br><span class="line"><span class="comment">// LIMIT 1000 OFFSET 20</span></span><br></pre></td></tr></table></figure>

<h3 id="GroupBy"><a href="#GroupBy" class="headerlink" title="GroupBy"></a>GroupBy</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">qs.GroupBy(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;age&quot;</span>)</span><br><span class="line"><span class="comment">// GROUP BY id,age</span></span><br></pre></td></tr></table></figure>

<h3 id="OrderBy"><a href="#OrderBy" class="headerlink" title="OrderBy"></a>OrderBy</h3><p>参数使用 <strong>expr</strong></p>
<p>在 expr 前使用减号 <code>-</code> 表示 <code>DESC</code> 的排列</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">qs.OrderBy(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;-profile__age&quot;</span>)</span><br><span class="line"><span class="comment">// ORDER BY id ASC, profile.age DESC</span></span><br><span class="line"></span><br><span class="line">qs.OrderBy(<span class="string">&quot;-profile__age&quot;</span>, <span class="string">&quot;profile&quot;</span>)</span><br><span class="line"><span class="comment">// ORDER BY profile.age DESC, profile_id ASC</span></span><br></pre></td></tr></table></figure>

<h3 id="Distinct"><a href="#Distinct" class="headerlink" title="Distinct"></a>Distinct</h3><p>对应 sql 的 <code>distinct</code> 语句, 返回指定字段不重复的值.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">qs.Distinct()</span><br><span class="line"><span class="comment">// SELECT DISTINCT</span></span><br></pre></td></tr></table></figure>

<h3 id="RelatedSel"><a href="#RelatedSel" class="headerlink" title="RelatedSel"></a>RelatedSel</h3><p>关系查询，参数使用 <strong>expr</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> DefaultRelsDepth = <span class="number">5</span> <span class="comment">// 默认情况下直接调用 RelatedSel 将进行最大 5 层的关系查询</span></span><br><span class="line"></span><br><span class="line">qs := o.QueryTable(<span class="string">&quot;post&quot;</span>)</span><br><span class="line"></span><br><span class="line">qs.RelatedSel()</span><br><span class="line"><span class="comment">// INNER JOIN user ... LEFT OUTER JOIN profile ...</span></span><br><span class="line"></span><br><span class="line">qs.RelatedSel(<span class="string">&quot;user&quot;</span>)</span><br><span class="line"><span class="comment">// INNER JOIN user ...</span></span><br><span class="line"><span class="comment">// 设置 expr 只对设置的字段进行关系查询</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对设置 null 属性的 Field 将使用 LEFT OUTER JOIN</span></span><br></pre></td></tr></table></figure>

<h3 id="Count"><a href="#Count" class="headerlink" title="Count"></a>Count</h3><p>依据当前的查询条件，返回结果行数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cnt, err := o.QueryTable(<span class="string">&quot;user&quot;</span>).Count() <span class="comment">// SELECT COUNT(*) FROM USER</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;Count Num: %s, %s&quot;</span>, cnt, err)</span><br></pre></td></tr></table></figure>

<h3 id="Exist"><a href="#Exist" class="headerlink" title="Exist"></a>Exist</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exist := o.QueryTable(<span class="string">&quot;user&quot;</span>).Filter(<span class="string">&quot;UserName&quot;</span>, <span class="string">&quot;Name&quot;</span>).Exist()</span><br><span class="line">fmt.Printf(<span class="string">&quot;Is Exist: %s&quot;</span>, exist)</span><br></pre></td></tr></table></figure>

<h3 id="Update-1"><a href="#Update-1" class="headerlink" title="Update"></a>Update</h3><p>依据当前查询条件，进行批量更新操作</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">num, err := o.QueryTable(<span class="string">&quot;user&quot;</span>).Filter(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;slene&quot;</span>).Update(orm.Params&#123;</span><br><span class="line">	<span class="string">&quot;name&quot;</span>: <span class="string">&quot;astaxie&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">fmt.Printf(<span class="string">&quot;Affected Num: %s, %s&quot;</span>, num, err)</span><br><span class="line"><span class="comment">// SET name = &quot;astaixe&quot; WHERE name = &quot;slene&quot;</span></span><br></pre></td></tr></table></figure>

<p>原子操作增加字段值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 假设 user struct 里有一个 nums int 字段</span></span><br><span class="line">num, err := o.QueryTable(<span class="string">&quot;user&quot;</span>).Update(orm.Params&#123;</span><br><span class="line">	<span class="string">&quot;nums&quot;</span>: orm.ColValue(orm.ColAdd, <span class="number">100</span>),</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// SET nums = nums + 100</span></span><br></pre></td></tr></table></figure>

<p>orm.ColValue 支持以下操作</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ColAdd      <span class="comment">// 加</span></span><br><span class="line">ColMinus    <span class="comment">// 减</span></span><br><span class="line">ColMultiply <span class="comment">// 乘</span></span><br><span class="line">ColExcept   <span class="comment">// 除</span></span><br></pre></td></tr></table></figure>

<h3 id="Delete-1"><a href="#Delete-1" class="headerlink" title="Delete"></a>Delete</h3><p>依据当前查询条件，进行批量删除操作</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">num, err := o.QueryTable(<span class="string">&quot;user&quot;</span>).Filter(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;slene&quot;</span>).Delete()</span><br><span class="line">fmt.Printf(<span class="string">&quot;Affected Num: %s, %s&quot;</span>, num, err)</span><br><span class="line"><span class="comment">// DELETE FROM user WHERE name = &quot;slene&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="PrepareInsert"><a href="#PrepareInsert" class="headerlink" title="PrepareInsert"></a>PrepareInsert</h3><p>用于一次 prepare 多次 insert 插入，以提高批量插入的速度。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> users []*User</span><br><span class="line">...</span><br><span class="line">qs := o.QueryTable(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">i, _ := qs.PrepareInsert()</span><br><span class="line"><span class="keyword">for</span> _, user := <span class="keyword">range</span> users &#123;</span><br><span class="line">	id, err := i.Insert(user)</span><br><span class="line">	<span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">		...</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// PREPARE INSERT INTO user (`name`, ...) VALUES (?, ...)</span></span><br><span class="line"><span class="comment">// EXECUTE INSERT INTO user (`name`, ...) VALUES (&quot;slene&quot;, ...)</span></span><br><span class="line"><span class="comment">// EXECUTE ...</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">i.Close() <span class="comment">// 别忘记关闭 statement</span></span><br></pre></td></tr></table></figure>

<h3 id="All"><a href="#All" class="headerlink" title="All"></a>All</h3><p>返回对应的结果集对象</p>
<p>All 的参数支持 *[]Type 和 *[]*Type 两种形式的 slice</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> users []*User</span><br><span class="line">num, err := o.QueryTable(<span class="string">&quot;user&quot;</span>).Filter(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;slene&quot;</span>).All(&amp;users)</span><br><span class="line">fmt.Printf(<span class="string">&quot;Returned Rows Num: %s, %s&quot;</span>, num, err)</span><br></pre></td></tr></table></figure>

<p>All &#x2F; Values &#x2F; ValuesList &#x2F; ValuesFlat 受到 <a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/?p=mvc/model/query.md#limit">Limit</a> 的限制，默认最大行数为 1000</p>
<p>可以指定返回的字段：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Post <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id      <span class="type">int</span></span><br><span class="line">	Title   <span class="type">string</span></span><br><span class="line">	Content <span class="type">string</span></span><br><span class="line">	Status  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只返回 Id 和 Title</span></span><br><span class="line"><span class="keyword">var</span> posts []Post</span><br><span class="line">o.QueryTable(<span class="string">&quot;post&quot;</span>).Filter(<span class="string">&quot;Status&quot;</span>, <span class="number">1</span>).All(&amp;posts, <span class="string">&quot;Id&quot;</span>, <span class="string">&quot;Title&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>对象的其他字段值将会是对应类型的默认值</p>
<h3 id="One"><a href="#One" class="headerlink" title="One"></a>One</h3><p>尝试返回单条记录</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> user User</span><br><span class="line">err := o.QueryTable(<span class="string">&quot;user&quot;</span>).Filter(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;slene&quot;</span>).One(&amp;user)</span><br><span class="line"><span class="keyword">if</span> err == orm.ErrMultiRows &#123;</span><br><span class="line">	<span class="comment">// 多条的时候报错</span></span><br><span class="line">	fmt.Printf(<span class="string">&quot;Returned Multi Rows Not One&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> err == orm.ErrNoRows &#123;</span><br><span class="line">	<span class="comment">// 没有找到记录</span></span><br><span class="line">	fmt.Printf(<span class="string">&quot;Not row found&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以指定返回的字段：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只返回 Id 和 Title</span></span><br><span class="line"><span class="keyword">var</span> post Post</span><br><span class="line">o.QueryTable(<span class="string">&quot;post&quot;</span>).Filter(<span class="string">&quot;Content__istartswith&quot;</span>, <span class="string">&quot;prefix string&quot;</span>).One(&amp;post, <span class="string">&quot;Id&quot;</span>, <span class="string">&quot;Title&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>对象的其他字段值将会是对应类型的默认值</p>
<h3 id="Values"><a href="#Values" class="headerlink" title="Values"></a>Values</h3><p>返回结果集的 key &#x3D;&gt; value 值</p>
<p>key 为Model里的Field name, value的值是interface{}类型,例如，如果你要将value赋值给struct中的某字段，需要根据结构体对应字段类型使用<a target="_blank" rel="noopener" href="https://golang.org/ref/spec#Type_assertions">断言</a>获取真实值。举例:<code>Name : m[&quot;Name&quot;].(string)</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> maps []orm.Params</span><br><span class="line">num, err := o.QueryTable(<span class="string">&quot;user&quot;</span>).Values(&amp;maps)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Result Nums: %d\n&quot;</span>, num)</span><br><span class="line">	<span class="keyword">for</span> _, m := <span class="keyword">range</span> maps &#123;</span><br><span class="line">		fmt.Println(m[<span class="string">&quot;Id&quot;</span>], m[<span class="string">&quot;Name&quot;</span>])</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>返回指定的 Field 数据</p>
<p><strong>TODO</strong>: 暂不支持级联查询 <strong>RelatedSel</strong> 直接返回 Values</p>
<p>但可以直接指定 expr 级联返回需要的数据</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> maps []orm.Params</span><br><span class="line">num, err := o.QueryTable(<span class="string">&quot;user&quot;</span>).Values(&amp;maps, <span class="string">&quot;id&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;profile&quot;</span>, <span class="string">&quot;profile__age&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Result Nums: %d\n&quot;</span>, num)</span><br><span class="line">	<span class="keyword">for</span> _, m := <span class="keyword">range</span> maps &#123;</span><br><span class="line">		fmt.Println(m[<span class="string">&quot;Id&quot;</span>], m[<span class="string">&quot;Name&quot;</span>], m[<span class="string">&quot;Profile&quot;</span>], m[<span class="string">&quot;Profile__Age&quot;</span>])</span><br><span class="line">		<span class="comment">// map 中的数据都是展开的，没有复杂的嵌套</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ValuesList"><a href="#ValuesList" class="headerlink" title="ValuesList"></a>ValuesList</h3><p>顾名思义，返回的结果集以slice存储</p>
<p>结果的排列与 Model 中定义的 Field 顺序一致</p>
<p>返回的每个元素值以 string 保存</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lists []orm.ParamsList</span><br><span class="line">num, err := o.QueryTable(<span class="string">&quot;user&quot;</span>).ValuesList(&amp;lists)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Result Nums: %d\n&quot;</span>, num)</span><br><span class="line">	<span class="keyword">for</span> _, row := <span class="keyword">range</span> lists &#123;</span><br><span class="line">		fmt.Println(row)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当然也可以指定 expr 返回指定的 Field</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lists []orm.ParamsList</span><br><span class="line">num, err := o.QueryTable(<span class="string">&quot;user&quot;</span>).ValuesList(&amp;lists, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;profile__age&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Result Nums: %d\n&quot;</span>, num)</span><br><span class="line">	<span class="keyword">for</span> _, row := <span class="keyword">range</span> lists &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Name: %s, Age: %s\m&quot;</span>, row[<span class="number">0</span>], row[<span class="number">1</span>])</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ValuesFlat"><a href="#ValuesFlat" class="headerlink" title="ValuesFlat"></a>ValuesFlat</h3><p>只返回特定的 Field 值，将结果集展开到单个 slice 里</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> list orm.ParamsList</span><br><span class="line">num, err := o.QueryTable(<span class="string">&quot;user&quot;</span>).ValuesFlat(&amp;list, <span class="string">&quot;name&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Result Nums: %d\n&quot;</span>, num)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;All User Names: %s&quot;</span>, strings.Join(list, <span class="string">&quot;, &quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="关系查询"><a href="#关系查询" class="headerlink" title="关系查询"></a>关系查询</h3><h4 id="User-和-Profile-是-OneToOne-的关系"><a href="#User-和-Profile-是-OneToOne-的关系" class="headerlink" title="User 和 Profile 是 OneToOne 的关系"></a>User 和 Profile 是 OneToOne 的关系</h4><p>已经取得了 User 对象，查询 Profile：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">user := &amp;User&#123;Id: <span class="number">1</span>&#125;</span><br><span class="line">o.Read(user)</span><br><span class="line"><span class="keyword">if</span> user.Profile != <span class="literal">nil</span> &#123;</span><br><span class="line">	o.Read(user.Profile)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>直接关联查询：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">user := &amp;User&#123;&#125;</span><br><span class="line">o.QueryTable(<span class="string">&quot;user&quot;</span>).Filter(<span class="string">&quot;Id&quot;</span>, <span class="number">1</span>).RelatedSel().One(user)</span><br><span class="line"><span class="comment">// 自动查询到 Profile</span></span><br><span class="line">fmt.Println(user.Profile)</span><br><span class="line"><span class="comment">// 因为在 Profile 里定义了反向关系的 User，所以 Profile 里的 User 也是自动赋值过的，可以直接取用。</span></span><br><span class="line">fmt.Println(user.Profile.User)</span><br><span class="line"></span><br><span class="line"><span class="comment">// [SELECT T0.`id`, T0.`name`, T0.`profile_id`, T1.`id`, T1.`age` FROM `user` T0 INNER JOIN `profile` T1 ON T1.`id` = T0.`profile_id` WHERE T0.`id` = ? LIMIT 1000] - `1`</span></span><br></pre></td></tr></table></figure>

<p>通过 User 反向查询 Profile：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> profile Profile</span><br><span class="line">err := o.QueryTable(<span class="string">&quot;profile&quot;</span>).Filter(<span class="string">&quot;User__Id&quot;</span>, <span class="number">1</span>).One(&amp;profile)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Println(profile)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Post-和-User-是-ManyToOne-关系，也就是-ForeignKey-为-User"><a href="#Post-和-User-是-ManyToOne-关系，也就是-ForeignKey-为-User" class="headerlink" title="Post 和 User 是 ManyToOne 关系，也就是 ForeignKey 为 User"></a>Post 和 User 是 ManyToOne 关系，也就是 ForeignKey 为 User</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Post <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id    <span class="type">int</span></span><br><span class="line">	Title <span class="type">string</span></span><br><span class="line">	User  *User  <span class="string">`orm:&quot;rel(fk)&quot;`</span></span><br><span class="line">	Tags  []*Tag <span class="string">`orm:&quot;rel(m2m)&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> posts []*Post</span><br><span class="line">num, err := o.QueryTable(<span class="string">&quot;post&quot;</span>).Filter(<span class="string">&quot;User&quot;</span>, <span class="number">1</span>).RelatedSel().All(&amp;posts)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;%d posts read\n&quot;</span>, num)</span><br><span class="line">	<span class="keyword">for</span> _, post := <span class="keyword">range</span> posts &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Id: %d, UserName: %d, Title: %s\n&quot;</span>, post.Id, post.User.UserName, post.Title)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// [SELECT T0.`id`, T0.`title`, T0.`user_id`, T1.`id`, T1.`name`, T1.`profile_id`, T2.`id`, T2.`age` FROM `post` T0 INNER JOIN `user` T1 ON T1.`id` = T0.`user_id` INNER JOIN `profile` T2 ON T2.`id` = T1.`profile_id` WHERE T0.`user_id` = ? LIMIT 1000] - `1`</span></span><br></pre></td></tr></table></figure>

<p>根据 Post.Title 查询对应的 User：</p>
<p>RegisterModel 时，ORM 也会自动建立 User 中 Post 的反向关系，所以可以直接进行查询</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> user User</span><br><span class="line">err := o.QueryTable(<span class="string">&quot;user&quot;</span>).Filter(<span class="string">&quot;Post__Title&quot;</span>, <span class="string">&quot;The Title&quot;</span>).Limit(<span class="number">1</span>).One(&amp;user)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Printf(user)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Post-和-Tag-是-ManyToMany-关系"><a href="#Post-和-Tag-是-ManyToMany-关系" class="headerlink" title="Post 和 Tag 是 ManyToMany 关系"></a>Post 和 Tag 是 ManyToMany 关系</h4><p>设置 rel(m2m) 以后，ORM 会自动创建中间表</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Post <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id    <span class="type">int</span></span><br><span class="line">	Title <span class="type">string</span></span><br><span class="line">	User  *User  <span class="string">`orm:&quot;rel(fk)&quot;`</span></span><br><span class="line">	Tags  []*Tag <span class="string">`orm:&quot;rel(m2m)&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Tag <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id    <span class="type">int</span></span><br><span class="line">	Name  <span class="type">string</span></span><br><span class="line">	Posts []*Post <span class="string">`orm:&quot;reverse(many)&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一条 Post 纪录可能对应不同的 Tag 纪录,一条 Tag 纪录可能对应不同的 Post 纪录，所以 Post 和 Tag 属于多对多关系,通过 tag name 查询哪些 post 使用了这个 tag</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> posts []*Post</span><br><span class="line">num, err := dORM.QueryTable(<span class="string">&quot;post&quot;</span>).Filter(<span class="string">&quot;Tags__Tag__Name&quot;</span>, <span class="string">&quot;golang&quot;</span>).All(&amp;posts)</span><br></pre></td></tr></table></figure>

<p>通过 post title 查询这个 post 有哪些 tag</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tags []*Tag</span><br><span class="line">num, err := dORM.QueryTable(<span class="string">&quot;tag&quot;</span>).Filter(<span class="string">&quot;Posts__Post__Title&quot;</span>, <span class="string">&quot;Introduce Beego ORM&quot;</span>).All(&amp;tags)</span><br></pre></td></tr></table></figure>

<h3 id="载入关系字段"><a href="#载入关系字段" class="headerlink" title="载入关系字段"></a>载入关系字段</h3><p>LoadRelated 用于载入模型的关系字段，包括所有的 rel&#x2F;reverse - one&#x2F;many 关系</p>
<p>ManyToMany 关系字段载入</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 载入相应的 Tags</span></span><br><span class="line">post := Post&#123;Id: <span class="number">1</span>&#125;</span><br><span class="line">err := o.Read(&amp;post)</span><br><span class="line">num, err := o.LoadRelated(&amp;post, <span class="string">&quot;Tags&quot;</span>)</span><br><span class="line"><span class="comment">// 载入相应的 Posts</span></span><br><span class="line">tag := Tag&#123;Id: <span class="number">1</span>&#125;</span><br><span class="line">err := o.Read(&amp;tag)</span><br><span class="line">num, err := o.LoadRelated(&amp;tag, <span class="string">&quot;Posts&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>User 是 Post 的 ForeignKey，对应的 ReverseMany 关系字段载入</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id    <span class="type">int</span></span><br><span class="line">	Name  <span class="type">string</span></span><br><span class="line">	Posts []*Post <span class="string">`orm:&quot;reverse(many)&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">user := User&#123;Id: <span class="number">1</span>&#125;</span><br><span class="line">err := dORM.Read(&amp;user)</span><br><span class="line">num, err := dORM.LoadRelated(&amp;user, <span class="string">&quot;Posts&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> _, post := <span class="keyword">range</span> user.Posts &#123;</span><br><span class="line">	<span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="多对多关系操作"><a href="#多对多关系操作" class="headerlink" title="多对多关系操作"></a>多对多关系操作</h3><ul>
<li>type QueryM2Mer interface {<ul>
<li><a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/?p=mvc/model/query.md#querym2mer-add">Add(…interface{}) (int64, error)</a></li>
<li><a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/?p=mvc/model/query.md#querym2mer-remove">Remove(…interface{}) (int64, error)</a></li>
<li><a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/?p=mvc/model/query.md#querym2mer-exist">Exist(interface{}) bool</a></li>
<li><a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/?p=mvc/model/query.md#querym2mer-clear">Clear() (int64, error)</a></li>
<li><a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/?p=mvc/model/query.md#querym2mer-count">Count() (int64, error)</a></li>
</ul>
</li>
<li>}</li>
</ul>
<p>创建一个 QueryM2Mer 对象</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">o := orm.NewOrm()</span><br><span class="line">post := Post&#123;Id: <span class="number">1</span>&#125;</span><br><span class="line">m2m := o.QueryM2M(&amp;post, <span class="string">&quot;Tags&quot;</span>)</span><br><span class="line"><span class="comment">// 第一个参数的对象，主键必须有值</span></span><br><span class="line"><span class="comment">// 第二个参数为对象需要操作的 M2M 字段</span></span><br><span class="line"><span class="comment">// QueryM2Mer 的 api 将作用于 Id 为 1 的 Post</span></span><br></pre></td></tr></table></figure>

<h4 id="QueryM2Mer-Add"><a href="#QueryM2Mer-Add" class="headerlink" title="QueryM2Mer Add"></a>QueryM2Mer Add</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tag := &amp;Tag&#123;Name: <span class="string">&quot;golang&quot;</span>&#125;</span><br><span class="line">o.Insert(tag)</span><br><span class="line"></span><br><span class="line">num, err := m2m.Add(tag)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Added nums: &quot;</span>, num)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Add 支持多种类型 Tag *Tag []*Tag []Tag []interface{}</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tags []*Tag</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 读取 tags 以后</span></span><br><span class="line">...</span><br><span class="line">num, err := m2m.Add(tags)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Added nums: &quot;</span>, num)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 也可以多个作为参数传入</span></span><br><span class="line"><span class="comment">// m2m.Add(tag1, tag2, tag3)</span></span><br></pre></td></tr></table></figure>

<h4 id="QueryM2Mer-Remove"><a href="#QueryM2Mer-Remove" class="headerlink" title="QueryM2Mer Remove"></a>QueryM2Mer Remove</h4><p>从M2M关系中删除 tag</p>
<p>Remove 支持多种类型 Tag *Tag []*Tag []Tag []interface{}</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tags []*Tag</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 读取 tags 以后</span></span><br><span class="line">...</span><br><span class="line">num, err := m2m.Remove(tags)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Removed nums: &quot;</span>, num)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 也可以多个作为参数传入</span></span><br><span class="line"><span class="comment">// m2m.Remove(tag1, tag2, tag3)</span></span><br></pre></td></tr></table></figure>

<h4 id="QueryM2Mer-Exist"><a href="#QueryM2Mer-Exist" class="headerlink" title="QueryM2Mer Exist"></a>QueryM2Mer Exist</h4><p>判断 Tag 是否存在于 M2M 关系中</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> m2m.Exist(&amp;Tag&#123;Id: <span class="number">2</span>&#125;) &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Tag Exist&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="QueryM2Mer-Clear"><a href="#QueryM2Mer-Clear" class="headerlink" title="QueryM2Mer Clear"></a>QueryM2Mer Clear</h4><p>清除所有 M2M 关系</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nums, err := m2m.Clear()</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Removed Tag Nums: &quot;</span>, nums)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="QueryM2Mer-Count"><a href="#QueryM2Mer-Count" class="headerlink" title="QueryM2Mer Count"></a>QueryM2Mer Count</h4><p>计算 Tag 的数量</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nums, err := m2m.Count()</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Total Nums: &quot;</span>, nums)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="原生-SQL-查询"><a href="#原生-SQL-查询" class="headerlink" title="原生 SQL 查询"></a>原生 SQL 查询</h2><ul>
<li>使用 Raw SQL 查询，无需使用 ORM 表定义</li>
<li>多数据库，都可直接使用占位符号 <code>?</code>，自动转换</li>
<li>查询时的参数，支持使用 Model Struct 和 Slice, Array</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">o := orm.NewOrm()</span><br><span class="line">ids := []<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line"><span class="keyword">var</span> r RawSter</span><br><span class="line">r = o.Raw(<span class="string">&quot;SELECT name FROM user WHERE id IN (?, ?, ?)&quot;</span>, ids)</span><br></pre></td></tr></table></figure>

<p>创建一个 <strong>RawSeter</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">o := orm.NewOrm()</span><br><span class="line"><span class="keyword">var</span> r RawSeter</span><br><span class="line">r = o.Raw(<span class="string">&quot;UPDATE user SET name = ? WHERE name = ?&quot;</span>, <span class="string">&quot;testing&quot;</span>, <span class="string">&quot;slene&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Exec"><a href="#Exec" class="headerlink" title="Exec"></a>Exec</h3><p>执行 sql 语句，返回 <a target="_blank" rel="noopener" href="http://gowalker.org/database/sql#Result">sql.Result</a> 对象</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">res, err := o.Raw(<span class="string">&quot;UPDATE user SET name = ?&quot;</span>, <span class="string">&quot;your&quot;</span>).Exec()</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">	num, _ := res.RowsAffected()</span><br><span class="line">	fmt.Println(<span class="string">&quot;mysql row affected nums: &quot;</span>, num)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="QueryRow"><a href="#QueryRow" class="headerlink" title="QueryRow"></a>QueryRow</h3><p>QueryRow 和 QueryRows 提供高级 sql mapper 功能</p>
<p>支持 struct</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id       <span class="type">int</span></span><br><span class="line">	UserName <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> user User</span><br><span class="line">err := o.Raw(<span class="string">&quot;SELECT id, user_name FROM user WHERE id = ?&quot;</span>, <span class="number">1</span>).QueryRow(&amp;user)</span><br></pre></td></tr></table></figure>

<h3 id="QueryRows"><a href="#QueryRows" class="headerlink" title="QueryRows"></a>QueryRows</h3><p>QueryRows 支持的对象还有 map 规则是和 QueryRow 一样的，但都是 slice</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id       <span class="type">int</span></span><br><span class="line">	UserName <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> users []User</span><br><span class="line">num, err := o.Raw(<span class="string">&quot;SELECT id, user_name FROM user WHERE id = ?&quot;</span>, <span class="number">1</span>).QueryRows(&amp;users)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;user nums: &quot;</span>, num)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SetArgs"><a href="#SetArgs" class="headerlink" title="SetArgs"></a>SetArgs</h3><p>改变 Raw(sql, args…) 中的 args 参数，返回一个新的 RawSeter</p>
<p>用于单条 sql 语句，重复利用，替换参数然后执行。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res, err := r.SetArgs(<span class="string">&quot;arg1&quot;</span>, <span class="string">&quot;arg2&quot;</span>).Exec()</span><br><span class="line">res, err := r.SetArgs(<span class="string">&quot;arg1&quot;</span>, <span class="string">&quot;arg2&quot;</span>).Exec()</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="Values-ValuesList-ValuesFlat"><a href="#Values-ValuesList-ValuesFlat" class="headerlink" title="Values &#x2F; ValuesList &#x2F; ValuesFlat"></a>Values &#x2F; ValuesList &#x2F; ValuesFlat</h3><p>Raw SQL 查询获得的结果集 Value 为 <code>string</code> 类型，NULL 字段的值为空 &#96;&#96;</p>
<h3 id="Values-1"><a href="#Values-1" class="headerlink" title="Values"></a>Values</h3><p>返回结果集的 key &#x3D;&gt; value 值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> maps []orm.Params</span><br><span class="line">num, err := o.Raw(<span class="string">&quot;SELECT user_name FROM user WHERE status = ?&quot;</span>, <span class="number">1</span>).Values(&amp;maps)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &amp;&amp; num &gt; <span class="number">0</span> &#123;</span><br><span class="line">	fmt.Println(maps[<span class="number">0</span>][<span class="string">&quot;user_name&quot;</span>]) <span class="comment">// slene</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ValuesList-1"><a href="#ValuesList-1" class="headerlink" title="ValuesList"></a>ValuesList</h3><p>返回结果集 slice</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lists []orm.ParamsList</span><br><span class="line">num, err := o.Raw(<span class="string">&quot;SELECT user_name FROM user WHERE status = ?&quot;</span>, <span class="number">1</span>).ValuesList(&amp;lists)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &amp;&amp; num &gt; <span class="number">0</span> &#123;</span><br><span class="line">	fmt.Println(lists[<span class="number">0</span>][<span class="number">0</span>]) <span class="comment">// slene</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ValuesFlat-1"><a href="#ValuesFlat-1" class="headerlink" title="ValuesFlat"></a>ValuesFlat</h3><p>返回单一字段的平铺 slice 数据</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> list orm.ParamsList</span><br><span class="line">num, err := o.Raw(<span class="string">&quot;SELECT id FROM user WHERE id &lt; ?&quot;</span>, <span class="number">10</span>).ValuesFlat(&amp;list)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &amp;&amp; num &gt; <span class="number">0</span> &#123;</span><br><span class="line">	fmt.Println(list) <span class="comment">// []&#123;&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,...&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="RowsToMap"><a href="#RowsToMap" class="headerlink" title="RowsToMap"></a>RowsToMap</h3><p>SQL 查询结果是这样</p>
<table>
<thead>
<tr>
<th align="left">name</th>
<th align="left">value</th>
</tr>
</thead>
<tbody><tr>
<td align="left">total</td>
<td align="left">100</td>
</tr>
<tr>
<td align="left">found</td>
<td align="left">200</td>
</tr>
</tbody></table>
<p>查询结果匹配到 map 里</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">res := <span class="built_in">make</span>(orm.Params)</span><br><span class="line">nums, err := o.Raw(<span class="string">&quot;SELECT name, value FROM options_table&quot;</span>).RowsToMap(&amp;res, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;value&quot;</span>)</span><br><span class="line"><span class="comment">// res is a map[string]interface&#123;&#125;&#123;</span></span><br><span class="line"><span class="comment">//	&quot;total&quot;: 100,</span></span><br><span class="line"><span class="comment">//	&quot;found&quot;: 200,</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="RowsToStruct"><a href="#RowsToStruct" class="headerlink" title="RowsToStruct"></a>RowsToStruct</h3><p>SQL 查询结果是这样</p>
<table>
<thead>
<tr>
<th align="left">name</th>
<th align="left">value</th>
</tr>
</thead>
<tbody><tr>
<td align="left">total</td>
<td align="left">100</td>
</tr>
<tr>
<td align="left">found</td>
<td align="left">200</td>
</tr>
</tbody></table>
<p>查询结果匹配到 struct 里</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Options <span class="keyword">struct</span> &#123;</span><br><span class="line">	Total <span class="type">int</span></span><br><span class="line">	Found <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res := <span class="built_in">new</span>(Options)</span><br><span class="line">nums, err := o.Raw(<span class="string">&quot;SELECT name, value FROM options_table&quot;</span>).RowsToStruct(res, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;value&quot;</span>)</span><br><span class="line">fmt.Println(res.Total) <span class="comment">// 100</span></span><br><span class="line">fmt.Println(res.Found) <span class="comment">// 200</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>匹配支持的名称转换为 snake -&gt; camel, eg: SELECT user_name … 需要你的 struct 中定义有 UserName</p>
</blockquote>
<h3 id="Prepare"><a href="#Prepare" class="headerlink" title="Prepare"></a>Prepare</h3><p>用于一次 prepare 多次 exec，以提高批量执行的速度。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">p, err := o.Raw(<span class="string">&quot;UPDATE user SET name = ? WHERE name = ?&quot;</span>).Prepare()</span><br><span class="line">res, err := p.Exec(<span class="string">&quot;testing&quot;</span>, <span class="string">&quot;slene&quot;</span>)</span><br><span class="line">res, err  = p.Exec(<span class="string">&quot;testing&quot;</span>, <span class="string">&quot;astaxie&quot;</span>)</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">p.Close() <span class="comment">// 别忘记关闭 statement</span></span><br></pre></td></tr></table></figure>

<h2 id="构造查询"><a href="#构造查询" class="headerlink" title="构造查询"></a>构造查询</h2><p><strong>QueryBuilder</strong> 提供了一个简便，流畅的 SQL 查询构造器。在不影响代码可读性的前提下用来快速的建立 SQL 语句。</p>
<p><strong>QueryBuilder</strong> 在功能上与 ORM 重合， 但是各有利弊。ORM 更适用于简单的 CRUD 操作，而 QueryBuilder 则更适用于复杂的查询，例如查询中包含子查询和多重联结。</p>
<p>使用方法:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// User 包装了下面的查询结果</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	Age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> users []User</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 QueryBuilder 对象. 需要指定数据库驱动参数。</span></span><br><span class="line"><span class="comment">// 第二个返回值是错误对象，在这里略过</span></span><br><span class="line">qb, _ := orm.NewQueryBuilder(<span class="string">&quot;mysql&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建查询对象</span></span><br><span class="line">qb.Select(<span class="string">&quot;user.name&quot;</span>,</span><br><span class="line">	<span class="string">&quot;profile.age&quot;</span>).</span><br><span class="line">	From(<span class="string">&quot;user&quot;</span>).</span><br><span class="line">	InnerJoin(<span class="string">&quot;profile&quot;</span>).On(<span class="string">&quot;user.id_user = profile.fk_user&quot;</span>).</span><br><span class="line">	Where(<span class="string">&quot;age &gt; ?&quot;</span>).</span><br><span class="line">	OrderBy(<span class="string">&quot;name&quot;</span>).Desc().</span><br><span class="line">	Limit(<span class="number">10</span>).Offset(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出 SQL 语句</span></span><br><span class="line">sql := qb.String()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行 SQL 语句</span></span><br><span class="line">o := orm.NewOrm()</span><br><span class="line">o.Raw(sql, <span class="number">20</span>).QueryRows(&amp;users)</span><br></pre></td></tr></table></figure>

<h2 id="模型定义"><a href="#模型定义" class="headerlink" title="模型定义"></a>模型定义</h2><p>复杂的模型定义不是必须的，此功能用作数据库数据转换和<a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/cmd.md#%E8%87%AA%E5%8A%A8%E5%BB%BA%E8%A1%A8">自动建表</a></p>
<p>默认的表名规则，使用驼峰转蛇形：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AuthUser -&gt; auth_user</span><br><span class="line">Auth_User -&gt; auth__user</span><br><span class="line">DB_AuthUser -&gt; d_b__auth_user</span><br></pre></td></tr></table></figure>

<p>除了开头的大写字母以外，遇到大写会增加 <code>_</code>，原名称中的下划线保留。</p>
<h3 id="自定义表名"><a href="#自定义表名" class="headerlink" title="自定义表名"></a>自定义表名</h3><p>实现接口<code>TableNameI</code>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id <span class="type">int</span></span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> TableName() <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;auth_user&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果<a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/orm.md#registermodelwithprefix">前缀设置</a>为 <code>prefix_</code> 那么表名为：prefix_auth_user</p>
<h3 id="设置参数"><a href="#设置参数" class="headerlink" title="设置参数"></a>设置参数</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orm:<span class="string">&quot;null;rel(fk)&quot;</span></span><br></pre></td></tr></table></figure>

<p>多个设置间使用 <code>;</code> 分隔，设置的值如果是多个，使用 <code>,</code> 分隔。</p>
<h4 id="忽略字段"><a href="#忽略字段" class="headerlink" title="忽略字段"></a>忽略字段</h4><p>设置 <code>-</code> 即可忽略 struct 中的字段</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">	AnyField <span class="type">string</span> <span class="string">`orm:&quot;-&quot;`</span></span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="auto"><a href="#auto" class="headerlink" title="auto"></a>auto</h4><p>当 Field 类型为 int, int32, int64, uint, uint32, uint64 时，可以设置字段为自增健</p>
<ul>
<li>当模型定义里没有主键时，符合上述类型且名称为 <code>Id</code> 的 Field 将被视为自增健。</li>
</ul>
<p>鉴于 go 目前的设计，即使使用了 uint64，但你也不能存储到他的最大值。依然会作为 int64 处理。</p>
<h4 id="pk"><a href="#pk" class="headerlink" title="pk"></a>pk</h4><p>设置为主键，适用于自定义其他类型为主键</p>
<h4 id="null"><a href="#null" class="headerlink" title="null"></a>null</h4><p>数据库表默认为 <code>NOT NULL</code>，设置 null 代表 <code>ALLOW NULL</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Name <span class="type">string</span> <span class="string">`orm:&quot;null&quot;`</span></span><br></pre></td></tr></table></figure>

<h4 id="index"><a href="#index" class="headerlink" title="index"></a>index</h4><p>为单个字段增加索引</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Name <span class="type">string</span> <span class="string">`orm:&quot;index&quot;`</span></span><br></pre></td></tr></table></figure>

<h4 id="unique"><a href="#unique" class="headerlink" title="unique"></a>unique</h4><p>为单个字段增加 unique 键</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Name <span class="type">string</span> <span class="string">`orm:&quot;unique&quot;`</span></span><br></pre></td></tr></table></figure>

<h4 id="column"><a href="#column" class="headerlink" title="column"></a>column</h4><p>为字段设置 db 字段的名称</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Name <span class="type">string</span> <span class="string">`orm:&quot;column(user_name)&quot;`</span></span><br></pre></td></tr></table></figure>

<h4 id="size"><a href="#size" class="headerlink" title="size"></a>size</h4><p>string 类型字段默认为 varchar(255)</p>
<p>设置 size 以后，db type 将使用 varchar(size)</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Title <span class="type">string</span> <span class="string">`orm:&quot;size(60)&quot;`</span></span><br></pre></td></tr></table></figure>

<h4 id="digits-decimals"><a href="#digits-decimals" class="headerlink" title="digits &#x2F; decimals"></a>digits &#x2F; decimals</h4><p>设置 float32, float64 类型的浮点精度</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Money <span class="type">float64</span> <span class="string">`orm:&quot;digits(12);decimals(4)&quot;`</span></span><br></pre></td></tr></table></figure>

<p>总长度 12 小数点后 4 位 eg: <code>99999999.9999</code></p>
<h4 id="auto-now-auto-now-add"><a href="#auto-now-auto-now-add" class="headerlink" title="auto_now &#x2F; auto_now_add"></a>auto_now &#x2F; auto_now_add</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Created time.Time <span class="string">`orm:&quot;auto_now_add;type(datetime)&quot;`</span></span><br><span class="line">Updated time.Time <span class="string">`orm:&quot;auto_now;type(datetime)&quot;`</span></span><br></pre></td></tr></table></figure>

<ul>
<li>auto_now 每次 model 保存时都会对时间自动更新</li>
<li>auto_now_add 第一次保存时才设置时间</li>
</ul>
<p>对于批量的 update 此设置是不生效的</p>
<h4 id="type"><a href="#type" class="headerlink" title="type"></a>type</h4><p>设置为 date 时，time.Time 字段的对应 db 类型使用 date</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Created time.Time <span class="string">`orm:&quot;auto_now_add;type(date)&quot;`</span></span><br></pre></td></tr></table></figure>

<p>设置为 datetime 时，time.Time 字段的对应 db 类型使用 datetime</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Created time.Time <span class="string">`orm:&quot;auto_now_add;type(datetime)&quot;`</span></span><br></pre></td></tr></table></figure>

<h4 id="default"><a href="#default" class="headerlink" title="default"></a>default</h4><p>在 v2.x 里面，我们提供了默认值的Filter:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;github.com/beego/beego/v2/client/orm/filter/bean&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/beego/beego/v2/client/orm&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> DefaultValueTestEntity <span class="keyword">struct</span> &#123;</span><br><span class="line">Id            <span class="type">int</span></span><br><span class="line">Age           <span class="type">int</span> <span class="string">`default:&quot;12&quot;`</span></span><br><span class="line">AgeInOldStyle <span class="type">int</span> <span class="string">`orm:&quot;default(13);bee()&quot;`</span></span><br><span class="line">AgeIgnore     <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">XXX</span><span class="params">()</span></span> &#123;</span><br><span class="line">    builder := bean.NewDefaultValueFilterChainBuilder(<span class="literal">nil</span>, <span class="literal">true</span>, <span class="literal">true</span>)</span><br><span class="line">    orm.AddGlobalFilterChain(builder.FilterChain)</span><br><span class="line">    o := orm.NewOrm()</span><br><span class="line">    _, _ = o.Insert(&amp;User&#123;</span><br><span class="line">        ID: <span class="number">1</span>,</span><br><span class="line">        Name: <span class="string">&quot;Tom&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们一个很重要的认识，是认为显式设置值才是更加优雅的实践，所以我们将默认值的功能做成了一种可选的<code>filter</code>实现。</p>
<h4 id="Comment"><a href="#Comment" class="headerlink" title="Comment"></a>Comment</h4><p>为字段添加注释</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	...</span><br><span class="line">	Status <span class="type">int</span> <span class="string">`orm:&quot;default(1);description(这是状态字段)&quot;`</span></span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意: 注释中禁止包含引号</p>
<h4 id="Precision"><a href="#Precision" class="headerlink" title="Precision"></a>Precision</h4><p>为<code>datetime</code>字段设置精度值位数，不同DB支持最大精度值位数也不一致。</p>
<p>type User struct {<br>…<br>Created time.Time <code>orm:&quot;type(datetime);precision(4)&quot;</code><br>…<br>}</p>
<h3 id="表关系设置"><a href="#表关系设置" class="headerlink" title="表关系设置"></a>表关系设置</h3><h4 id="rel-reverse"><a href="#rel-reverse" class="headerlink" title="rel &#x2F; reverse"></a>rel &#x2F; reverse</h4><p><strong>RelOneToOne</strong>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	...</span><br><span class="line">	Profile *Profile <span class="string">`orm:&quot;null;rel(one);on_delete(set_null)&quot;`</span></span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对应的反向关系 <strong>RelReverseOne</strong>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Profile <span class="keyword">struct</span> &#123;</span><br><span class="line">	...</span><br><span class="line">	User *User <span class="string">`orm:&quot;reverse(one)&quot;`</span></span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>RelForeignKey</strong>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Post <span class="keyword">struct</span> &#123;</span><br><span class="line">	...</span><br><span class="line">	User *User <span class="string">`orm:&quot;rel(fk)&quot;`</span> <span class="comment">// RelForeignKey relation</span></span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对应的反向关系 <strong>RelReverseMany</strong>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	...</span><br><span class="line">	Posts []*Post <span class="string">`orm:&quot;reverse(many)&quot;`</span> <span class="comment">// fk 的反向关系</span></span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>RelManyToMany</strong>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Post <span class="keyword">struct</span> &#123;</span><br><span class="line">	...</span><br><span class="line">	Tags []*Tag <span class="string">`orm:&quot;rel(m2m)&quot;`</span> <span class="comment">// ManyToMany relation</span></span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对应的反向关系 <strong>RelReverseMany</strong>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Tag <span class="keyword">struct</span> &#123;</span><br><span class="line">	...</span><br><span class="line">	Posts []*Post <span class="string">`orm:&quot;reverse(many)&quot;`</span></span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="rel-table-rel-through"><a href="#rel-table-rel-through" class="headerlink" title="rel_table &#x2F; rel_through"></a>rel_table &#x2F; rel_through</h4><p>此设置针对 <code>orm:&quot;rel(m2m)&quot;</code> 的关系字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rel_table       设置自动生成的 m2m 关系表的名称</span><br><span class="line">rel_through     如果要在 m2m 关系中使用自定义的 m2m 关系表</span><br><span class="line">                通过这个设置其名称，格式为 pkg.path.ModelName</span><br><span class="line">                eg: app.models.PostTagRel</span><br><span class="line">                PostTagRel 表需要有到 Post 和 Tag 的关系</span><br></pre></td></tr></table></figure>

<p>当设置 rel_table 时会忽略 rel_through</p>
<p>设置方法：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">orm:<span class="string">&quot;rel(m2m);rel_table(the_table_name)&quot;</span></span><br><span class="line">orm:<span class="string">&quot;rel(m2m);rel_through(pkg.path.ModelName)&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="on-delete"><a href="#on-delete" class="headerlink" title="on_delete"></a>on_delete</h4><p>设置对应的 rel 关系删除时，如何处理关系字段。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cascade        级联删除(默认值)</span><br><span class="line">set_null       设置为 NULL，需要设置 null = <span class="literal">true</span></span><br><span class="line">set_default    设置为默认值，需要设置 <span class="keyword">default</span> 值</span><br><span class="line">do_nothing     什么也不做，忽略</span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	...</span><br><span class="line">	Profile *Profile <span class="string">`orm:&quot;null;rel(one);on_delete(set_null)&quot;`</span></span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Profile <span class="keyword">struct</span> &#123;</span><br><span class="line">	...</span><br><span class="line">	User *User <span class="string">`orm:&quot;reverse(one)&quot;`</span></span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除 Profile 时将设置 User.Profile 的数据库字段为 NULL</span></span><br></pre></td></tr></table></figure>

<h4 id="关于-on-delete-的相关例子"><a href="#关于-on-delete-的相关例子" class="headerlink" title="关于 on_delete 的相关例子"></a>关于 on_delete 的相关例子</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    Id <span class="type">int</span></span><br><span class="line">    Name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Post <span class="keyword">struct</span> &#123;</span><br><span class="line">    Id <span class="type">int</span></span><br><span class="line">    Title <span class="type">string</span></span><br><span class="line">    User *User <span class="string">`orm:&quot;rel(fk)&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>假设 Post -&gt; User 是 ManyToOne 的关系，也就是外键。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">o.Filter(<span class="string">&quot;Id&quot;</span>, <span class="number">1</span>).Delete()</span><br></pre></td></tr></table></figure>

<p>这个时候即会删除 Id 为 1 的 User 也会删除其发布的 Post</p>
<p>不想删除的话，需要设置 set_null</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Post <span class="keyword">struct</span> &#123;</span><br><span class="line">    Id <span class="type">int</span></span><br><span class="line">    Title <span class="type">string</span></span><br><span class="line">    User *User <span class="string">`orm:&quot;rel(fk);null;on_delete(set_null)&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那这个时候，删除 User 只会把对应的 Post.user_id 设置为 NULL</p>
<p>当然有时候为了高性能的需要，多存点数据无所谓啊，造成批量删除才是问题。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Post <span class="keyword">struct</span> &#123;</span><br><span class="line">    Id <span class="type">int</span></span><br><span class="line">    Title <span class="type">string</span></span><br><span class="line">    User *User <span class="string">`orm:&quot;rel(fk);null;on_delete(do_nothing)&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么只要删除的时候，不操作 Post 就可以了。</p>
<h3 id="模型字段与数据库类型的对应"><a href="#模型字段与数据库类型的对应" class="headerlink" title="模型字段与数据库类型的对应"></a>模型字段与数据库类型的对应</h3><p>在此列出 ORM 推荐的对应数据库类型，自动建表功能也会以此为标准。</p>
<p>默认所有的字段都是 <strong>NOT NULL</strong></p>
<h4 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h4><table>
<thead>
<tr>
<th align="left">go</th>
<th align="left">mysql</th>
</tr>
</thead>
<tbody><tr>
<td align="left">int, int32 - 设置 auto 或者名称为 <code>Id</code> 时</td>
<td align="left">integer AUTO_INCREMENT</td>
</tr>
<tr>
<td align="left">int64 - 设置 auto 或者名称为 <code>Id</code> 时</td>
<td align="left">bigint AUTO_INCREMENT</td>
</tr>
<tr>
<td align="left">uint, uint32 - 设置 auto 或者名称为 <code>Id</code> 时</td>
<td align="left">integer unsigned AUTO_INCREMENT</td>
</tr>
<tr>
<td align="left">uint64 - 设置 auto 或者名称为 <code>Id</code> 时</td>
<td align="left">bigint unsigned AUTO_INCREMENT</td>
</tr>
<tr>
<td align="left">bool</td>
<td align="left">bool</td>
</tr>
<tr>
<td align="left">string - 默认为 size 255</td>
<td align="left">varchar(size)</td>
</tr>
<tr>
<td align="left">string - 设置 type(char) 时</td>
<td align="left">char(size)</td>
</tr>
<tr>
<td align="left">string - 设置 type(text) 时</td>
<td align="left">longtext</td>
</tr>
<tr>
<td align="left">time.Time - 设置 type 为 date 时</td>
<td align="left">date</td>
</tr>
<tr>
<td align="left">time.Time</td>
<td align="left">datetime</td>
</tr>
<tr>
<td align="left">byte</td>
<td align="left">tinyint unsigned</td>
</tr>
<tr>
<td align="left">rune</td>
<td align="left">integer</td>
</tr>
<tr>
<td align="left">int</td>
<td align="left">integer</td>
</tr>
<tr>
<td align="left">int8</td>
<td align="left">tinyint</td>
</tr>
<tr>
<td align="left">int16</td>
<td align="left">smallint</td>
</tr>
<tr>
<td align="left">int32</td>
<td align="left">integer</td>
</tr>
<tr>
<td align="left">int64</td>
<td align="left">bigint</td>
</tr>
<tr>
<td align="left">uint</td>
<td align="left">integer unsigned</td>
</tr>
<tr>
<td align="left">uint8</td>
<td align="left">tinyint unsigned</td>
</tr>
<tr>
<td align="left">uint16</td>
<td align="left">smallint unsigned</td>
</tr>
<tr>
<td align="left">uint32</td>
<td align="left">integer unsigned</td>
</tr>
<tr>
<td align="left">uint64</td>
<td align="left">bigint unsigned</td>
</tr>
<tr>
<td align="left">float32</td>
<td align="left">double precision</td>
</tr>
<tr>
<td align="left">float64</td>
<td align="left">double precision</td>
</tr>
<tr>
<td align="left">float64 - 设置 digits, decimals 时</td>
<td align="left">numeric(digits, decimals)</td>
</tr>
</tbody></table>
<h3 id="关系型字段"><a href="#关系型字段" class="headerlink" title="关系型字段"></a>关系型字段</h3><p>其字段类型取决于对应的主键。</p>
<ul>
<li>RelForeignKey</li>
<li>RelOneToOne</li>
<li>RelManyToMany</li>
<li>RelReverseOne</li>
<li>RelReverseMany</li>
</ul>
<h2 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h2><p>注册模型与数据库以后，调用 RunCommand 执行 orm 命令。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// orm.RegisterModel...</span></span><br><span class="line">	<span class="comment">// orm.RegisterDataBase...</span></span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">	orm.RunCommand()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">go</span> build main.<span class="keyword">go</span></span><br><span class="line">./main orm</span><br><span class="line"># 直接执行可以显示帮助</span><br><span class="line"># 如果你的程序可以支持的话，直接运行 <span class="keyword">go</span> run main.<span class="keyword">go</span> orm 也是一样的效果</span><br></pre></td></tr></table></figure>

<h3 id="自动建表"><a href="#自动建表" class="headerlink" title="自动建表"></a>自动建表</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./main orm syncdb -h</span><br><span class="line">Usage of orm <span class="built_in">command</span>: syncdb:</span><br><span class="line">  -db=<span class="string">&quot;default&quot;</span>: DataBase <span class="built_in">alias</span> name</span><br><span class="line">  -force=<span class="literal">false</span>: drop tables before create</span><br><span class="line">  -v=<span class="literal">false</span>: verbose info</span><br></pre></td></tr></table></figure>

<p>使用 <code>-force=1</code> 可以 drop table 后再建表</p>
<p>使用 <code>-v</code> 可以查看执行的 sql 语句</p>
<hr>
<p>在程序中直接调用自动建表：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据库别名</span></span><br><span class="line">name := <span class="string">&quot;default&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// drop table 后再建表</span></span><br><span class="line">force := <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 打印执行过程</span></span><br><span class="line">verbose := <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 遇到错误立即返回</span></span><br><span class="line">err := orm.RunSyncdb(name, force, verbose)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Println(err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>自动建表功能在非 force 模式下，是会自动创建新增加的字段的。也会创建新增加的索引。</p>
<p>对于改动过的旧字段，旧索引，需要用户自行进行处理。</p>
<h3 id="打印建表SQL"><a href="#打印建表SQL" class="headerlink" title="打印建表SQL"></a>打印建表SQL</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./main orm sqlall -h</span><br><span class="line">Usage of orm <span class="built_in">command</span>: syncdb:</span><br><span class="line">  -db=<span class="string">&quot;default&quot;</span>: DataBase <span class="built_in">alias</span> name</span><br></pre></td></tr></table></figure>

<p>默认使用别名为 default 的数据库。</p>
<h1 id="view设计"><a href="#view设计" class="headerlink" title="view设计"></a>view设计</h1><h2 id="模板语法指南"><a href="#模板语法指南" class="headerlink" title="模板语法指南"></a>模板语法指南</h2><p>本文讲述 beego 中使用的模板语法，与 go 模板语法基本相同。</p>
<h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><p>go 统一使用了 <code>&#123;&#123;` 和 `&#125;&#125;</code> 作为左右标签，没有其他的标签符号。如果您想要修改为其它符号，可以参考 <a target="_blank" rel="noopener" href="http://beego.vip/docs/mvc/view/view.md#%E6%A8%A1%E6%9D%BF%E6%A0%87%E7%AD%BE">模板标签</a>。</p>
<p>使用 <code>.</code> 来访问当前位置的上下文</p>
<p>使用 <code>$</code> 来引用当前模板根级的上下文</p>
<p>使用 <code>$var</code> 来访问创建的变量</p>
<p>[more]</p>
<p><strong>模板中支持的 go 语言符号</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&quot;string&quot;&#125;&#125; // 一般 string</span><br><span class="line">&#123;&#123;`raw string`&#125;&#125; // 原始 string</span><br><span class="line">&#123;&#123;&#x27;c&#x27;&#125;&#125; // byte</span><br><span class="line">&#123;&#123;print nil&#125;&#125; // nil 也被支持</span><br></pre></td></tr></table></figure>

<p><strong>模板中的 pipeline</strong></p>
<p>可以是上下文的变量输出，也可以是函数通过管道传递的返回值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;. | FuncA | FuncB | FuncC&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>当 pipeline 的值等于:</p>
<ul>
<li>false 或 0</li>
<li>nil 的指针或 interface</li>
<li>长度为 0 的 array, slice, map, string</li>
</ul>
<p>那么这个 pipeline 被认为是空</p>
<h4 id="if-…-else-…-end"><a href="#if-…-else-…-end" class="headerlink" title="if … else … end"></a>if … else … end</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;if pipeline&#125;&#125;&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>if 判断时，pipeline 为空时，相当于判断为 False</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">this.Data[&quot;IsLogin&quot;] = true</span><br><span class="line">this.Data[&quot;IsHome&quot;] = true</span><br><span class="line">this.Data[&quot;IsAbout&quot;] = true</span><br></pre></td></tr></table></figure>

<p>支持嵌套的循环</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;if .IsHome&#125;&#125;</span><br><span class="line">&#123;&#123;else&#125;&#125;</span><br><span class="line">	&#123;&#123;if .IsAbout&#125;&#125;&#123;&#123;end&#125;&#125;</span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>也可以使用 else if 进行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;if .IsHome&#125;&#125;</span><br><span class="line">&#123;&#123;else if .IsAbout&#125;&#125;</span><br><span class="line">&#123;&#123;else&#125;&#125;</span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="range-…-end"><a href="#range-…-end" class="headerlink" title="range … end"></a>range … end</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;range pipeline&#125;&#125;&#123;&#123;.&#125;&#125;&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>pipeline 支持的类型为 array, slice, map, channel</p>
<p>range 循环内部的 <code>.</code> 改变为以上类型的子元素</p>
<p>对应的值长度为 0 时，range 不会执行，<code>.</code> 不会改变</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pages := []struct &#123;</span><br><span class="line">	Num int</span><br><span class="line">&#125;&#123;&#123;10&#125;, &#123;20&#125;, &#123;30&#125;&#125;</span><br><span class="line"></span><br><span class="line">this.Data[&quot;Total&quot;] = 100</span><br><span class="line">this.Data[&quot;Pages&quot;] = pages</span><br></pre></td></tr></table></figure>

<p>使用 <code>.Num</code> 输出子元素的 Num 属性，使用 <code>$.</code> 引用模板中的根级上下文</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;range .Pages&#125;&#125;</span><br><span class="line">	&#123;&#123;.Num&#125;&#125; of &#123;&#123;$.Total&#125;&#125;</span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>使用创建的变量，在这里和 go 中的 range 用法是相同的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;range $index, $elem := .Pages&#125;&#125;</span><br><span class="line">	&#123;&#123;$index&#125;&#125; - &#123;&#123;$elem.Num&#125;&#125; - &#123;&#123;.Num&#125;&#125; of &#123;&#123;$.Total&#125;&#125;</span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>range 也支持 else</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;range .Pages&#125;&#125;</span><br><span class="line">&#123;&#123;else&#125;&#125;</span><br><span class="line">	&#123;&#123;/* 当 .Pages 为空 或者 长度为 0 时会执行这里 */&#125;&#125;</span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="with-…-end"><a href="#with-…-end" class="headerlink" title="with … end"></a>with … end</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;with pipeline&#125;&#125;&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>with 用于重定向 pipeline</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;with .Field.NestField.SubField&#125;&#125;</span><br><span class="line">	&#123;&#123;.Var&#125;&#125;</span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>也可以对变量赋值操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;with $value := &quot;My name is %s&quot;&#125;&#125;</span><br><span class="line">	&#123;&#123;printf . &quot;slene&quot;&#125;&#125;</span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>with 也支持 else</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;with pipeline&#125;&#125;</span><br><span class="line">&#123;&#123;else&#125;&#125;</span><br><span class="line">	&#123;&#123;/* 当 pipeline 为空时会执行这里 */&#125;&#125;</span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="define"><a href="#define" class="headerlink" title="define"></a>define</h4><p>define 可以用来定义自模板，可用于模块定义和模板嵌套</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;define &quot;loop&quot;&#125;&#125;</span><br><span class="line">	&lt;li&gt;&#123;&#123;.Name&#125;&#125;&lt;/li&gt;</span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>使用 template 调用模板</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">	&#123;&#123;range .Items&#125;&#125;</span><br><span class="line">		&#123;&#123;template &quot;loop&quot; .&#125;&#125;</span><br><span class="line">	&#123;&#123;end&#125;&#125;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>

<h4 id="template"><a href="#template" class="headerlink" title="template"></a>template</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;template &quot;模板名&quot; pipeline&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>将对应的上下文 pipeline 传给模板，才可以在模板中调用</p>
<p><strong>Beego 中支持直接载入文件模板</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;template &quot;path/to/head.html&quot; .&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>Beego 会依据你设置的模板路径读取 head.html</p>
<p>在模板中可以接着载入其他模板，对于模板的分模块处理很有用处</p>
<h4 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h4><p>允许多行文本注释，不允许嵌套</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;/* comment content</span><br><span class="line">support new line */&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="基本函数"><a href="#基本函数" class="headerlink" title="基本函数"></a>基本函数</h3><p>变量可以使用符号 <code>|</code> 在函数间传递</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;.Con | markdown | addlinks&#125;&#125;</span><br><span class="line">&#123;&#123;.Name | printf &quot;%s&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>使用括号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;printf &quot;nums is %s %d&quot; (printf &quot;%d %d&quot; 1 2) 3&#125;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="and"><a href="#and" class="headerlink" title="and"></a>and</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;and .X .Y .Z&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>and 会逐一判断每个参数，将返回第一个为空的参数，否则就返回最后一个非空参数</p>
<h4 id="call"><a href="#call" class="headerlink" title="call"></a>call</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;call .Field.Func .Arg1 .Arg2&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>call 可以调用函数，并传入参数</p>
<p>调用的函数需要返回 1 个值 或者 2 个值，返回两个值时，第二个值用于返回 error 类型的错误。返回的错误不等于 nil 时，执行将终止。</p>
<h4 id="index-1"><a href="#index-1" class="headerlink" title="index"></a>index</h4><p>index 支持 map, slice, array, string，读取指定类型对应下标的值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">this.Data[&quot;Maps&quot;] = map[string]string&#123;&quot;name&quot;: &quot;Beego&quot;&#125;</span><br><span class="line">&#123;&#123;index .Maps &quot;name&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="len"><a href="#len" class="headerlink" title="len"></a>len</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;printf &quot;The content length is %d&quot; (.Content|len)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>返回对应类型的长度，支持类型：map, slice, array, string, chan</p>
<h4 id="not"><a href="#not" class="headerlink" title="not"></a>not</h4><p>not 返回输入参数的否定值，if true then false else true</p>
<h4 id="or"><a href="#or" class="headerlink" title="or"></a>or</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;or .X .Y .Z&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>or 会逐一判断每个参数，将返回第一个非空的参数，否则就返回最后一个参数</p>
<h4 id="print"><a href="#print" class="headerlink" title="print"></a>print</h4><p>对应 fmt.Sprint</p>
<h4 id="printf"><a href="#printf" class="headerlink" title="printf"></a>printf</h4><p>对应 fmt.Sprintf</p>
<h4 id="println"><a href="#println" class="headerlink" title="println"></a>println</h4><p>对应 fmt.Sprintln</p>
<h4 id="urlquery"><a href="#urlquery" class="headerlink" title="urlquery"></a>urlquery</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;urlquery &quot;http://beego.vip&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>将返回</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http%3A%2F%2Fbeego.vip</span><br></pre></td></tr></table></figure>

<h4 id="eq-ne-lt-le-gt-ge"><a href="#eq-ne-lt-le-gt-ge" class="headerlink" title="eq &#x2F; ne &#x2F; lt &#x2F; le &#x2F; gt &#x2F; ge"></a>eq &#x2F; ne &#x2F; lt &#x2F; le &#x2F; gt &#x2F; ge</h4><p>这类函数一般配合在 if 中使用</p>
<p><code>eq</code>: arg1 &#x3D;&#x3D; arg2<br><code>ne</code>: arg1 !&#x3D; arg2<br><code>lt</code>: arg1 &lt; arg2<br><code>le</code>: arg1 &lt;&#x3D; arg2<br><code>gt</code>: arg1 &gt; arg2<br><code>ge</code>: arg1 &gt;&#x3D; arg2</p>
<p>eq 和其他函数不一样的地方是，支持多个参数，和下面的逻辑判断相同</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arg1==arg2 || arg1==arg3 || arg1==arg4 ...</span><br></pre></td></tr></table></figure>

<p>与 if 一起使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;if eq true .Var1 .Var2 .Var3&#125;&#125;&#123;&#123;end&#125;&#125;</span><br><span class="line">&#123;&#123;if lt 100 200&#125;&#125;&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="模板处理"><a href="#模板处理" class="headerlink" title="模板处理"></a>模板处理</h2><p>beego 的模板处理引擎采用的是 Go 内置的 <code>html/template</code> 包进行处理，而且 beego 的模板处理逻辑是采用了缓存编译方式，也就是所有的模板会在 beego 应用启动的时候全部编译然后缓存在 map 里面。</p>
<h3 id="模板目录"><a href="#模板目录" class="headerlink" title="模板目录"></a>模板目录</h3><p>beego 中默认的模板目录是 <code>views</code>，用户可以把模板文件放到该目录下，beego 会自动在该目录下的所有模板文件进行解析并缓存，开发模式下每次都会重新解析，不做缓存。当然，用户也可以通过如下的方式改变模板的目录（只能指定一个目录为模板目录）：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">beego.ViewsPath = <span class="string">&quot;myviewpath&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="自动渲染"><a href="#自动渲染" class="headerlink" title="自动渲染"></a>自动渲染</h3><p>用户无需手动的调用渲染输出模板，beego 会自动的在调用完相应的 method 方法之后调用 Render 函数，当然如果您的应用是不需要模板输出的，那么可以在配置文件或者在 <code>main.go</code> 中设置关闭自动渲染。</p>
<p>配置文件配置如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">autorender = <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>main.go 文件中设置如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web.AutoRender = <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h3 id="模板标签"><a href="#模板标签" class="headerlink" title="模板标签"></a>模板标签</h3><p>Go 语言的默认模板采用了 <code>&#123;&#123;` 和 `&#125;&#125;</code> 作为左右标签，但是我们有时候在开发中可能界面是采用了 AngularJS 开发，他的模板也是这个标签，故而引起了冲突。在 beego 中你可以通过配置文件或者直接设置配置变量修改：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">web.TemplateLeft = <span class="string">&quot;&lt;&lt;&lt;&quot;</span></span><br><span class="line">web.TemplateRight = <span class="string">&quot;&gt;&gt;&gt;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="模板数据"><a href="#模板数据" class="headerlink" title="模板数据"></a>模板数据</h3><p>模板中的数据是通过在 Controller 中 <code>this.Data</code> 获取的，所以如果你想在模板中获取内容 <code>&#123;&#123;.Content&#125;&#125;</code> ,那么你需要在 Controller 中如下设置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.Data[&quot;Content&quot;] = &quot;value&quot;</span><br></pre></td></tr></table></figure>

<p>如何使用各种类型的数据渲染：</p>
<ol>
<li>结构体数据渲染</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">结构体：</span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span>&#123;</span><br><span class="line"></span><br><span class="line">Name <span class="type">string</span></span><br><span class="line">Age <span class="type">int</span></span><br><span class="line">Gender <span class="type">string</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">赋值：</span><br><span class="line">c.Data[<span class="string">&quot;student&quot;</span>] = Student&#123;Name:<span class="string">&quot;知了&quot;</span>,Age:<span class="number">18</span>,Gender:<span class="string">&quot;男&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">前端使用：</span><br><span class="line">学生姓名：&#123;&#123;.student.Name&#125;&#125;</span><br><span class="line">学生年龄：&#123;&#123;.student.Age&#125;&#125;</span><br><span class="line">学生性别:&#123;&#123;.student.Gender&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意：结构体中的字段要在其他地方使用，比如首字母大写</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>数组数据渲染</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">lista := [<span class="number">5</span>]<span class="type">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;</span><br><span class="line">c.Data[<span class="string">&quot;arr&quot;</span>] = lista</span><br><span class="line"></span><br><span class="line">前端：</span><br><span class="line"></span><br><span class="line">第一种：</span><br><span class="line">&#123;&#123;<span class="keyword">range</span> $i,$v := .arr&#125;&#125;</span><br><span class="line">&#123;&#123;$i&#125;&#125;</span><br><span class="line">&#123;&#123;$v&#125;&#125;</span><br><span class="line">&#123;&#123;end&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">第二种：</span><br><span class="line">&#123;&#123;<span class="keyword">range</span> .arr&#125;&#125;</span><br><span class="line">&#123;&#123;.&#125;&#125;</span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>结构体数组渲染</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">结构体：</span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> &#123;</span><br><span class="line">Name <span class="type">string</span></span><br><span class="line">Age <span class="type">int</span></span><br><span class="line">Gender <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">赋值：</span><br><span class="line">arr_struct := [<span class="number">3</span>]student&#123;&#123;Name:<span class="string">&quot;hl&quot;</span>,Age:<span class="number">18</span>,Gender:<span class="string">&quot;男&quot;</span>&#125;,&#123;Name:<span class="string">&quot;hallen&quot;</span>,Age:<span class="number">19</span>,Gender:<span class="string">&quot;男&quot;</span>&#125;,&#123;Name:<span class="string">&quot;hallen1&quot;</span>,Age:<span class="number">191</span>,Gender:<span class="string">&quot;男&quot;</span>&#125;&#125;</span><br><span class="line">c.Data[<span class="string">&quot;arr_struct&quot;</span>] = arr_struct</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">前端获取：先循环数组，在获取结构体变量，注意是大写</span><br><span class="line">&#123;&#123;<span class="keyword">range</span> $v := .arr_struct&#125;&#125;</span><br><span class="line">&#123;&#123;$v.Name&#125;&#125;</span><br><span class="line">&#123;&#123;$v.Age&#125;&#125;</span><br><span class="line">&#123;&#123;$v.Gender&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;&#123;<span class="keyword">range</span> .books&#125;&#125;</span><br><span class="line">&#123;&#123;.Name&#125;&#125;</span><br><span class="line">&#123;&#123;.Author&#125;&#125;</span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>map数据渲染</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//teacher :=map[string]string&#123;&quot;name&quot;:&quot;张三&quot;,&quot;age&quot;:&quot;18&quot;&#125;</span></span><br><span class="line"></span><br><span class="line">teacher :=<span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>)</span><br><span class="line"></span><br><span class="line">teacher[<span class="string">&quot;name&quot;</span>]=<span class="string">&quot;老王&quot;</span></span><br><span class="line"></span><br><span class="line">teacher[<span class="string">&quot;age&quot;</span>]=<span class="string">&quot;30&quot;</span></span><br><span class="line"></span><br><span class="line">c.Data[<span class="string">&quot;teacher&quot;</span>] = teacher</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">前端：</span><br><span class="line"></span><br><span class="line">取出key对应的值</span><br><span class="line">&#123;&#123;.teacher.name&#125;&#125;</span><br><span class="line">&#123;&#123;.teacher.age&#125;&#125;</span><br><span class="line"></span><br><span class="line">取出所有的key和value：</span><br><span class="line">&#123;&#123;<span class="keyword">range</span> $k,$v := .teacher&#125;&#125;</span><br><span class="line">&#123;&#123;$k&#125;&#125;</span><br><span class="line">&#123;&#123;$v&#125;&#125;</span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>结构体和map组合渲染</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">结构体：</span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> &#123;</span><br><span class="line">Name <span class="type">string</span></span><br><span class="line">Age <span class="type">int</span></span><br><span class="line">Gender <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">赋值：</span><br><span class="line">mapa := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]student)</span><br><span class="line">mapa[<span class="number">101</span>] = student&#123;Name:<span class="string">&quot;张三1&quot;</span>,Age:<span class="number">181</span>,Gender:<span class="string">&quot;男&quot;</span>&#125;</span><br><span class="line">mapa[<span class="number">102</span>] = student&#123;Name:<span class="string">&quot;张三2&quot;</span>,Age:<span class="number">182</span>,Gender:<span class="string">&quot;男&quot;</span>&#125;</span><br><span class="line">mapa[<span class="number">103</span>] = student&#123;Name:<span class="string">&quot;张三3&quot;</span>,Age:<span class="number">183</span>,Gender:<span class="string">&quot;男&quot;</span>&#125;</span><br><span class="line">c.Data[<span class="string">&quot;hero_map&quot;</span>] = mapa</span><br><span class="line"></span><br><span class="line">前端获取：先循环<span class="keyword">map</span>，在获取结构体变量，注意是大写</span><br><span class="line">&#123;&#123;<span class="keyword">range</span> $v :=.hero_map&#125;&#125;</span><br><span class="line">&#123;&#123;$v.Name&#125;&#125;</span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>切片数据渲染</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">listb := []<span class="type">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>&#125;</span><br><span class="line">c.Data[<span class="string">&quot;list_b&quot;</span>] = listb</span><br><span class="line"></span><br><span class="line">前端：只有一个值的时候默认是切片的元素，而不是角标</span><br><span class="line">&#123;&#123;<span class="keyword">range</span> $v := .list_b&#125;&#125;</span><br><span class="line">&#123;&#123;$v&#125;&#125;</span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="模板名称"><a href="#模板名称" class="headerlink" title="模板名称"></a>模板名称</h3><p>beego 采用了 Go 语言内置的模板引擎，所有模板的语法和 Go 的一模一样，至于如何写模板文件，详细的请参考 <a target="_blank" rel="noopener" href="https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/07.4.md">模板教程</a>。</p>
<p>用户通过在 Controller 的对应方法中设置相应的模板名称，beego 会自动的在 viewpath 目录下查询该文件并渲染，例如下面的设置，beego 会在 admin 下面找 add.tpl 文件进行渲染：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.TplName = &quot;admin/add.tpl&quot;</span><br></pre></td></tr></table></figure>

<p>我们看到上面的模板后缀名是 tpl，beego 默认情况下支持 tpl 和 html 后缀名的模板文件，如果你的后缀名不是这两种，请进行如下设置：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web.AddTemplateExt(<span class="string">&quot;你文件的后缀名&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>当你设置了自动渲染，然后在你的 Controller 中没有设置任何的 TplName，那么 beego 会自动设置你的模板文件如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.TplName = strings.ToLower(c.controllerName) + <span class="string">&quot;/&quot;</span> + strings.ToLower(c.actionName) + <span class="string">&quot;.&quot;</span> + c.TplExt</span><br></pre></td></tr></table></figure>

<p>也就是你对应的 Controller 名字+请求方法名.模板后缀，也就是如果你的 Controller 名是 <code>AddController</code>，请求方法是 <code>POST</code>，默认的文件后缀是 <code>tpl</code>，那么就会默认请求 <code>/viewpath/AddController/post.tpl</code> 文件。</p>
<h3 id="Layout-设计"><a href="#Layout-设计" class="headerlink" title="Layout 设计"></a>Layout 设计</h3><p>beego 支持 layout 设计，例如你在管理系统中，整个管理界面是固定的，只会变化中间的部分，那么你可以通过如下的设置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">this.Layout = &quot;admin/layout.html&quot;</span><br><span class="line">this.TplName = &quot;admin/add.tpl&quot;</span><br></pre></td></tr></table></figure>

<p>在 layout.html 中你必须设置如下的变量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;.LayoutContent&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>beego 就会首先解析 TplName 指定的文件，获取内容赋值给 LayoutContent，然后最后渲染 layout.html 文件。</p>
<p>目前采用首先把目录下所有的文件进行缓存，所以用户还可以通过类似这样的方式实现 layout：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;template &quot;header.html&quot; .&#125;&#125;</span><br><span class="line">Logic code</span><br><span class="line">&#123;&#123;template &quot;footer.html&quot; .&#125;&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<blockquote>
<p>特别注意后面的<code>.</code>,这是传递当前参数到子模板</p>
</blockquote>
</blockquote>
</blockquote>
<h3 id="LayoutSection"><a href="#LayoutSection" class="headerlink" title="LayoutSection"></a>LayoutSection</h3><p>对于一个复杂的 <code>LayoutContent</code>，其中可能包括有javascript脚本、CSS 引用等，根据惯例，通常 css 会放到 Head 元素中，javascript 脚本需要放到 body 元素的末尾，而其它内容则根据需要放在合适的位置。在 <code>Layout</code> 页中仅有一个 <code>LayoutContent</code> 是不够的。所以在 <code>Controller</code> 中增加了一个 <code>LayoutSections</code>属性，可以允许 <code>Layout</code> 页中设置多个 <code>section</code>，然后每个 <code>section</code> 可以分别包含各自的子模板页。</p>
<p>layout_blog.tpl:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Lin Li<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap-theme.min.css&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123;.HtmlHead&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123;.LayoutContent&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        &#123;&#123;.SideBar&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://code.jquery.com/jquery-2.0.3.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    &#123;&#123;.Scripts&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>html_head.tpl:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">     <span class="selector-tag">h1</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">     &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>scripts.tpl：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    $(document).ready(function() &#123;</span><br><span class="line">        // bla bla bla</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>逻辑处理如下所示：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> BlogsController <span class="keyword">struct</span> &#123;</span><br><span class="line">  web.Controller</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *BlogsController)</span></span> Get() &#123;</span><br><span class="line">	this.Layout = <span class="string">&quot;layout_blog.tpl&quot;</span></span><br><span class="line">	this.TplName = <span class="string">&quot;blogs/index.tpl&quot;</span></span><br><span class="line">	this.LayoutSections = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>)</span><br><span class="line">	this.LayoutSections[<span class="string">&quot;HtmlHead&quot;</span>] = <span class="string">&quot;blogs/html_head.tpl&quot;</span></span><br><span class="line">	this.LayoutSections[<span class="string">&quot;Scripts&quot;</span>] = <span class="string">&quot;blogs/scripts.tpl&quot;</span></span><br><span class="line">	this.LayoutSections[<span class="string">&quot;Sidebar&quot;</span>] = <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="renderform-使用"><a href="#renderform-使用" class="headerlink" title="renderform 使用"></a>renderform 使用</h3><p>定义 struct:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id    <span class="type">int</span>         <span class="string">`form:&quot;-&quot;`</span></span><br><span class="line">	Name  <span class="keyword">interface</span>&#123;&#125; <span class="string">`form:&quot;username&quot;`</span></span><br><span class="line">	Age   <span class="type">int</span>         <span class="string">`form:&quot;age,text,年龄：&quot;`</span></span><br><span class="line">	Sex   <span class="type">string</span></span><br><span class="line">	Intro <span class="type">string</span> <span class="string">`form:&quot;,textarea&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>StructTag 的定义用的标签用为 <code>form</code>，和 <a target="_blank" rel="noopener" href="https://git-books.github.io/books/beego/controller/params.md#%E7%9B%B4%E6%8E%A5%E8%A7%A3%E6%9E%90%E5%88%B0-struct">ParseForm 方法</a> 共用一个标签，标签后面有三个可选参数，用 <code>,</code> 分割。第一个参数为表单中类型的 <code>name</code> 的值，如果为空，则以 <code>struct field name</code> 为值。第二个参数为表单组件的类型，如果为空，则为 <code>text</code>。表单组件的标签默认为 <code>struct field name</code> 的值，否则为第三个值。</li>
<li>如果 <code>form</code> 标签只有一个值，则为表单中类型 <code>name</code> 的值，除了最后一个值可以忽略外，其他位置的必须要有 <code>,</code> 号分割，如：<code>form:&quot;,,姓名：&quot;</code></li>
<li>如果要忽略一个字段，有两种办法，一是：字段名小写开头，二是：<code>form</code> 标签的值设置为 <code>-</code></li>
<li>现在的代码版本只能实现固定的格式，用 br 标签实现换行，无法实现 css 和 class 等代码的插入。所以，要实现 form 的高级排版，不能使用 renderform 的方法，而需要手动处理每一个字段。</li>
</ul>
<p>controller：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *AddController)</span></span> Get() &#123;</span><br><span class="line">	this.Data[<span class="string">&quot;Form&quot;</span>] = &amp;User&#123;&#125;</span><br><span class="line">	this.TplName = <span class="string">&quot;index.tpl&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Form 的参数必须是一个 struct 的指针。</p>
<p>template:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">&#123;&#123;.Form | renderform&#125;&#125;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>上面的代码生成的表单为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;test&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br><span class="line">年龄：<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br><span class="line">Sex: <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;Sex&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br><span class="line">Intro: <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;Intro&quot;</span> <span class="attr">type</span>=<span class="string">&quot;textarea&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="模板函数"><a href="#模板函数" class="headerlink" title="模板函数"></a>模板函数</h2><p>beego 支持用户定义模板函数，但是必须在 <code>web.Run()</code> 调用之前，设置如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(in <span class="type">string</span>)</span></span>(out <span class="type">string</span>)&#123;</span><br><span class="line">    out = in + <span class="string">&quot;world&quot;</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">web.AddFuncMap(<span class="string">&quot;hi&quot;</span>,hello)</span><br></pre></td></tr></table></figure>

<p>定义之后你就可以在模板中这样使用了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;.Content | hi&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>目前 beego 内置的模板函数如下所示：</p>
<ul>
<li><p>dateformat</p>
<p>实现了时间的格式化，返回字符串，使用方法 <code>&#123;&#123;dateformat .Time "2006-01-02T15:04:05Z07:00"&#125;&#125;</code>。</p>
</li>
<li><p>date</p>
<p>实现了类似 PHP 的 date 函数，可以很方便的根据字符串返回时间，使用方法 <code>&#123;&#123;date .T "Y-m-d H:i:s"&#125;&#125;</code>。</p>
</li>
<li><p>compare</p>
<p>实现了比较两个对象的比较，如果相同返回 true，否者 false，使用方法 <code>&#123;&#123;compare .A .B&#125;&#125;</code>。</p>
</li>
<li><p>substr</p>
<p>实现了字符串的截取，支持中文截取的完美截取，使用方法<code> &#123;&#123;substr .Str 0 30&#125;&#125;</code>。</p>
</li>
<li><p>html2str</p>
<p>实现了把 html 转化为字符串，剔除一些 script、css 之类的元素，返回纯文本信息，使用方法 <code>&#123;&#123;html2str .Htmlinfo&#125;&#125;</code>。</p>
</li>
<li><p>str2html</p>
<p>实现了把相应的字符串当作 HTML 来输出，不转义，使用方法 <code>&#123;&#123;str2html .Strhtml&#125;&#125;</code>。</p>
</li>
<li><p>htmlquote</p>
<p>实现了基本的 html 字符转义，使用方法<code> &#123;&#123;htmlquote .quote&#125;&#125;</code>。</p>
</li>
<li><p>htmlunquote</p>
<p>实现了基本的反转移字符，使用方法 <code>&#123;&#123;htmlunquote .unquote&#125;&#125;</code>。</p>
</li>
<li><p>renderform</p>
<p>根据 StructTag 直接生成对应的表单，使用方法 <code>&#123;&#123;&struct | renderform&#125;&#125;</code>。</p>
</li>
<li><p>assets_js</p>
<p>为 js 文件生成一个 <code>&lt;script&gt;</code> 标签. 使用方法 <code>&#123;&#123;assets_js src&#125;&#125;</code></p>
</li>
<li><p>assets_css</p>
<p>为 css 文件生成一个 <code>&lt;link&gt;</code> 标签. 使用方法 <code>&#123;&#123;assets_css src&#125;&#125;</code></p>
</li>
<li><p>config</p>
<p>获取 AppConfig 的值. 使用方法 {<code>&#123;config configType configKey defaultValue&#125;&#125;</code>. 可选的 configType 有 String, Bool, Int, Int64, Float, DIY</p>
</li>
<li><p>map_get</p>
<p>获取 <code>map</code> 的值</p>
<p>用法:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// In controller</span><br><span class="line">Data[&quot;m&quot;] = map[string]interface&#123;&#125; &#123;</span><br><span class="line">    &quot;a&quot;: 1,</span><br><span class="line">    &quot;1&quot;: map[string]float64&#123;</span><br><span class="line">        &quot;c&quot;: 4,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">// In view</span><br><span class="line">&#123;&#123; map_get .m &quot;a&quot; &#125;&#125; // return 1</span><br><span class="line">&#123;&#123; map_get .m 1 &quot;c&quot; &#125;&#125; // return 4</span><br></pre></td></tr></table></figure>
</li>
<li><p>urlfor</p>
<p>获取控制器方法的 URL</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;urlfor &quot;TestController.List&quot;&#125;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="静态文件处理-1"><a href="#静态文件处理-1" class="headerlink" title="静态文件处理"></a>静态文件处理</h2><p>Go 语言内部其实已经提供了 <code>http.ServeFile</code>，通过这个函数可以实现静态文件的服务。beego 针对这个功能进行了一层封装，通过下面的方式进行静态文件注册：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web.SetStaticPath(<span class="string">&quot;/static&quot;</span>,<span class="string">&quot;public&quot;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>第一个参数是路径，url 路径信息</li>
<li>第二个参数是静态文件目录（相对应用所在的目录）</li>
</ul>
<p>beego 支持多个目录的静态文件注册，用户可以注册如下的静态文件目录：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">web.SetStaticPath(<span class="string">&quot;/images&quot;</span>,<span class="string">&quot;images&quot;</span>)</span><br><span class="line">web.SetStaticPath(<span class="string">&quot;/css&quot;</span>,<span class="string">&quot;css&quot;</span>)</span><br><span class="line">web.SetStaticPath(<span class="string">&quot;/js&quot;</span>,<span class="string">&quot;js&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>设置了如上的静态目录之后，用户访问 <code>/images/login/login.png</code>，那么就会访问应用对应的目录下面的 <code>images/login/login.png</code> 文件。如果是访问 <code>/static/img/logo.png</code>，那么就访问 <code>public/img/logo.png</code>文件。</p>
<p>默认情况下 beego 会判断目录下文件是否存在，不存在直接返回 404 页面，如果请求的是 <code>index.html</code>，那么由于 <code>http.ServeFile</code> 默认是会跳转的，不提供该页面的显示。因此 beego 可以设置 <code>web.BConfig.WebConfig.DirectoryIndex=true</code> 这样来使得显示 <code>index.html</code> 页面。而且开启该功能之后，用户访问目录就会显示该目录下所有的文件列表。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://uestcwxy.love">Palp1tate</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://uestcwxy.love/2023/07/20/Go/30/">https://uestcwxy.love/2023/07/20/Go/30/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://uestcwxy.love" target="_blank">Palp1tate</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%A4%A7%E4%BA%8C%E8%87%AA%E5%AD%A6/">大二自学</a><a class="post-meta__tags" href="/tags/Go/">Go</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/palp1tate/blog_img/img/4d287328613d2f4952a70edb9192044037dd5e22.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/07/20/Go/29/" title="第一次对github项目提PR请求——以修改casdoor项目的swagger文档为例"><img class="cover" src="https://s2.loli.net/2023/05/31/UuGQIvw8HNBrZsp.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">第一次对github项目提PR请求——以修改casdoor项目的swagger文档为例</div></div></a></div><div class="next-post pull-right"><a href="/2023/07/31/%E6%95%B0%E6%8D%AE%E5%BA%93/2/" title="Windows安装配置Redis教程"><img class="cover" src="https://s2.loli.net/2023/05/31/UuGQIvw8HNBrZsp.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Windows安装配置Redis教程</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/08/27/qingxun/" title="从入门到渐入佳境——记我的第六届字节青训营经历"><img class="cover" src="https://cdn.jsdelivr.net/gh/palp1tate/blog_img/img/IMG_20230801_114856.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-27</div><div class="title">从入门到渐入佳境——记我的第六届字节青训营经历</div></div></a></div><div><a href="/2023/06/01/Go/1/" title="学习go的准备工作"><img class="cover" src="https://s2.loli.net/2023/06/01/a4okGxJeW3smrcQ.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-01</div><div class="title">学习go的准备工作</div></div></a></div><div><a href="/2023/06/06/Go/10/" title="方法与接口"><img class="cover" src="https://s2.loli.net/2023/06/01/a4okGxJeW3smrcQ.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-06</div><div class="title">方法与接口</div></div></a></div><div><a href="/2023/06/08/Go/11/" title="补充函数与字符串"><img class="cover" src="https://s2.loli.net/2023/06/01/a4okGxJeW3smrcQ.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-08</div><div class="title">补充函数与字符串</div></div></a></div><div><a href="/2023/06/09/Go/12/" title="type关键字与错误处理"><img class="cover" src="https://s2.loli.net/2023/06/01/a4okGxJeW3smrcQ.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-09</div><div class="title">type关键字与错误处理</div></div></a></div><div><a href="/2023/06/10/Go/13/" title="包的使用和time包"><img class="cover" src="https://s2.loli.net/2023/06/01/a4okGxJeW3smrcQ.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-10</div><div class="title">包的使用和time包</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Palp1tate</div><div class="author-info__description">等我苦尽甘来时，我给你讲讲来时走的路。</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">98</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/palp1tate/"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://www.facebook.com/profile.php?id=100092533320651" target="_blank" title="facebook"><i class="fab fa-facebook" style="color: #4a7dbe;"></i></a><a class="social-icon" href="mailto:1939311091@qq.com" target="_blank" title="email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://space.bilibili.com/1907948898" target="_blank" title="b站"><i class="fab fa-bilibili" style="color: #4a7dbe;"></i></a><a class="social-icon" href="/img/tiktok.jpg" target="_blank" title="抖音"><i class="fab fa-tiktok" style="color: #4a7dbe;"></i></a><a class="social-icon" href="/img/weixin.jpg" target="_blank" title="微信"><i class="fab fa-weixin" style="color: #4a7dbe;"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">刚建站不久，博客美化有待研究，部分页面也没时间弄，路过的你将就看啦~😊，图片没加载出来就是网络不佳噢~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84"><span class="toc-number">1.1.</span> <span class="toc-text">架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E9%80%BB%E8%BE%91"><span class="toc-number">1.2.</span> <span class="toc-text">执行逻辑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.</span> <span class="toc-text">项目结构</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E5%8D%87%E7%BA%A7"><span class="toc-number">2.</span> <span class="toc-text">安装与升级</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#beego%E5%AE%89%E8%A3%85"><span class="toc-number">2.1.</span> <span class="toc-text">beego安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#beego-%E5%8D%87%E7%BA%A7"><span class="toc-number">2.2.</span> <span class="toc-text">beego 升级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bee-%E5%B7%A5%E5%85%B7"><span class="toc-number">2.3.</span> <span class="toc-text">bee 工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#bee-%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-number">2.3.1.</span> <span class="toc-text">bee 工具的安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bee-%E5%B7%A5%E5%85%B7%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.3.2.</span> <span class="toc-text">bee 工具命令详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#new%E5%91%BD%E4%BB%A4"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">new命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#api-%E5%91%BD%E4%BB%A4"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">api 命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#run-%E5%91%BD%E4%BB%A4"><span class="toc-number">2.3.2.3.</span> <span class="toc-text">run 命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pack-%E5%91%BD%E4%BB%A4"><span class="toc-number">2.3.2.4.</span> <span class="toc-text">pack 命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#version-%E5%91%BD%E4%BB%A4"><span class="toc-number">2.3.2.5.</span> <span class="toc-text">version 命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#generate-%E5%91%BD%E4%BB%A4"><span class="toc-number">2.3.2.6.</span> <span class="toc-text">generate 命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#migrate-%E5%91%BD%E4%BB%A4"><span class="toc-number">2.3.2.7.</span> <span class="toc-text">migrate 命令</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">3.</span> <span class="toc-text">快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">3.1.</span> <span class="toc-text">创建项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E9%A1%B9%E7%9B%AE"><span class="toc-number">3.2.</span> <span class="toc-text">运行项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E8%AE%BE%E7%BD%AE"><span class="toc-number">3.3.</span> <span class="toc-text">路由设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#controller-%E9%80%BB%E8%BE%91"><span class="toc-number">3.4.</span> <span class="toc-text">controller 逻辑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#model-%E9%80%BB%E8%BE%91"><span class="toc-number">3.5.</span> <span class="toc-text">model 逻辑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#View-%E7%BC%96%E5%86%99"><span class="toc-number">3.6.</span> <span class="toc-text">View 编写</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86"><span class="toc-number">3.7.</span> <span class="toc-text">静态文件处理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#beego-%E7%9A%84-MVC-%E6%9E%B6%E6%9E%84"><span class="toc-number">4.</span> <span class="toc-text">beego 的 MVC 架构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#controller-%E8%AE%BE%E8%AE%A1"><span class="toc-number">5.</span> <span class="toc-text">controller 设计</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE"><span class="toc-number">5.1.</span> <span class="toc-text">参数配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E8%A7%A3%E6%9E%90"><span class="toc-number">5.1.1.</span> <span class="toc-text">默认配置解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C%E7%BA%A7%E5%88%AB%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">5.1.2.</span> <span class="toc-text">不同级别的配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">5.1.3.</span> <span class="toc-text">多个配置文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E8%AE%BE%E7%BD%AE-1"><span class="toc-number">5.2.</span> <span class="toc-text">路由设置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E8%B7%AF%E7%94%B1"><span class="toc-number">5.2.1.</span> <span class="toc-text">基础路由</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#GET"><span class="toc-number">5.2.1.1.</span> <span class="toc-text">GET</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#POST"><span class="toc-number">5.2.1.2.</span> <span class="toc-text">POST</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E4%BB%BB%E4%BD%95-HTTP-%E7%9A%84%E8%B7%AF%E7%94%B1"><span class="toc-number">5.2.1.3.</span> <span class="toc-text">响应任何 HTTP 的路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%AF%E6%8C%81%E7%9A%84%E5%9F%BA%E7%A1%80%E5%87%BD%E6%95%B0"><span class="toc-number">5.2.1.4.</span> <span class="toc-text">支持的基础函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BA%E5%AE%9A%E8%B7%AF%E7%94%B1"><span class="toc-number">5.2.2.</span> <span class="toc-text">固定路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E8%B7%AF%E7%94%B1"><span class="toc-number">5.2.3.</span> <span class="toc-text">正则路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95%E5%8F%8A-RESTful-%E8%A7%84%E5%88%99"><span class="toc-number">5.2.4.</span> <span class="toc-text">自定义方法及 RESTful 规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%B9%E9%85%8D"><span class="toc-number">5.2.5.</span> <span class="toc-text">自动匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E8%B7%AF%E7%94%B1"><span class="toc-number">5.2.6.</span> <span class="toc-text">注解路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%B7%AF%E7%94%B1"><span class="toc-number">5.2.7.</span> <span class="toc-text">方法表达式路由</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E5%99%A8%E5%87%BD%E6%95%B0"><span class="toc-number">5.3.</span> <span class="toc-text">控制器函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E5%99%A8%E4%BB%8B%E7%BB%8D"><span class="toc-number">5.3.1.</span> <span class="toc-text">控制器介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E5%99%A8%E6%96%B9%E6%B3%95"><span class="toc-number">5.3.2.</span> <span class="toc-text">控制器方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E7%B1%BB%E6%89%A9%E5%B1%95"><span class="toc-number">5.3.3.</span> <span class="toc-text">子类扩展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E5%89%8D%E7%BB%88%E6%AD%A2%E8%BF%90%E8%A1%8C"><span class="toc-number">5.3.4.</span> <span class="toc-text">提前终止运行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XSRF-%E8%BF%87%E6%BB%A4"><span class="toc-number">5.4.</span> <span class="toc-text">XSRF 过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0"><span class="toc-number">5.4.1.</span> <span class="toc-text">跨站请求伪造</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%AF%E6%8C%81controller-%E7%BA%A7%E5%88%AB%E7%9A%84%E5%B1%8F%E8%94%BD"><span class="toc-number">5.4.2.</span> <span class="toc-text">支持controller 级别的屏蔽</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="toc-number">5.5.</span> <span class="toc-text">请求数据处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%8F%82%E6%95%B0"><span class="toc-number">5.5.1.</span> <span class="toc-text">获取参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E8%A7%A3%E6%9E%90%E5%88%B0-struct"><span class="toc-number">5.5.2.</span> <span class="toc-text">直接解析到 struct</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-Request-Body-%E9%87%8C%E7%9A%84%E5%86%85%E5%AE%B9"><span class="toc-number">5.5.3.</span> <span class="toc-text">获取 Request Body 里的内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">5.5.4.</span> <span class="toc-text">文件上传</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A"><span class="toc-number">5.5.5.</span> <span class="toc-text">数据绑定</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#session-%E6%8E%A7%E5%88%B6"><span class="toc-number">5.6.</span> <span class="toc-text">session 控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">5.7.</span> <span class="toc-text">过滤器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flash-%E6%95%B0%E6%8D%AE"><span class="toc-number">5.8.</span> <span class="toc-text">flash 数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#URL-%E6%9E%84%E5%BB%BA"><span class="toc-number">5.9.</span> <span class="toc-text">URL 构建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8"><span class="toc-number">5.9.1.</span> <span class="toc-text">模板中如何使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E7%A7%8D%E6%A0%BC%E5%BC%8F%E6%95%B0%E6%8D%AE%E8%BE%93%E5%87%BA"><span class="toc-number">5.10.</span> <span class="toc-text">多种格式数据输出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81"><span class="toc-number">5.11.</span> <span class="toc-text">表单数据验证</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%8F%8A%E6%B5%8B%E8%AF%95"><span class="toc-number">5.11.1.</span> <span class="toc-text">安装及测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">5.11.2.</span> <span class="toc-text">示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AA%8C%E8%AF%81"><span class="toc-number">5.11.3.</span> <span class="toc-text">自定义验证</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">5.12.</span> <span class="toc-text">错误处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Controller-%E5%AE%9A%E4%B9%89-Error"><span class="toc-number">5.12.1.</span> <span class="toc-text">Controller 定义 Error</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#model%E8%AE%BE%E8%AE%A1"><span class="toc-number">6.</span> <span class="toc-text">model设计</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">6.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8-1"><span class="toc-number">6.2.</span> <span class="toc-text">快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%A4%BA%E4%BE%8B"><span class="toc-number">6.2.1.</span> <span class="toc-text">简单示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.2.2.</span> <span class="toc-text">关联查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL-%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.2.3.</span> <span class="toc-text">SQL 查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ORM%E4%BD%BF%E7%94%A8"><span class="toc-number">6.3.</span> <span class="toc-text">ORM使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RegisterDriver"><span class="toc-number">6.3.1.</span> <span class="toc-text">RegisterDriver</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RegisterDataBase"><span class="toc-number">6.3.2.</span> <span class="toc-text">RegisterDataBase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RegisterModel"><span class="toc-number">6.3.3.</span> <span class="toc-text">RegisterModel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RegisterModelWithPrefix"><span class="toc-number">6.3.4.</span> <span class="toc-text">RegisterModelWithPrefix</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#QueryTable"><span class="toc-number">6.3.5.</span> <span class="toc-text">QueryTable</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Raw"><span class="toc-number">6.3.6.</span> <span class="toc-text">Raw</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CRUD-%E6%93%8D%E4%BD%9C"><span class="toc-number">6.4.</span> <span class="toc-text">CRUD 操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Read"><span class="toc-number">6.4.1.</span> <span class="toc-text">Read</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ReadOrCreate"><span class="toc-number">6.4.2.</span> <span class="toc-text">ReadOrCreate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Insert"><span class="toc-number">6.4.3.</span> <span class="toc-text">Insert</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#InsertMulti"><span class="toc-number">6.4.4.</span> <span class="toc-text">InsertMulti</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Update"><span class="toc-number">6.4.5.</span> <span class="toc-text">Update</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Delete"><span class="toc-number">6.4.6.</span> <span class="toc-text">Delete</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.5.</span> <span class="toc-text">高级查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#expr"><span class="toc-number">6.5.1.</span> <span class="toc-text">expr</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Operators"><span class="toc-number">6.5.2.</span> <span class="toc-text">Operators</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exact"><span class="toc-number">6.5.3.</span> <span class="toc-text">exact</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iexact"><span class="toc-number">6.5.4.</span> <span class="toc-text">iexact</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#contains"><span class="toc-number">6.5.5.</span> <span class="toc-text">contains</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#icontains"><span class="toc-number">6.5.6.</span> <span class="toc-text">icontains</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#in"><span class="toc-number">6.5.7.</span> <span class="toc-text">in</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gt-gte"><span class="toc-number">6.5.8.</span> <span class="toc-text">gt &#x2F; gte</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lt-lte"><span class="toc-number">6.5.9.</span> <span class="toc-text">lt &#x2F; lte</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#startswith"><span class="toc-number">6.5.10.</span> <span class="toc-text">startswith</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#istartswith"><span class="toc-number">6.5.11.</span> <span class="toc-text">istartswith</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#endswith"><span class="toc-number">6.5.12.</span> <span class="toc-text">endswith</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iendswith"><span class="toc-number">6.5.13.</span> <span class="toc-text">iendswith</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#isnull"><span class="toc-number">6.5.14.</span> <span class="toc-text">isnull</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Filter"><span class="toc-number">6.5.15.</span> <span class="toc-text">Filter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exclude"><span class="toc-number">6.5.16.</span> <span class="toc-text">Exclude</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SetCond"><span class="toc-number">6.5.17.</span> <span class="toc-text">SetCond</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Limit"><span class="toc-number">6.5.18.</span> <span class="toc-text">Limit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Offset"><span class="toc-number">6.5.19.</span> <span class="toc-text">Offset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GroupBy"><span class="toc-number">6.5.20.</span> <span class="toc-text">GroupBy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OrderBy"><span class="toc-number">6.5.21.</span> <span class="toc-text">OrderBy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Distinct"><span class="toc-number">6.5.22.</span> <span class="toc-text">Distinct</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RelatedSel"><span class="toc-number">6.5.23.</span> <span class="toc-text">RelatedSel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Count"><span class="toc-number">6.5.24.</span> <span class="toc-text">Count</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exist"><span class="toc-number">6.5.25.</span> <span class="toc-text">Exist</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Update-1"><span class="toc-number">6.5.26.</span> <span class="toc-text">Update</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Delete-1"><span class="toc-number">6.5.27.</span> <span class="toc-text">Delete</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PrepareInsert"><span class="toc-number">6.5.28.</span> <span class="toc-text">PrepareInsert</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#All"><span class="toc-number">6.5.29.</span> <span class="toc-text">All</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#One"><span class="toc-number">6.5.30.</span> <span class="toc-text">One</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Values"><span class="toc-number">6.5.31.</span> <span class="toc-text">Values</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ValuesList"><span class="toc-number">6.5.32.</span> <span class="toc-text">ValuesList</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ValuesFlat"><span class="toc-number">6.5.33.</span> <span class="toc-text">ValuesFlat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.5.34.</span> <span class="toc-text">关系查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#User-%E5%92%8C-Profile-%E6%98%AF-OneToOne-%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">6.5.34.1.</span> <span class="toc-text">User 和 Profile 是 OneToOne 的关系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Post-%E5%92%8C-User-%E6%98%AF-ManyToOne-%E5%85%B3%E7%B3%BB%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF-ForeignKey-%E4%B8%BA-User"><span class="toc-number">6.5.34.2.</span> <span class="toc-text">Post 和 User 是 ManyToOne 关系，也就是 ForeignKey 为 User</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Post-%E5%92%8C-Tag-%E6%98%AF-ManyToMany-%E5%85%B3%E7%B3%BB"><span class="toc-number">6.5.34.3.</span> <span class="toc-text">Post 和 Tag 是 ManyToMany 关系</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%BD%E5%85%A5%E5%85%B3%E7%B3%BB%E5%AD%97%E6%AE%B5"><span class="toc-number">6.5.35.</span> <span class="toc-text">载入关系字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E5%AF%B9%E5%A4%9A%E5%85%B3%E7%B3%BB%E6%93%8D%E4%BD%9C"><span class="toc-number">6.5.36.</span> <span class="toc-text">多对多关系操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#QueryM2Mer-Add"><span class="toc-number">6.5.36.1.</span> <span class="toc-text">QueryM2Mer Add</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#QueryM2Mer-Remove"><span class="toc-number">6.5.36.2.</span> <span class="toc-text">QueryM2Mer Remove</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#QueryM2Mer-Exist"><span class="toc-number">6.5.36.3.</span> <span class="toc-text">QueryM2Mer Exist</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#QueryM2Mer-Clear"><span class="toc-number">6.5.36.4.</span> <span class="toc-text">QueryM2Mer Clear</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#QueryM2Mer-Count"><span class="toc-number">6.5.36.5.</span> <span class="toc-text">QueryM2Mer Count</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%94%9F-SQL-%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.6.</span> <span class="toc-text">原生 SQL 查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Exec"><span class="toc-number">6.6.1.</span> <span class="toc-text">Exec</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#QueryRow"><span class="toc-number">6.6.2.</span> <span class="toc-text">QueryRow</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#QueryRows"><span class="toc-number">6.6.3.</span> <span class="toc-text">QueryRows</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SetArgs"><span class="toc-number">6.6.4.</span> <span class="toc-text">SetArgs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Values-ValuesList-ValuesFlat"><span class="toc-number">6.6.5.</span> <span class="toc-text">Values &#x2F; ValuesList &#x2F; ValuesFlat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Values-1"><span class="toc-number">6.6.6.</span> <span class="toc-text">Values</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ValuesList-1"><span class="toc-number">6.6.7.</span> <span class="toc-text">ValuesList</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ValuesFlat-1"><span class="toc-number">6.6.8.</span> <span class="toc-text">ValuesFlat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RowsToMap"><span class="toc-number">6.6.9.</span> <span class="toc-text">RowsToMap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RowsToStruct"><span class="toc-number">6.6.10.</span> <span class="toc-text">RowsToStruct</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Prepare"><span class="toc-number">6.6.11.</span> <span class="toc-text">Prepare</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.7.</span> <span class="toc-text">构造查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E5%AE%9A%E4%B9%89"><span class="toc-number">6.8.</span> <span class="toc-text">模型定义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A1%A8%E5%90%8D"><span class="toc-number">6.8.1.</span> <span class="toc-text">自定义表名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%8F%82%E6%95%B0"><span class="toc-number">6.8.2.</span> <span class="toc-text">设置参数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BF%BD%E7%95%A5%E5%AD%97%E6%AE%B5"><span class="toc-number">6.8.2.1.</span> <span class="toc-text">忽略字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#auto"><span class="toc-number">6.8.2.2.</span> <span class="toc-text">auto</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pk"><span class="toc-number">6.8.2.3.</span> <span class="toc-text">pk</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#null"><span class="toc-number">6.8.2.4.</span> <span class="toc-text">null</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#index"><span class="toc-number">6.8.2.5.</span> <span class="toc-text">index</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#unique"><span class="toc-number">6.8.2.6.</span> <span class="toc-text">unique</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#column"><span class="toc-number">6.8.2.7.</span> <span class="toc-text">column</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#size"><span class="toc-number">6.8.2.8.</span> <span class="toc-text">size</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#digits-decimals"><span class="toc-number">6.8.2.9.</span> <span class="toc-text">digits &#x2F; decimals</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#auto-now-auto-now-add"><span class="toc-number">6.8.2.10.</span> <span class="toc-text">auto_now &#x2F; auto_now_add</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#type"><span class="toc-number">6.8.2.11.</span> <span class="toc-text">type</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#default"><span class="toc-number">6.8.2.12.</span> <span class="toc-text">default</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Comment"><span class="toc-number">6.8.2.13.</span> <span class="toc-text">Comment</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Precision"><span class="toc-number">6.8.2.14.</span> <span class="toc-text">Precision</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E5%85%B3%E7%B3%BB%E8%AE%BE%E7%BD%AE"><span class="toc-number">6.8.3.</span> <span class="toc-text">表关系设置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rel-reverse"><span class="toc-number">6.8.3.1.</span> <span class="toc-text">rel &#x2F; reverse</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rel-table-rel-through"><span class="toc-number">6.8.3.2.</span> <span class="toc-text">rel_table &#x2F; rel_through</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#on-delete"><span class="toc-number">6.8.3.3.</span> <span class="toc-text">on_delete</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E-on-delete-%E7%9A%84%E7%9B%B8%E5%85%B3%E4%BE%8B%E5%AD%90"><span class="toc-number">6.8.3.4.</span> <span class="toc-text">关于 on_delete 的相关例子</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E5%AD%97%E6%AE%B5%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%AF%B9%E5%BA%94"><span class="toc-number">6.8.4.</span> <span class="toc-text">模型字段与数据库类型的对应</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MySQL"><span class="toc-number">6.8.4.1.</span> <span class="toc-text">MySQL</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E5%9E%8B%E5%AD%97%E6%AE%B5"><span class="toc-number">6.8.5.</span> <span class="toc-text">关系型字段</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.9.</span> <span class="toc-text">命令模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%BB%BA%E8%A1%A8"><span class="toc-number">6.9.1.</span> <span class="toc-text">自动建表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%8D%B0%E5%BB%BA%E8%A1%A8SQL"><span class="toc-number">6.9.2.</span> <span class="toc-text">打印建表SQL</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#view%E8%AE%BE%E8%AE%A1"><span class="toc-number">7.</span> <span class="toc-text">view设计</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95%E6%8C%87%E5%8D%97"><span class="toc-number">7.1.</span> <span class="toc-text">模板语法指南</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">7.1.1.</span> <span class="toc-text">基本语法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#if-%E2%80%A6-else-%E2%80%A6-end"><span class="toc-number">7.1.1.1.</span> <span class="toc-text">if … else … end</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#range-%E2%80%A6-end"><span class="toc-number">7.1.1.2.</span> <span class="toc-text">range … end</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#with-%E2%80%A6-end"><span class="toc-number">7.1.1.3.</span> <span class="toc-text">with … end</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#define"><span class="toc-number">7.1.1.4.</span> <span class="toc-text">define</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#template"><span class="toc-number">7.1.1.5.</span> <span class="toc-text">template</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A"><span class="toc-number">7.1.1.6.</span> <span class="toc-text">注释</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%87%BD%E6%95%B0"><span class="toc-number">7.1.2.</span> <span class="toc-text">基本函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#and"><span class="toc-number">7.1.2.1.</span> <span class="toc-text">and</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#call"><span class="toc-number">7.1.2.2.</span> <span class="toc-text">call</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#index-1"><span class="toc-number">7.1.2.3.</span> <span class="toc-text">index</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#len"><span class="toc-number">7.1.2.4.</span> <span class="toc-text">len</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#not"><span class="toc-number">7.1.2.5.</span> <span class="toc-text">not</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#or"><span class="toc-number">7.1.2.6.</span> <span class="toc-text">or</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#print"><span class="toc-number">7.1.2.7.</span> <span class="toc-text">print</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#printf"><span class="toc-number">7.1.2.8.</span> <span class="toc-text">printf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#println"><span class="toc-number">7.1.2.9.</span> <span class="toc-text">println</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#urlquery"><span class="toc-number">7.1.2.10.</span> <span class="toc-text">urlquery</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#eq-ne-lt-le-gt-ge"><span class="toc-number">7.1.2.11.</span> <span class="toc-text">eq &#x2F; ne &#x2F; lt &#x2F; le &#x2F; gt &#x2F; ge</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E5%A4%84%E7%90%86"><span class="toc-number">7.2.</span> <span class="toc-text">模板处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E7%9B%AE%E5%BD%95"><span class="toc-number">7.2.1.</span> <span class="toc-text">模板目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E6%B8%B2%E6%9F%93"><span class="toc-number">7.2.2.</span> <span class="toc-text">自动渲染</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E6%A0%87%E7%AD%BE"><span class="toc-number">7.2.3.</span> <span class="toc-text">模板标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E6%95%B0%E6%8D%AE"><span class="toc-number">7.2.4.</span> <span class="toc-text">模板数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E5%90%8D%E7%A7%B0"><span class="toc-number">7.2.5.</span> <span class="toc-text">模板名称</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Layout-%E8%AE%BE%E8%AE%A1"><span class="toc-number">7.2.6.</span> <span class="toc-text">Layout 设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LayoutSection"><span class="toc-number">7.2.7.</span> <span class="toc-text">LayoutSection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#renderform-%E4%BD%BF%E7%94%A8"><span class="toc-number">7.2.8.</span> <span class="toc-text">renderform 使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.</span> <span class="toc-text">模板函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86-1"><span class="toc-number">7.4.</span> <span class="toc-text">静态文件处理</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/11/21/%E7%AE%97%E6%B3%95/q6/" title="leetcode栈与队列必刷题——用栈实现队列、用队列实现栈、有效的括号、删除字符串中的所有相邻重复项、逆波兰表达式求值、滑动窗口最大值、前 K 个高频元素"><img src="https://cdn.jsdelivr.net/gh/palp1tate/ImgPicGo/img/1284.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="leetcode栈与队列必刷题——用栈实现队列、用队列实现栈、有效的括号、删除字符串中的所有相邻重复项、逆波兰表达式求值、滑动窗口最大值、前 K 个高频元素"/></a><div class="content"><a class="title" href="/2023/11/21/%E7%AE%97%E6%B3%95/q6/" title="leetcode栈与队列必刷题——用栈实现队列、用队列实现栈、有效的括号、删除字符串中的所有相邻重复项、逆波兰表达式求值、滑动窗口最大值、前 K 个高频元素">leetcode栈与队列必刷题——用栈实现队列、用队列实现栈、有效的括号、删除字符串中的所有相邻重复项、逆波兰表达式求值、滑动窗口最大值、前 K 个高频元素</a><time datetime="2023-11-21T07:05:51.000Z" title="发表于 2023-11-21 15:05:51">2023-11-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/11/19/%E7%AE%97%E6%B3%95/q5/" title="leetcode字符串必刷题——反转字符串、反转字符串 II、反转字符串中的单词、找出字符串中第一个匹配项的下标、重复的子字符串"><img src="https://cdn.jsdelivr.net/gh/palp1tate/ImgPicGo/img/1284.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="leetcode字符串必刷题——反转字符串、反转字符串 II、反转字符串中的单词、找出字符串中第一个匹配项的下标、重复的子字符串"/></a><div class="content"><a class="title" href="/2023/11/19/%E7%AE%97%E6%B3%95/q5/" title="leetcode字符串必刷题——反转字符串、反转字符串 II、反转字符串中的单词、找出字符串中第一个匹配项的下标、重复的子字符串">leetcode字符串必刷题——反转字符串、反转字符串 II、反转字符串中的单词、找出字符串中第一个匹配项的下标、重复的子字符串</a><time datetime="2023-11-19T05:59:33.000Z" title="发表于 2023-11-19 13:59:33">2023-11-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/11/18/jetbrains-ai/" title="快速提高编码生产力——中国用户如何使用Jetbrains内置的AI助手"><img src="https://s2.loli.net/2023/05/31/1zC4bdRjiXnZ75a.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="快速提高编码生产力——中国用户如何使用Jetbrains内置的AI助手"/></a><div class="content"><a class="title" href="/2023/11/18/jetbrains-ai/" title="快速提高编码生产力——中国用户如何使用Jetbrains内置的AI助手">快速提高编码生产力——中国用户如何使用Jetbrains内置的AI助手</a><time datetime="2023-11-18T05:24:31.000Z" title="发表于 2023-11-18 13:24:31">2023-11-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/11/17/git-use/" title="Git常用命令详细总结，更适合中国宝宝体质"><img src="https://s2.loli.net/2023/05/31/UuGQIvw8HNBrZsp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Git常用命令详细总结，更适合中国宝宝体质"/></a><div class="content"><a class="title" href="/2023/11/17/git-use/" title="Git常用命令详细总结，更适合中国宝宝体质">Git常用命令详细总结，更适合中国宝宝体质</a><time datetime="2023-11-17T13:26:14.000Z" title="发表于 2023-11-17 21:26:14">2023-11-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/11/16/git/" title=".gitignore 文件——如何在 Git 中忽略文件和文件夹"><img src="https://s2.loli.net/2023/05/31/TREyA8hgqS7JnfV.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt=".gitignore 文件——如何在 Git 中忽略文件和文件夹"/></a><div class="content"><a class="title" href="/2023/11/16/git/" title=".gitignore 文件——如何在 Git 中忽略文件和文件夹">.gitignore 文件——如何在 Git 中忽略文件和文件夹</a><time datetime="2023-11-16T11:07:53.000Z" title="发表于 2023-11-16 19:07:53">2023-11-16</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/palp1tate/blog_img/img/4d287328613d2f4952a70edb9192044037dd5e22.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2023 By Palp1tate</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><i class="fa-solid fa-cloud"></i><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/"><span>萌ICP备20230529号</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><div class="aplayer no-destroy" data-id="6614140207" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true" data-mini="true"> </div><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="false" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>